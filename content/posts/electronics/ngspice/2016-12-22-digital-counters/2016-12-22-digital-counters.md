title: NGSPICE.js - счетчики и делители частоты
category: Electronics
tags: gEDA, ngspice, gate

[Продолжаем]({filename}../2016-10-28-ngspice-introduction/2016-10-28-ngspice-introduction.md) осваивать NGSPICE в целом и [цифровую]({filename}../2016-12-18-logic-gate/2016-12-18-logic-gate.md) схемотехнику в частности.

В цифровой схемотехнике понятия «счетчик импульсов» и «делитель частоты» тесно связаны. 
Под делителем частоты понимается устройство, которое принимает входной сигнал с заданной частотой и генерирует выходной сигнал, частота которого меньше входной в n раз. На каждые n импульсов на входе формируется один импульс на выходе. Простейший двоичный счётчик может быть построен на основе T-триггера, который является модифицированным двухступенчатым [D-триггером]({filename}../2016-12-20-trigger/2016-12-20-trigger.md) с обратной связью. Такой триггер делит частоту поступающих на вход импульсов на два по модулю. Один триггер считает до двух, два соединенных последовательно до четырех, n до 2^n импульсов. Результат счета формируется в двоичном коде, где каждый разряд храниться в памяти соответствующего триггера. Двоичный код при необходимости может быть считан и преобразован другим узлами - например двоично-десятичным дешифратором. 

В следующих схемах для симуляции использовались SPICE модели логических вентилей [И-НЕ]({attach}nand.lib) | [ИЛИ-НЕ]({attach}nor.lib). SPICE модель двухступенчатого [D-триггера]({attach}dtrigger.lib) выделена как подсхема из [предыдущего]({filename}../2016-12-20-trigger/2016-12-20-trigger.md) материала (плюс-минус парочка резисторов для красивой симуляции) по аналогии с [вентилями]({filename}../2016-12-18-logic-gate/2016-12-18-logic-gate.md).

<!-- 
<a href="{attach}nand42.sym"></a>
<a href="{attach}nor42.sym"></a>
<a href="{attach}d42.sym"></a>
-->

<!-- 
sudo cp d42.sym nand42.sym nor42.sym /usr/share/gEDA/sym/local/
-->

[асинхронный двоичный счётчик на T-триггерах]({attach}t.sch) | [netlist]({attach}t.net) | [ngspice.js](https://ngspice.js.org/?gist=fc70f8faa3373df6736221deddf16cff)

![screenshot]({attach}show-img-t.png){:style="width:100%; border:1px solid #ddd;"}

    :::text
    ngspice 1 -> source t.net
    ngspice 2 -> tran 18m 18
    ngspice 3 -> plot clock+7 out2+3.5 out4

На принципиальной схеме при условном графическом обозначении (УГО) триггера треугольничек указывает на то, что тот переключается по фронту импульса и в данном конкретном случае это передний фронт. Если же к треугольнику дорисовать кружочек как на инверсном выходе Q, то переключение триггера происходит по заднему фронту. Двухступенчатый D-триггер, у которого инверсный выход замкнут на собственный вход для данных Data, называется T-триггером. Такой триггер называют счетным триггером, он имеет только один вход (без учёта аппаратного сброса) и делит количество входных импульсов на два т.к. переключается только по одному из двух фронтов.

![screenshot]({attach}t-canvas.png){:style="width:100%; border:1px solid #ddd;"}

Главным недостатком у асинхронных счётчиков является то, что каждый T-триггер переключаются последовательно, ожидая соседа, т.е. в различные моменты времени с задержкой по мере распространения цифрового сигнала - отсюда и название асинхронный. Например чтобы построить цифровой таймер, используя кварц на 32768 Гц ([2^15](https://bc.js.org/)), для получения на выходе счётчика 1 Гц необходимо 15 включённых последовательно T-триггеров, а каждый триггер добавляет свою задержку и как результат переключения на выходе будут запаздывать уже на 15*x по отношению к входному сигналу. Данный недостаток устранён у синхронных счётчиков.

[синхронный счётчик]({attach}st.sch) | [netlist]({attach}st.net) | [ngspice.js](https://ngspice.js.org/?gist=9c65b6d93df67c99c99efd09e45b1f4f)

![screenshot]({attach}show-img-st.png){:style="width:100%; border:1px solid #ddd;"}

    :::text
    ngspice 1 -> source st.net
    ngspice 2 -> tran 18m 18
    ngspice 3 -> plot clock+7 out2+3.5 out4

Вентили U3-U6 образуют исключающее «ИЛИ» (XOR) - если логические уровни на входах равны между собой, то на выходе «0», в противном случае «1».

![screenshot]({attach}st-canvas.png){:style="width:100%; border:1px solid #ddd;"}

Временная диаграмма выхода OUT4 у синхронного счётчика немного отличается от асинхронного. Входной сигнал Clock поступает на оба триггера в одинаковые моменты времени. По первому переднему фронту Clock на OUT2 и OUT4 логические «0», т.к. до этого был аппаратный сброс. При «0» на всех входах XOR выдаёт «0» и триггер U2 запомнит «0». По второму переднему фронту Clock на OUT2 уже «1», на OUT4 по-прежнему «0» и XOR даст «1», триггер U2 переключается. В итоге частота Clock всё также делится на 4 на выходе U2, но все триггеры переключаются одновременно без нежелательных задержек.

[счётчик до 3]({attach}3.sch) | [netlist]({attach}3.net) | [ngspice.js](https://ngspice.js.org/?gist=709d6dad0810bf936168a28e8afe7393)

![screenshot]({attach}show-img-3.png){:style="width:100%; border:1px solid #ddd;"}

    :::text
    ngspice 1 -> source 3.net
    ngspice 2 -> tran 18m 18
    ngspice 3 -> plot clock+3.5 out3

Можно даже смастерить синхронный делитель не кратный двум, например 3. Правда в данном случае на выходе получится не меандр - коэффициент заполнения выходных импульсов не равен 50%.   

![screenshot]({attach}3-canvas.png){:style="width:100%; border:1px solid #ddd;"}

Цифровые счетчики импульсов являются неотъемлемыми узлами современной электротехники.
Они находят широкое применение в микропроцессорах, электронных часах, таймерах, частотомерах, системах с фазовой автоподстройкой частоты (ФАПЧ) и многих других устройствах.