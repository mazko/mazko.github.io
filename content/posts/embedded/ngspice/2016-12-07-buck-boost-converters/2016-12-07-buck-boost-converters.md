title: NGSPICE.js - импульсные преобразователи напряжения
category: Embedded 
tags: gEDA, ngspice, ШИМ

[Продолжаем]({filename}../2016-10-28-ngspice-introduction/2016-10-28-ngspice-introduction.md) осваивать NGSPICE.

В импульсных преобразователях входное напряжение нарезается порциями - импульсами c заданной [скважностью]({filename}../2016-12-05-duty-cycle-control/2016-12-05-duty-cycle-control.md) и чем меньше скважность тем большая часть энергии попадёт на выход. Если импульсы прямоугольной формы, то силовая часть схемы работает в ключевом режиме т.е. находится либо в режиме отсечки, когда сопротивление максимально, либо в режиме насыщения - с минимальным сопротивлением. Рассеиваемая мощность на ключе ```P = I*U = 0*I = 0*U = 0``` и выходит что у идеальных импульсных преобразователей коэффициент полезного действия (КПД) стремится к 100%. Сглаживание пульсаций выходного напряжения происходит благодаря наличию интегрирующих элементов, способных накапливать электрическую энергию и отдавать её в нагрузку. Если сравнивать импульсные преобразователи с [линейными]({filename}../2016-12-06-voltage-regulator/2016-12-06-voltage-regulator.md) то первые как правило имеют большие размеры и больше шумят, но при этом обеспечивают значительно лучший КПД. Что интересно, импульсные преобразователи умеют не только понижать напряжение, но и повышать его !

<!-- 
<a href="{attach}irf530.lib"></a>
<a href="{attach}1n5822.txt"></a>
-->

В следующих схемах использовались SPICE модели мощного [полевого]({filename}../2016-11-03-field-effect-transistor/2016-11-03-field-effect-transistor.md) транзистора IRF530 и [диода]({filename}../2016-10-31-ngspice-diode/2016-10-31-ngspice-diode.md) Шоттки (с малым падением напряжения < 0.5 В) 1n5822:

    :::bash
    ~$ wget http://www.vishay.com/docs/90181/irf530.lib
    ~$ wget http://www.vishay.com/docs/88003/1n5822.txt

[импульсный понижающий преобразователь]({attach}buck.sch) | [netlist]({attach}buck.net) | [ngspice.js](https://ngspice.js.org/?gist=3c337ca0b9b0733f8e5cf99197c23836)

![screenshot]({attach}show-img-buck.png){:style="width:100%; border:1px solid #ddd;"}

    :::text
    ngspice 1 -> source buck.net
    ngspice 2 -> tran 0.3u 1m
    ngspice 3 -> plot v(out)

Номиналы понижающего преобразователя [расчитаны](http://www.ti.com/lit/an/slva477b/slva477b.pdf){:rel="nofollow"} исходя из требуемого напряжения на выходе 3.3 В, напряжения на входе 10 В, тока нагрузки 2 А, частоты ключа 50кГц, пульсации тока через индуктивность 30% и допустимых пульсаций выходного напряжения 25 мВ.

![formula]({attach}buck-L.svg){:style="width:25%; margin: 0 auto; display:block;"}

Где ```D = Vout/Vin``` это коэффициент [заполнения]({filename}../2016-12-05-duty-cycle-control/2016-12-05-duty-cycle-control.md) и тогда минимальная индуктивность [равна](https://bc.js.org/) ```(3.3*(1-3.3/10))/(50000*2*0.3) = 73.7 мкГн```. Конденсатор для сглаживания пульсаций напряжения на выходе рассчитывается по формуле:

![formula]({attach}buck-C.svg){:style="width:26.5%; margin: 0 auto; display:block;"}

Получаем минимальную необходимую ёмкость ```(2*0.3)/(8*50000*0.025) = 60 мкФ```

![screenshot]({attach}buck-canvas.png){:style="width:100%; border:1px solid #ddd;"}

Поскольку транзистор X1 неидеальный ключ и судя по документации его сопротивление в открытом состоянии составляет 0.16 мОм, то к примеру при токе 1 А на нём будет теряться 0.16 В и это легко проверить командой ```plot v(cp1,cp3) ylimit 0 1 xlimit 0.5m 0.6m```. На диоде также происходят потери и чем слабее диод тем большее на нём прямое напряжение и тем хуже он справляется с функцией ключа. Из-за потерь напряжение на выходе не дотягивает до 3.3 В, но подправить ситуации можно увеличив D с 0.33 до приблизительно 0.37. Что касается скачка напряжения на старте то в цепи находится последовательный [колебательный]({filename}../2016-10-30-ngspice-resonance/2016-10-30-ngspice-resonance.md) контур c периодом колебаний ```2*3.14*sqrt(74*10^-6*60*10^-6) ≈ 0.42 мс```. Чем меньше сопротивление нагрузки R тем меньше амплитуда этих колебаний и тем быстрее они затухают.

[импульсный повышающий преобразователь]({attach}boost.sch) | [netlist]({attach}boost.net) | [ngspice.js](https://ngspice.js.org/?gist=8bc2e416c971a2d55fcdda0b6c113eaa)

![screenshot]({attach}show-img-boost.png){:style="width:100%; border:1px solid #ddd;"}

    :::text
    ngspice 1 -> source boost.net
    ngspice 2 -> tran 0.5u 3m
    ngspice 3 -> plot v(out) ylimit 2 10

Номиналы повышающего преобразователя [расчитаны](http://www.ti.com/lit/an/slva372c/slva372c.pdf){:rel="nofollow"} исходя из требуемого напряжения на выходе 10 В, напряжения на входе 3.3 В, тока нагрузки 2 А, частоты ключа 50кГц, пульсации тока через индуктивность 30% и допустимых пульсаций выходного напряжения 250 мВ.

<!-- 
L = \frac{V_{in}*D}{\Delta I_{L}*f_{sw}}
-->

![formula]({attach}boost-L.svg){:style="width:19.4%; margin: 0 auto; display:block;"}

Где ```D = 1 - (Vin/Vout)``` это коэффициент [заполнения]({filename}../2016-12-05-duty-cycle-control/2016-12-05-duty-cycle-control.md) и тогда минимальная индуктивность [равна](https://bc.js.org/) ```(3.3*(1-3.3/10))/(50000*2*0.3) = 73.7 мкГн```. Конденсатор для сглаживания пульсаций напряжения на выходе рассчитывается по формуле:

<!-- 
C = \frac{I_{out}*D}{f_{sw}*\Delta V_{out}}
-->

![formula]({attach}boost-C.svg){:style="width:21.8%; margin: 0 auto; display:block;"}

Получаем минимальную ёмкость ```2*(1-3.3/10)/(50000*0.25) = 107.2 мкФ```

![screenshot]({attach}boost-canvas.png){:style="width:100%; border:1px solid #ddd;"}

Компенсировать потери на транзисторе и диоде можно подтянув коэффициент заполнения D с 0.67 до 0.74.

К сожалению выходное напряжение как понижающего так и повышающего импульсного преобразователя зависит от входного напряжения и величины сопротивления нагрузки R. Это несложно проверить командой ```alter r 10k``` - напряжение в обоих преобразователях поползёт вверх. Для стабилизации вводят обратную связь, в которой ошибка напряжения на выходе управляет [скважностью]({filename}../2016-12-05-duty-cycle-control/2016-12-05-duty-cycle-control.md) импульсов с каким-то заранее рассчитанным коэффициентом пропорциональности и получается П-регулятор. Для уменьшения временной задержки между ошибкой и её устранением добавляют [интегральную]({filename}../2016-11-30-op-amp-integrator-differentiator/2016-11-30-op-amp-integrator-differentiator.md) и [дифференцирующую]({filename}../2016-11-30-op-amp-integrator-differentiator/2016-11-30-op-amp-integrator-differentiator.md) составляющую и получается ПИД-регулятор. К счастью можно воспользоваться готовыми микросхемами DC/DC преобразователей, которые значительно упрощают жизнь, сводя количество расчётов к миниму.

[Далее]({filename}../2016-12-13-timer-555/2016-12-13-timer-555.md) интегральный таймер 555.