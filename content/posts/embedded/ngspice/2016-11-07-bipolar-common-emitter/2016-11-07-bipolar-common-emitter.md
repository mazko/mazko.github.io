title: NGSPICE.js - усилительный каскад с общим эмиттером
category: Embedded 
tags: gEDA, ngspice

[Продолжаем]({filename}../2016-10-28-ngspice-introduction/2016-10-28-ngspice-introduction.md) осваивать NGSPICE.

При схеме включения [биполярного транзистора]({filename}../2016-11-02-bipolar-transistor/2016-11-02-bipolar-transistor.md) с общим эмиттером (ОЭ) усилительный каскад усиливает как ток так и напряжение, т.е. данное включение транзистора позволяет получить наибольшее усиление по мощности. К недостаткам такой схемы стоит отнести нелинейные искажения сигнала (больше, чем в схемах с общей базой или с общим коллектором) и то что на характеристики усилителя значительное влияние оказывают внешние факторы, такие как напряжение питания или температура окружающей среды. Обычно для компенсации этих факторов применяют отрицательную обратную связь, но она снижает коэффициент усиления.

В следующих схемах для симуляции использовалась SPICE модель популярного n-p-n транзистора [2N2222]({attach}2N2222.LIB)

[простейший каскад с ОЭ]({attach}quick.sch) | [netlist]({attach}quick.net) | [ngspice.js](https://ngspice.js.org/?gist=5caf9c51187c6b94386582162a08f1dd)

![screenshot]({attach}show-img-quick.png){:style="width:100%; border:1px solid #ddd;"}

    :::text
    ngspice 1 -> source quick.net
    ngspice 2 -> dc i1 0 18u 18n
    ngspice 3 -> alter r 3.3k
    ngspice 4 -> dc i1 0 18u 18n
    ngspice 5 -> plot dc1.v(out) dc2.v(out)
    ngspice 6 -> alter i1 2u
    ngspice 7 -> op
    ngspice 8 -> show q1
    ngspice 9 -> alter i1 14u
    ngspice 10 -> op
    ngspice 11 -> show q1

Как видно на картинке ниже изменение выходного напряжения идёт в противофазе с изменением входного (180°). Чем больше сопротивление в цепи коллектора R, тем круче ВАХ и соответственно тем больший коэффициент усиления по напряжению, но ```R(max) ≈ (V1-0.3)/(β*Ib(max)) ≈ (10-0.3)/(191*18*10^-6)``` [≈ 2821 Ом](https://bc.js.org/). В нашем случае это условие нарушено т.к. **R > 2821** и именно поэтому внизу висят две горизонтальные сопли, т.е при амплитуде входного сигнала 18мкА часть усиленного сигнала будет срезана :(

![screenshot]({attach}quick-canvas.png){:style="width:100%; border:1px solid #ddd;"}

Команда ```op``` по двум точкам активного (линейного) режима работы транзистора фиксирует следующие значения - ic:0.000268091 | ib:2.00001e-06 | vbe:0.659054 и ic:0.00255927 | ib:1.4e-05 | vbe:0.719389

Усиление по току равно коэффициенту передачи по току β и [≈ 191](https://bc.js.org/) ```(0.00255927-0.000268091)/(1.4*10^-05-2.00001*10^-06)``` [≈ 45.6 дБ](https://bc.js.org/) ```20*log(191)=20*l(191)/l(10)```

Усиление по напряжению [≈ 125.3](https://bc.js.org/) ```((10-0.000268091*3300)-(10-0.00255927*3300))/(0.719389-0.659054)``` [≈ 41.95 дБ](https://bc.js.org/) ```20*l(125.3)/l(10)```

[Входное сопротивление]({filename}../2016-11-04-input-output-impedance/2016-11-04-input-output-impedance.md)(среднее) каскада [≈ 5028 Ом](https://bc.js.org/) ```(0.719389-0.659054)/(1.4*10^-05-2.00001*10^-06)```. Поскольку база-эмиттер это диод, входное сопротивление нелинейно - чем больший ток, тем меньше сопротивление. Если величина этого сопротивления сопоставима с величиной внутреннего сопротивления источника усиливаемого сигнала (схема c bias ниже), например при [согласовании по мощности]({filename}../2016-11-04-input-output-impedance/2016-11-04-input-output-impedance.md), то это приведёт к ощутимым **нелинейным искажениям** ещё на входе (до усиления). Попробовать ослабить такие искажения можно увеличив общее сопротивление входной цепи, например поставив дополнительный резистор между источником сигнала и входом усилителя, однако это снизит общий коэффициент усиления каскада вцелом. За всё нужно платить :)

Выходное сопротивление очевидно ≈ R ≈ 3.3 kОм.

Для того чтобы усиливать гармонический сигнал (например звук) в схему необходимо ещё добавить гальваническую развязку по входу в виде конденсатора и напряжение смещения (Bias) база-эмиттер:

[ОЭ со смещением и гальванической развязкой]({attach}bias.sch) | [netlist]({attach}bias.net) | [ngspice.js](https://ngspice.js.org/?gist=d5d84f15744ea255196d136b735e6570)

![screenshot]({attach}show-img-bias.png){:style="width:100%; border:1px solid #ddd;"}

    :::text
    ngspice 1 -> source bias.net
    ngspice 2 -> alter rbias 42meg
    ngspice 3 -> tran 9u 3m
    ngspice 4 -> alter rbias 1.8meg
    ngspice 5 -> tran 9u 3m
    ngspice 6 -> plot tran1.v(out) tran2.v(out)

Ток смещения в такой схеме обычно рассчитывается на половину максимального напряжения на коллекторе в режиме покоя (рабочая точка): ```Ibias = U(max)/(2*R*β) = 10/(2*5100*191) ≈ 5.133 мкA``` и тогда ```Rbias ≈ (V1-0.7)/Ibias = (10-0.7)/(5.133*10^-6) ≈ 1.8 МОм```. При неправильном смещении сигнал на выходе будет искажен.

![screenshot]({attach}bias-canvas.png){:style="width:100%; border:1px solid #ddd;"}

Главным недостатком вышеописанной схемы является слишком явная зависимость рабочей точки от внешних факторов - к примеру изменение модели транзистора, напряжения питания или температуры окружающей среды потребует пересчёта величины Rbias. В этой связи наибольшее применение получила модифицированная схема каскада с ОЭ, предполагающая наличие отрицательной обратной связью по постоянному току:

[ОЭ с H-смещением]({attach}h-bias.sch) | [netlist]({attach}h-bias.net) | [ngspice.js](https://ngspice.js.org/?gist=ff5ede71d7db3d4e17d0448c88f9443d)

![screenshot]({attach}show-img-h-bias.png){:style="width:100%; border:1px solid #ddd;"}

    :::text
    ngspice 1 -> source h-bias.net
    ngspice 2 -> tran 9u 3m
    ngspice 3 -> plot v(out)

По переменному току резистор Re шунтируется конденсатором Ce и таким образом почти не влияет на коэффициент усиления каскада. Ориентировочный расчёт схемы с H-смещением:

  - Зная амплитуду входного сигнала 50 мВ найдём максимальный ток базы ```Ib(max) ≈ 0.05/10k ≈ 5*10^-6 A``` Если мы хотим добиться максимального усиления по напряжению ```Rc(max) ≈ (V1-0.3)/(β*Ib(max)) ≈ (10-0.3)/(191*5*10^-6) ≈ 10 кОм```. Если с двойным запасом для размаха выходного сигнала то Rс = 5.1 кОм

  - Напряжение на коллекторе обычно принимают половине напряжения питания и тогда ток коллектора ```Ic = V1/(2*Rс) = 10/(2*5100) ≈ 0.98 мА```. Напряжение на стабилизирующем сопротивлении обычно составляет 10-20% от напряжения питания и тогда его величина ```Re = 0.1*V1/Ic = 0.1*10/(98*10^-5) ≈ 1 кОм```

  - Зная коэффициент передачи β определим ток базы ```Ib = Ic/β = (98*10^-5)/191 ≈ 5.13 мкA```

Простой расчёт Rb1 и Rb2:

  - Для того, чтобы транзистор не влиял на выходное напряжение делителя Rb1 и Rb2 ток через эти резисторы выбирается в десять раз больше тока базы транзистора ```Id = 10*Ib = 51.3 мкA```

  - Напряжение на выходе делителя Rb1 и Rb2, обеспечивающее ток базы 5.13 мкA ```Vd ≈ Ve + Vbe = 1 + 0.7 ≈ 1.7 В```

  - ```Rb1 = (V1-Vd)/Id = (10-1.7)/(513*10^-7) ≈ 161793 Ом``` | ```Rb2 = Vd/Id = 1.7/(513*10^-7) ≈ 33138 Ом```

Чуть более сложный и точный расчёт Rb1 и Rb2:

  - Исходя из теоремы Тевенина по отношению к базе транзистора резисторы Rb1 и Rb2 соединены параллельно ```Rb = Rb1*Rb2/(Rb2+Rb2)```. Rb обычно расчитывается таким образом чтобы быть на порядок меньше чем входное сопротивление каскада по постоянному току - например в 10 раз ```Rb = β*Re/10 = 191*1000/10 ≈ 19 кОм```

  - Напряжение, обеспечивающее ток базы 5.13 мкA ```Vbb ≈ Ve + Vbe + Ib*Rb = 1 + 0.7 + 19000*5.13*10^-6 ≈ 1.7975 В```

   - ```Rb1 = Rb*V1/Vbb = 19000*10/1.7975 ≈ 105702 Ом``` | ```Rb2 = Rb/(1-Vbb/V1) = 19000/(1-1.7975/10) ≈ 23164 Ом```

![screenshot]({attach}h-bias-canvas.png){:style="width:100%; border:1px solid #ddd;"}

Далее усилительный каскад с общим коллектором.
