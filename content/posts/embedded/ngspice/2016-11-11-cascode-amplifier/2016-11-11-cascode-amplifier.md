title: NGSPICE.js - каскодный усилитель
category: Embedded 
tags: gEDA, ngspice

[Продолжаем]({filename}../2016-10-28-ngspice-introduction/2016-10-28-ngspice-introduction.md) осваивать NGSPICE.

Основным недостатком усилительного каскада с общей базой (ОБ) является то что [выходное]({filename}../2016-11-04-input-output-impedance/2016-11-04-input-output-impedance.md) сопротивление на порядок больше входного. Этого недостатка лишена *каскодная схема* или *каскод*, которая изображена на рисунке ниже. В такой схеме транзисторы соединены последовательно, при этом входной транзистор включен по схеме с общим эмиттером [ОЭ]({filename}../2016-11-07-bipolar-common-emitter/2016-11-07-bipolar-common-emitter.md), а другой - по схеме с общей базой [ОБ]({filename}../2016-11-10-bipolar-common-base/2016-11-10-bipolar-common-base.md). Каскодная схема обеспечивает примерно такое же усиление по току и напряжению, что и схема с общим эмиттером. 

Как известно на характеристиках каскада с общим эмиттером [ОЭ]({filename}../2016-11-07-bipolar-common-emitter/2016-11-07-bipolar-common-emitter.md)
негативно сказывается эффект Миллера, при котором из-за сдвига фазы выходного напряжения на 180° по отношению к входному емкость коллектор-база создаёт отрицательную обратную связь по переменному току на высоких частотах. Такая паразитная обратная связь эквивалентна включению на входе усилителя шунтирующей емкости, величина которой пропорциональна коэффициенту усиления по напряжению каскада. 

В каскодной схеме коэффициент усиления по напряжению каскада с [ОЭ]({filename}../2016-11-07-bipolar-common-emitter/2016-11-07-bipolar-common-emitter.md) невелик - это обусловлено малым входным сопротивления каскада с общей базой [ОБ]({filename}../2016-11-10-bipolar-common-base/2016-11-10-bipolar-common-base.md). Небольшой коэффициент усиления по напряжению каскада с ОЭ значительно ослабляет эффект Миллера. Что касается каскада с [ОБ]({filename}../2016-11-10-bipolar-common-base/2016-11-10-bipolar-common-base.md) то в нём эффект Миллера отсутствует как таковой. В итоге получаем усиление по току в ОЭ + усиление по напряжению в ОБ но без негативного влияния эффекта Миллера.

В следующих схемах для симуляции использовалась SPICE модель популярного n-p-n транзистора [2N2222]({attach}2N2222.LIB)

[каскодная схема(справа от IN)]({attach}cascode.sch) | [netlist]({attach}cascode.net) | [ngspice.js](https://ngspice.js.org/?gist=add2c348f915252851fa41fbd3afe97d)

![screenshot]({attach}show-img-cascode.png){:style="width:100%; border:1px solid #ddd;"}

    :::text
    ngspice 1 -> source cascode.net
    ngspice 2 -> ac dec 100 1k 50Meg
    ngspice 3 -> plot db(out/in) db(x_out/in)
    ngspice 4 -> op
    ngspice 5 -> print out cp1 cp2 cp3 cp4

Статическое напряжение, фиксируемое командой ```op``` в контрольных точках ```out = 10.96302``` | ```cp1 = 5.215810``` | ```cp2 = 1.202128``` | ```cp3 = 5.903849``` | ```cp4 = 1.890720```. Попробуем посчитать:

  - Зная амплитуду входного сигнала 50 мВ [найдём](https://bc.js.org/) максимальный ток базы Q1 ```Ib(max) ≈ 0.05/10k ≈ 5*10^-6 A```. Ток покоя каскада с двойным запасом ```Ic = Ib(max)*β ≈ 200*5*10^-6 = 1 мА``` при токе смещения 5 мкА

  - Напряжение на стабилизирующем сопротивлении 10-20% от напряжения питания и тогда его величина ```Re = 0.1*V1/Ie = 0.1*15/(10^-3) ≈ 1.5 кОм``` и падение напряжения на нём ```Ue = I*R = 1.5 В```

  - Для каскада Q1 напряжение смещения ```Ubias = Ue + Ube = 1.5 + 0.7 = 2.2 В```. Для того, чтобы транзистор не влиял на выходное напряжение делителя R2 и R3 ток через эти резисторы выбирается в десять раз больше тока базы транзистора ```Id = 10*Ib = 50 мкА```. Тогда ```R3 = Ubias/Id = 2.2/(5*10^-5) ≈ 43 кОм```

  - Будем исходить из напряжения на коллекторе Q2 ```Uc = V1*2/3 = 10 В``` тогда ```Rc = V1/(3*Ic) = 15/(3*10^-3) ≈ 5.1 кОм```. Суммарное напряжение на обоих переходах коллектор-эмиттер Q1 и Q2 ```Us = Uc - Ue = 10 - 1.5 = 8.5 В``` и если для упрощения расчётов предположить что эти напряжения равны тогда напряжение смещения для каскада Q2 ```Ubias = (Uc - Us/2) + Ube = (10-8.5/2)+0.7 = 6.45 В```. Тогда ```R1 = (V1-Ubias)/Id = (15-6.45)/(5*10^-5) ≈ 169 кОм``` и зная разность напряжений Ubias ```R2 = ΔUbias/Id = (6.45-2.5)/(5*10^-5) ≈ 82 кОм```

Для снятия [АЧХ]({filename}../2016-10-29-ngspice-rc/2016-10-29-ngspice-rc.md) амплитуда входного выбрана сигнала Vin 50мВ, на который мы рассчитали ранее схему с [ОЭ]({filename}../2016-11-07-bipolar-common-emitter/2016-11-07-bipolar-common-emitter.md).

![screenshot]({attach}cascode-canvas.png){:style="width:100%; border:1px solid #ddd;"}

Тогда как согласно графику АЧХ у каскодного усилителя коэффициент усиления только начинает заваливаться на частоте 1МГц/30дБ, каскад с ОЭ на этой частоте уже чувствует себя очень плохо < 10 дБ.

![screenshot]({attach}cascode-canvas-tran.png){:style="width:100%; border:1px solid #ddd;"}

    :::text
    ngspice 1 -> source cascode.net
    ngspice 2 -> alter @vin[sin] [ 0 50m 1meg ]
    ngspice 3 -> tran 10n 5u
    ngspice 4 -> plot v(out) v(x_out)

Контрольная [проверка](https://ngspice.js.org/?gist=764af0bb80c15e3de059ec33b65471fe) - рабочая точка выбрана верно, видимые искажения на выходе отсутствуют. [Далее]({filename}../2016-11-13-transistor-oscillators/2016-11-13-transistor-oscillators.md) генераторы колебаний на транзисторах.