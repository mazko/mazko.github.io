title: NGSPICE.js - генераторы колебаний на транзисторах
category: Embedded 
tags: gEDA, ngspice

[Продолжаем]({filename}../2016-10-28-ngspice-introduction/2016-10-28-ngspice-introduction.md) осваивать NGSPICE.

Если некоторая часть выходного сигнала усилителя подаётся обратно на вход, так что усилитель усиливает часть своего собственного выходного сигнала, то мы получаем т.н.  обратную связь. Обратная связь существует в двух разновидностях: положительная (также называемая регенеративной) и отрицательная (ООС). При положительной обратной связи (ПОС) часть выходного сигнала складывается с входным сигналом тогда как при отрицательной вычитается. Типичные примеры ООС с применением транзисторов [ОБ]({filename}../2016-11-10-bipolar-common-base/2016-11-10-bipolar-common-base.md) и [ОК]({filename}../2016-11-09-bipolar-common-collector/2016-11-09-bipolar-common-collector.md). ООС приводит к снижению коэффициента усиления, однако даёт и определённые преимущества: уменьшение искажений, увеличение полосы пропускания, температурная стабилизация. Сильную ПОС в основном используют в генераторах сигналов. Слабая ПОС также находит применение - например в регенеративных радиоприёмниках для достижения большого (огромного) усиления.

Простейший **RC-генератор** состоит из одного транзистора и представляет из себя усилительный каскад с общим эмиттером [ОЭ]({filename}../2016-11-07-bipolar-common-emitter/2016-11-07-bipolar-common-emitter.md), охваченный ПОС. Цепь ПОС состоит из трех фазовращающих RC-цепочек, каждая из которых обеспечивает сдвиг фаз 60 градусов т.е. в сумме. 180° и в результате ООС с коллектора на базу превращается в ПОС (180+180=360=0). При условии ```Rph1=Rph2=Rph3=R``` и ```Сph1=Сph2=Сph3=С```
такой генератор вырабатывает гармонические колебания с [частотой](https://bc.js.org/) ```f = 1/(2*π*sqrt(6)*R*C) ≈ 0.065/(R*C) = 0.065/(22000*10^-7) ≈ 29.5 Гц```

В следующих схемах для симуляции использовалась SPICE модель транзистора [2N2222]({attach}2N2222.LIB)

[схема RC-автогенератора с трехфазной фазирующей цепочкой]({attach}rc-phase-shift.sch) | [netlist]({attach}rc-phase-shift.net) | [ngspice.js](https://ngspice.js.org/?gist=af9112f7d9ce726eb2b2b6dfb8695a99)

![screenshot]({attach}show-img-rc-phase-shift.png){:style="width:100%; border:1px solid #ddd;"}

    :::text
    ngspice 1 -> source rc-phase-shift.net
    ngspice 2 -> tran 0.4m 0.8
    ngspice 3 -> plot v(out)

На картинке примерно 15 пупырышек за 400 миллисекунд что соответствует частоте 15/0.4 = 37.5 Гц, а разница с расчётами видимо связана с тем что входное сопротивление каскада явно < 22 КОм (судя по [замерам]({filename}../2016-11-07-bipolar-common-emitter/2016-11-07-bipolar-common-emitter.md) порядка 5 КОм). У [полевых]({filename}../2016-11-03-field-effect-transistor/2016-11-03-field-effect-transistor.md) транзисторов входное сопротивление значительно больше и поэтому они наверняка дадут лучшую расчётную точность в подобных схемах. Кстати по этой же причине выходное сопротивление Rc (и соответственно Re) тоже неплохо бы уменьшить эдак раз в 10, но тут главное не сорвать генерацию ведь от Rc зависит коэффициент усиления по напряжению.

![screenshot]({attach}rc-phase-shift-canvas.png){:style="width:100%; border:1px solid #ddd;"}

На высоких частотах широкое распространение получили **LC-генераторы**. Тут неплохо бы вспомнить об эффекте [Миллера]({filename}../2016-11-11-cascode-amplifier/2016-11-11-cascode-amplifier.md) и схеме с [ОБ]({filename}../2016-11-10-bipolar-common-base/2016-11-10-bipolar-common-base.md). Каскад с общей базой фазу не сдвигает поэтому сигнал поданный с коллектора в эмиттер порождает ПОС.

[схема генератор Колпитца (ёмкостная трёхточка)]({attach}colpitts.sch) | [netlist]({attach}colpitts.net) | [ngspice.js](https://ngspice.js.org/?gist=eaf8b585ee3ffbcdbe09f75d77bf4bca)

![screenshot]({attach}show-img-colpitts.png){:style="width:100%; border:1px solid #ddd;"}

    :::text
    ngspice 1 -> source colpitts.net
    ngspice 2 -> tran 1n 10u 9.5u
    ngspice 3 -> plot v(out)

Данная схема ввиду своей простоты и дешевизны часто применяется в бюджетных устройствах - радиоуправляемых моделях, жучках и т.д. [Частота (scale=100)](https://bc.js.org/) ```f = 1/(2*π*sqrt(L*C1*C2/(C1+C2))) = 1/(2*3.14*sqrt(150*10^-9*10^-10*10^-10/(10^-10+10^-10))) ≈ 58 МГц``` а фактическая частота на картинке ```18/(0.5*10^-6) = 36 МГц``` - по всей видимости сказываются ёмкости p-n переходов транзистора.

![screenshot]({attach}colpitts-canvas.png){:style="width:100%; border:1px solid #ddd;"}

Одним из самых распространённых генераторов импульсов почти прямоугольной формы является **Мультивибратор**, обычно представляет собой двухкаскадный резистивный усилитель, охваченный глубокой положительной обратной связью. При попарном равенстве сопротивлений резисторов R1 и R4, R2 и R3, ёмкостей конденсаторов C1 и C2, а также параметров транзисторов Q1 и Q2 мультивибратор становится *симметричным* - он генерирует прямоугольные колебания («меандр») со скважностью 2, то есть сигнал у которого длительность импульса и длительность паузы одинаковы.

[схема симметричный мультивибратор]({attach}symmetric-multivibrator.sch) | [netlist]({attach}symmetric-multivibrator.net) | [ngspice.js](https://ngspice.js.org/?gist=16c76d4430f3f30c74e6779da48d1bf9)

![screenshot]({attach}show-img-symmetric-multivibrator.png){:style="width:100%; border:1px solid #ddd;"}

    :::text
    ngspice 1 -> source symmetric-multivibrator.net
    ngspice 2 -> tran 50u 50m 5m
    ngspice 3 -> plot v(out)

[Частота](https://bc.js.org/) мультивибратора ```f = 1/(ln(2)*(R2*C1+R3*C2)) = 1/(l(2)*(47000*10^-7+47000*10^-7)) ≈ 153 Гц``` и фактическая частота ```7/(50*10^-3) = 140 Гц```.

![screenshot]({attach}symmetric-multivibrator-canvas.png){:style="width:100%; border:1px solid #ddd;"}

[Далее]({filename}../2016-11-18-op-amp-basics/2016-11-18-op-amp-basics.md) операционный усилитель.