title: NGSPICE.js - идеальный операционный усилитель
category: Embedded 
tags: gEDA, ngspice, ОУ

[Продолжаем]({filename}../2016-10-28-ngspice-introduction/2016-10-28-ngspice-introduction.md) осваивать NGSPICE.

Операционный усилитель (ОУ) - это модульный многокаскадный усилитель с дифференциальным входом. Для простоты расчётов удобно оперировать понятием *идеального ОУ* - такого себе непрозрачного ящичка с магией внутри. Дифференциальный вход предполагает два входа - инвертирующий и неинвертирующий. Также у ОУ есть две ноги для питания и обычно один выход, уровень напряжения на котором является функцией от разности напряжений на входах. Под идеальным подразумевают:

  - бесконечное [входное сопротивление]({filename}../2016-11-04-input-output-impedance/2016-11-04-input-output-impedance.md)

  - нулевое выходное сопротивление

  - бесконечная ширина [полосы пропускания]({filename}../2016-10-29-ngspice-rc/2016-10-29-ngspice-rc.md) и отсутствие задержки при прохождении сигнала через усилитель

  - бесконечно большой коэффициент усиления по напряжению с разомкнутой петлей [обратной связи]({filename}../2016-11-13-transistor-oscillators/2016-11-13-transistor-oscillators.md)

  - предположение о бесконечности коэффициента усиления идеального
ОУ влечёт за собой предположение о том, что разность напряжений между входами стремится к нулю в активном режиме усиления

<!-- 
<a href="{attach}LT1007CS.txt"></a>
-->

На текущий момент [ngspice.js](https://ngspice.js.org/) собран без флага  ```--enable-xspice```, поэтому в следующих схемах использовалась SPICE модель операционного усилителя LT1007, а не более широко известных и часто используемых LM321 или uA741/К140УД7 т.к. для симуляции они требуют наличия расширения **xspice** - в таких случаях стоит использовать нативный **ngspice**:

    :::bash
    ~$ wget http://cds.linear.com/docs/en/software-and-simulation/LT1007CS.txt

[схема ОУ без обратной связи]({attach}basic.sch) | [netlist]({attach}basic.net) | [ngspice.js](https://ngspice.js.org/?gist=2451008bf8176a886539a9f9b54a448c)

![screenshot]({attach}show-img-basic.png){:style="width:100%; border:1px solid #ddd;"}

    :::text
    ngspice 1 -> source basic.net
    ngspice 2 -> alter vn 0.1m
    ngspice 3 -> dc vp 60u 0.1m 50n
    ngspice 4 -> plot v(out)
    ngspice 5 -> alter vp 0.1m
    ngspice 6 -> op
    ngspice 7 -> print i(vp) i(vn)

Результаты команды ```op``` следующие i(vp) = -8.96560e-09 | i(vn) = -2.09159e-08 из чего можно сделать [вывод](https://bc.js.org/) что входное сопротивление ```(10^-4)/(8.96560*10^-09) ≈ 10 кОм``` | ```(10^-4)/(2.09159*10^-08) ≈ 5 кОм``` что вобщем немного. Что интересно для более высоких напряжений Vp и Vn входное сопротивление оказывается на [порядок](https://ngspice.js.org/?gist=3793a35c63184e8a1d26c67a16888fc2) больше - десятки мегаом:

    :::text
    ngspice 8 -> alter vp 1
    ngspice 9 -> alter vn 1
    ngspice 10 -> op
    ngspice 11 -> print i(vp) i(vn)

Судя по документации LT1007 спроектирован на [биполярных транзисторах]({filename}../2016-11-02-bipolar-transistor/2016-11-02-bipolar-transistor.md), что возможно объясняет небольшое по меркам ОУ входное сопротивление.

![screenshot]({attach}basic-canvas.png){:style="width:100%; border:1px solid #ddd;"}

На картинке пара микровольт активного режима ОУ на входе полностью переворачивают напряжение на выходе из нижнего режима а насыщения в верхний, что говорит об очень большом коэффициенте усиления по напряжению ```(8+8)/(2*10^-6) = 8 миллионов = 20*log(8*10^6)=20*l(8*10^6)/l(10) = 138 дБ```. Поэтому для нормальной работы ОУ вводят обратную связь - как правило отрицательную.

[Далее]({filename}../2016-11-21-op-amp-non-inverting/2016-11-21-op-amp-non-inverting.md) неинвертирующий усилитель на ОУ.