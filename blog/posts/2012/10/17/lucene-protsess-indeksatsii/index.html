<!DOCTYPE html>
<html lang="ru">
<head>
        <meta charset="utf-8" />
        <title>Lucene - –ø—Ä–æ—Ü–µ—Å—Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏</title>
        <link rel="stylesheet" href="http://proiot.ru/blog/theme/css/main.css" />
        <link href="http://proiot.ru/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="üè† –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –í—Å–µ–≥–æ üöó Atom Feed" />

        <script>
            (function(){
                var loc = window.location.href+'';
                if (loc.indexOf('https://')==0){
                    window.location.href = loc.replace('https://','http://');
                }
            })();
        </script>

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
<a rel="nofollow" href="http://github.com/mazko">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />
</a>
        <header id="banner" class="body">
                <h1><a href="http://proiot.ru/">üè† –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –í—Å–µ–≥–æ üöó </a></h1>
                <nav><ul>
                    <li><a href="http://proiot.ru/blog/category/admin/">Admin</a></li>
                    <li><a href="http://proiot.ru/blog/category/electronics/">Electronics</a></li>
                    <li><a href="http://proiot.ru/blog/category/embedded/">Embedded</a></li>
                    <li><a href="http://proiot.ru/blog/category/iot/">IoT</a></li>
                    <li class="active"><a href="http://proiot.ru/blog/category/java/">Java</a></li>
                </ul></nav>
        </header><!-- /#banner -->


<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="http://proiot.ru/blog/posts/2012/10/17/lucene-protsess-indeksatsii/" rel="bookmark"
           title="Permalink to Lucene - –ø—Ä–æ—Ü–µ—Å—Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏">Lucene - –ø—Ä–æ—Ü–µ—Å—Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2012-10-17T00:00:00+03:00">
                –°—Ä 17 –æ–∫—Ç—è–±—Ä—è 2012
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="http://proiot.ru/blog/author/oleg-mazko/">Oleg Mazko</a>
        </address>
<p>In <a href="http://proiot.ru/blog/category/java/">Java</a>.</p>
<p>tags: <a href="http://proiot.ru/blog/tag/lucene">Lucene</a> <a href="http://proiot.ru/blog/tag/jsoup">JSoup</a> <a href="http://proiot.ru/blog/tag/maven">Maven</a> </p>
</footer><!-- /.post-info -->      <p>–°—Ä–µ–¥–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ —Ä–∞–∑–º–µ—Ä –∫–æ—Ç–æ—Ä—ã—Ö –º–æ–≥—É—Ç –±—ã—Ç—å –æ—á–µ–Ω—å –±–æ–ª—å—à–∏–º–∏,  –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç–æ–±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ –∏–∑ –Ω–∏—Ö, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–≤–µ—á–∞—é—Ç –∫–∞–∫–æ–º—É-–ª–∏–±–æ —É—Å–ª–æ–≤–∏—é - –Ω–∞–ø—Ä–∏–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç—É –∏–ª–∏ –∏–Ω—É—é —Ñ—Ä–∞–∑—É. –ö–∞–∫ —Ä–µ—à–∞—Ç—å –ø–æ–¥–æ–±–Ω—É—é –∑–∞–¥–∞—á—É ? –ú–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∏—Å–∫–æ–º–æ–π —Ñ—Ä–∞–∑—ã –≤ –∫–∞–∂–¥–æ–º –∏–∑ –Ω–∏—Ö. –ù–æ —Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –º–æ–∂–µ—Ç —É–π—Ç–∏ –Ω–∞ –ø–æ–∏—Å–∫ —Ñ—Ä–∞–∑—ã –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ —Ä–∞–∑–º–µ—Ä–æ–º —Å–∫–∞–∂–µ–º 1000000 —Å–ª–æ–≤ –∏ –±–æ–ª–µ–µ ? –£–º–Ω–æ–∂–∞–µ–º —ç—Ç–æ —á–∏—Å–ª–æ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤... –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –ø—Ä—è–º–æ–ª–∏–Ω–µ–π–Ω–æ - –ø–æ–∫–∞ –º—ã –±—É–¥–µ–º —á—Ç–æ-—Ç–æ –∏—Å–∫–∞—Ç—å, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —É–∂–µ –ø–æ–¥–∑–∞–±—ã—Ç—å —á—Ç–æ –∂–µ –∏–º–µ–Ω–Ω–æ –æ–Ω —Ö–æ—Ç–µ–ª –∏ –∑–∞—á–µ–º —ç—Ç–æ –±—ã–ª–æ –Ω–∞–¥–æ.</p>
<p>–ß—Ç–æ–±—ã –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å –ø–æ–∏—Å–∫ —Ç–µ–∫—Å—Ç–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –±—ã—Å—Ç—Ä–æ, –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –µ–≥–æ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å - –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ –∫–∞–∫–æ–π-—Ç–æ –¥—Ä—É–≥–æ–π <a href="https://en.wikipedia.org/wiki/Inverted_index" rel="nofollow">—Ñ–æ—Ä–º–∞—Ç</a>, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª–∏—Ç –∏–∑–±–µ–∂–∞—Ç—å –≤—ã—à–µ—É–ø–æ–º—è–Ω—É—Ç—ã—Ö –ø—Ä–æ–±–ª–µ–º. –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —è–≤–ª—è–µ—Ç—Å—è <a href="http://proiot.ru/blog/posts/2012/10/15/lucene-kurs-molodogo-boitsa/">—Å–∞–π—Ç</a>, –∞ –¥–æ–∫—É–º–µ–Ω—Ç—ã —ç—Ç–æ –Ω–µ —á—Ç–æ –∏–Ω–æ–µ –∫–∞–∫ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –µ–≥–æ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö HTML-—Å—Ç—Ä–∞–Ω–∏—Ü. –î–ª—è –æ–±—Ö–æ–¥–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü —Å–∞–π—Ç–∞ –Ω–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è <em>crawler</em>. –≠—Ç–æ –±—É–¥–µ—Ç –µ—â—ë –æ–¥–∏–Ω –ø–æ–¥–ø—Ä–æ–µ–∫—Ç –≤ –º—É–ª—å—Ç–∏–º–æ–¥—É–ª—å–Ω–æ–º Maven –ø—Ä–æ–µ–∫—Ç–µ –Ω–∞—Ä—è–¥—É —Å Server. –ï—â—ë —É –Ω–∏—Ö –±—É–¥–µ—Ç –æ–±—â–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å Common –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫–æ–Ω—Å—Ç–∞–Ω—Ç:</p>
<div class="highlight"><pre><span></span>~$ <span class="nb">cd</span> lucene-tutorial/
~$ tree
.
‚îú‚îÄ‚îÄ common
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ pom.xml
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ src
‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ main
‚îÇ¬†¬†         ‚îî‚îÄ‚îÄ java
‚îÇ¬†¬†             ‚îî‚îÄ‚îÄ common
‚îÇ¬†¬†                 ‚îî‚îÄ‚îÄ LuceneBinding.java
‚îú‚îÄ‚îÄ crawler
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ pom.xml
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ src
‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ main
‚îÇ¬†¬†         ‚îú‚îÄ‚îÄ java
‚îÇ¬†¬†         ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ crawler
‚îÇ¬†¬†         ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ App.java
‚îÇ¬†¬†         ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ HtmlHelper.java
‚îÇ¬†¬†         ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ LuceneIndexer.java
‚îÇ¬†¬†         ‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ SimpleCrawler.java
‚îÇ¬†¬†         ‚îî‚îÄ‚îÄ resources
‚îÇ¬†¬†             ‚îî‚îÄ‚îÄ log4j.properties
‚îú‚îÄ‚îÄ pom.xml
‚îî‚îÄ‚îÄ server
    ‚îú‚îÄ‚îÄ pom.xml
    ‚îú‚îÄ‚îÄ src
    ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ main
    ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ java
    ‚îÇ¬†¬†     ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ server
    ‚îÇ¬†¬†     ‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ SearchServlet.java
    ‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ webapp
    ‚îÇ¬†¬†         ‚îî‚îÄ‚îÄ WEB-INF
    ‚îÇ¬†¬†             ‚îî‚îÄ‚îÄ web.xml
    ‚îî‚îÄ‚îÄ static.war

<span class="m">18</span> directories, <span class="m">13</span> files
</pre></div>


<p><em>pom.xml</em></p>
<div class="highlight"><pre><span></span><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> 
  <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
  <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>tutorial.lucene<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>parent<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;packaging&gt;</span>pom<span class="nt">&lt;/packaging&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.apache.lucene<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>lucene-core<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>6.0.0<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.apache.lucene<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>lucene-analyzers-common<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>6.0.0<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;/dependencies&gt;</span>
  <span class="nt">&lt;modules&gt;</span>
    <span class="nt">&lt;module&gt;</span>server<span class="nt">&lt;/module&gt;</span>
    <span class="nt">&lt;module&gt;</span>crawler<span class="nt">&lt;/module&gt;</span>
    <span class="nt">&lt;module&gt;</span>common<span class="nt">&lt;/module&gt;</span>
  <span class="nt">&lt;/modules&gt;</span>
  <span class="nt">&lt;build&gt;</span>
    <span class="nt">&lt;plugins&gt;</span>
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>3.5.1<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;configuration&gt;</span>
          <span class="nt">&lt;source&gt;</span>1.8<span class="nt">&lt;/source&gt;</span>
          <span class="nt">&lt;target&gt;</span>1.8<span class="nt">&lt;/target&gt;</span>
        <span class="nt">&lt;/configuration&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
  <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</pre></div>


<p><em>crawler/pom.xml</em></p>
<div class="highlight"><pre><span></span><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> 
         <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 </span>
<span class="s">                             http://maven.apache.org/maven-v4_0_0.xsd&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
  <span class="nt">&lt;parent&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>tutorial.lucene<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>parent<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;/parent&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>crawler<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;packaging&gt;</span>jar<span class="nt">&lt;/packaging&gt;</span>
  <span class="nt">&lt;name&gt;</span>Lucene Tutorial Crawler<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>log4j<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>log4j<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>1.2.17<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.jsoup<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>jsoup<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>1.9.1<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>tutorial.lucene<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>common<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</pre></div>


<p><em>common/pom.xml</em></p>
<div class="highlight"><pre><span></span><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> 
         <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 </span>
<span class="s">                             http://maven.apache.org/maven-v4_0_0.xsd&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
  <span class="nt">&lt;parent&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>tutorial.lucene<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>parent<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;/parent&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>common<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;packaging&gt;</span>jar<span class="nt">&lt;/packaging&gt;</span>
  <span class="nt">&lt;name&gt;</span>Crawler and Server Shared Constants<span class="nt">&lt;/name&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</pre></div>


<p><em>crawler/src/main/java/crawler/SimpleCrawler.java</em></p>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">crawler</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.HashSet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.NavigableSet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.TreeSet</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.log4j.Logger</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">SimpleCrawler</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ICrawlEvents</span> <span class="o">{</span>
        <span class="kt">void</span> <span class="nf">onVisit</span><span class="o">(</span><span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="n">String</span> <span class="n">html</span><span class="o">,</span> <span class="n">String</span> <span class="n">seed</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="nf">shouldVisit</span><span class="o">(</span><span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="n">String</span> <span class="n">seed</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">SimpleCrawler</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ICrawlEvents</span> <span class="n">events</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">NavigableSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">linksToCrawl</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">linksCrawled</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">seed</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">SimpleCrawler</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">seed</span><span class="o">,</span> <span class="kd">final</span> <span class="n">ICrawlEvents</span> <span class="n">events</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">events</span> <span class="o">=</span> <span class="n">events</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">seed</span> <span class="o">=</span> <span class="n">seed</span><span class="o">;</span>
    <span class="o">};</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasLinksToCrawl</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">!</span><span class="k">this</span><span class="o">.</span><span class="na">linksToCrawl</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>

        <span class="k">this</span><span class="o">.</span><span class="na">linksCrawled</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">linksToCrawl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">linksToCrawl</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">seed</span><span class="o">);</span>

        <span class="k">while</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">hasLinksToCrawl</span><span class="o">())</span> <span class="o">{</span>

            <span class="kd">final</span> <span class="n">String</span> <span class="n">strURL</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">linksToCrawl</span><span class="o">.</span><span class="na">pollFirst</span><span class="o">();</span>
            <span class="k">this</span><span class="o">.</span><span class="na">linksCrawled</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">strURL</span><span class="o">);</span>

            <span class="k">try</span> <span class="o">{</span>
                <span class="kd">final</span> <span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="n">HtmlHelper</span><span class="o">.</span><span class="na">download</span><span class="o">(</span><span class="n">strURL</span><span class="o">);</span>

                <span class="kt">int</span> <span class="n">linksAdded</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
                <span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">l</span> <span class="o">:</span> <span class="n">HtmlHelper</span><span class="o">.</span><span class="na">extractLinks</span><span class="o">(</span><span class="n">html</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">seed</span><span class="o">))</span> <span class="o">{</span>
                    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">events</span><span class="o">.</span><span class="na">shouldVisit</span><span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">seed</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="o">.</span><span class="na">linksCrawled</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">l</span><span class="o">)</span>
                            <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="o">.</span><span class="na">linksToCrawl</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">l</span><span class="o">))</span> <span class="o">{</span>
                        <span class="k">this</span><span class="o">.</span><span class="na">linksToCrawl</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">l</span><span class="o">);</span>
                        <span class="n">linksAdded</span><span class="o">++;</span>
                    <span class="o">}</span>
                <span class="o">}</span>

                <span class="n">SimpleCrawler</span><span class="o">.</span><span class="na">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span>
                    <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Fetched: [%s] %d new links&quot;</span><span class="o">,</span> <span class="n">strURL</span><span class="o">,</span> <span class="n">linksAdded</span><span class="o">));</span>
                <span class="k">this</span><span class="o">.</span><span class="na">events</span><span class="o">.</span><span class="na">onVisit</span><span class="o">(</span><span class="n">strURL</span><span class="o">,</span> <span class="n">html</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">seed</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="kd">final</span> <span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">SimpleCrawler</span><span class="o">.</span><span class="na">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Fetch error: [%s].&quot;</span><span class="o">,</span> <span class="n">strURL</span><span class="o">),</span> <span class="n">ex</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>–í—Å–µ —Å—Å—ã–ª–∫–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ - –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö –∏ —Å—Ä–µ–¥–Ω–∏—Ö –ø–æ –≤–µ–ª–∏—á–∏–Ω–µ —Å–∞–π—Ç–æ–≤ —Ç–∞–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ –≤–ø–æ–ª–Ω–µ –ø—Ä–∏–µ–º–ª–µ–º–æ. –° –≤–Ω–µ—à–Ω–∏–º –º–∏—Ä–æ–º <em>crawler</em> –æ–±—â–∞–µ—Ç—Å—è –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ <code>ICrawlEvents</code>, –∞ —Å HTML —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–ª–∞—Å—Å <code>HtmlHelper</code>. –ü–æ—Å–ª–µ–¥–Ω–∏–π –∞–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–µ–∫—Ä–∞—Å–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å <em>Html</em> –≤ <em>Java</em> - <a href="http://jsoup.org/" rel="nofollow">JSoup</a>, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Å—Ç–∏–ª–µ JQuery –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º <em>css-—Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤</em>. –¢–∞–∫–∂–µ —Å—Ç–æ–∏—Ç –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ <strong>–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ</strong> –Ω–∞–ª–∏—á–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ (<em>politeness</em>) –º–µ–∂–¥—É Http-–∑–∞–ø—Ä–æ—Å–∞–º–∏ –∫ —Å–∞–π—Ç—É - –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ö–æ—Å—Ç–µ—Ä–æ–≤ —Å–ª–µ–¥—è—Ç –∑–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –æ–¥–Ω–æ–≥–æ IP, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º –≤–µ–±-—Å–∞–π—Ç–æ–º –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ localhost –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–±–ª—é–¥–∞—Ç—å —Ç–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç—å, –µ—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –±–∞–Ω –∫–æ–Ω–µ—á–Ω–æ.</p>
<p><em>crawler/src/main/java/crawler/HtmlHelper.java</em></p>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">crawler</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashSet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.jsoup.Jsoup</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jsoup.nodes.Document</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jsoup.nodes.Element</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jsoup.select.Elements</span><span class="o">;</span>

<span class="kd">final</span> <span class="kd">class</span> <span class="nc">HtmlHelper</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">extractLinks</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">html</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">seed</span><span class="o">)</span> <span class="o">{</span>

        <span class="kd">final</span> <span class="n">Document</span> <span class="n">document</span> <span class="o">=</span> <span class="n">Jsoup</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">html</span><span class="o">,</span> <span class="n">seed</span><span class="o">);</span>
        <span class="kd">final</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">linksSet</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="n">Element</span> <span class="n">link</span> <span class="o">:</span> <span class="n">document</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">&quot;a[href]&quot;</span><span class="o">))</span> <span class="o">{</span>
            <span class="kd">final</span> <span class="n">String</span> <span class="n">strLink</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="na">attr</span><span class="o">(</span><span class="s">&quot;abs:href&quot;</span><span class="o">).</span><span class="na">trim</span><span class="o">().</span><span class="na">toLowerCase</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">strLink</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">linksSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">strLink</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">Collections</span><span class="o">.</span><span class="na">unmodifiableCollection</span><span class="o">(</span><span class="n">linksSet</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">download</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">link</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">InterruptedException</span> <span class="o">{</span>

        <span class="n">IOException</span> <span class="n">ioe</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">retry</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>

        <span class="k">do</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>

                <span class="cm">/* Crawling a real web site politeness &gt; 5s */</span>

                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
                <span class="kd">final</span> <span class="n">Document</span> <span class="n">bDoc</span> <span class="o">=</span> <span class="n">Jsoup</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">link</span><span class="o">).</span><span class="na">userAgent</span><span class="o">(</span><span class="s">&quot;Mozilla&quot;</span><span class="o">).</span><span class="na">timeout</span><span class="o">(</span><span class="mi">30000</span><span class="o">).</span><span class="na">get</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">bDoc</span><span class="o">.</span><span class="na">html</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="kd">final</span> <span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">ioe</span> <span class="o">=</span> <span class="n">ex</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">while</span> <span class="o">(--</span><span class="n">retry</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">);</span>

        <span class="k">throw</span> <span class="n">ioe</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">extractTitle</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">html</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">Document</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Jsoup</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">html</span><span class="o">);</span>
        <span class="kd">final</span> <span class="n">Elements</span> <span class="n">elements</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">&quot;table table div table font&quot;</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">elements</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">elements</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">elements</span><span class="o">.</span><span class="na">first</span><span class="o">().</span><span class="na">text</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">extractContent</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">html</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">Document</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Jsoup</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">html</span><span class="o">);</span>
        <span class="kd">final</span> <span class="n">Elements</span> <span class="n">elements</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">&quot;table table div table div&quot;</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">elements</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">elements</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">elements</span><span class="o">.</span><span class="na">first</span><span class="o">().</span><span class="na">text</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">doc</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">&quot;table table div table&quot;</span><span class="o">).</span><span class="na">first</span><span class="o">().</span><span class="na">text</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>–¢–µ–ø–µ—Ä—å —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å <em>crawler</em> –∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º—É –∫–ª–∞—Å—Å—É <code>LuceneIndexer</code> –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏:</p>
<p><em>crawler/src/main/java/crawler/App.java</em></p>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">crawler</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.log4j.Logger</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">App</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">crawlSeed</span> <span class="o">=</span> <span class="s">&quot;http://localhost:8080&quot;</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">(</span><span class="kd">final</span> <span class="n">LuceneIndexer</span> <span class="n">luceneIndexer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LuceneIndexer</span><span class="o">())</span> <span class="o">{</span>

            <span class="n">luceneIndexer</span><span class="o">.</span><span class="na">new_index</span><span class="o">();</span>

            <span class="cm">/* Start crawler and perform indexing */</span>

            <span class="k">new</span> <span class="n">SimpleCrawler</span><span class="o">(</span><span class="n">App</span><span class="o">.</span><span class="na">crawlSeed</span><span class="o">,</span> <span class="k">new</span> <span class="n">SimpleCrawler</span><span class="o">.</span><span class="na">ICrawlEvents</span><span class="o">()</span> <span class="o">{</span>

                <span class="cm">/* Proceed page - add to Lucene index */</span>

                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onVisit</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">html</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">seed</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">luceneIndexer</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="n">html</span><span class="o">);</span>
                <span class="o">}</span>

                <span class="cm">/* Skip any external links */</span>

                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">shouldVisit</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">seed</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">return</span> <span class="n">url</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="n">seed</span><span class="o">);</span>
                <span class="o">}</span>

            <span class="o">}).</span><span class="na">run</span><span class="o">();</span>

        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="kd">final</span> <span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">App</span><span class="o">.</span><span class="na">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&quot;Unable to start !&quot;</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –º—ã –ø–æ–¥–æ—à–ª–∏, –ø–æ–∂–∞–ª—É–π, –∫ –∫–ª—é—á–µ–≤–æ–º—É –º–æ–º–µ–Ω—Ç—É –¥–∞–Ω–Ω–æ–π —Å—Ç–∞—Ç—å–∏ - –ø—Ä–æ—Ü–µ—Å—Å—É —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞ –≤ <em>Lucene</em>. –ì–ª–∞–≤–Ω—ã–º –∫–ª–∞—Å—Å–æ–º —Ç—É—Ç —è–≤–ª—è–µ—Ç—Å—è <code>IndexWriter</code> - –∫–æ—Ç–æ—Ä–æ–º—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–Ω–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, –≥–¥–µ –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è —Ñ–∞–π–ª—ã –∏–Ω–¥–µ–∫—Å–∞. –û–ø—Ü–∏—è <code>OpenMode.CREATE</code> —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —É–¥–∞–ª—è—Ç—å —Å—Ç–∞—Ä—ã–π –∏–Ω–¥–µ–∫—Å, –µ—Å–ª–∏ —Ç–æ—Ç –Ω–∞ –º–æ–º–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –°–æ–≥–ª–∞—Å–Ω–æ <a href="https://lucene.apache.org/core/6_0_0/core/org/apache/lucene/index/IndexWriter.html" rel="nofollow">–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏</a>, <code>IndexWriter</code> –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π:</p>
<p><em>crawler/src/main/java/crawler/LuceneIndexer.java</em></p>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">crawler</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Closeable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.log4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.lucene.document.Document</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.lucene.document.Field</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.lucene.document.FieldType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.lucene.index.IndexOptions</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.lucene.index.IndexWriter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.lucene.index.IndexWriterConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.lucene.index.IndexWriterConfig.OpenMode</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.lucene.store.Directory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.lucene.store.FSDirectory</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">common.LuceneBinding</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">LuceneIndexer</span> <span class="kd">implements</span> <span class="n">Closeable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">LuceneIndexer</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>

    <span class="cm">/* IndexWriter is completely thread safe */</span>

    <span class="kd">private</span> <span class="n">IndexWriter</span> <span class="n">indexWriter</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">indexWriter</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">LuceneIndexer</span><span class="o">.</span><span class="na">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;Closing Index &lt; &quot;</span> <span class="o">+</span> 
                    <span class="n">LuceneBinding</span><span class="o">.</span><span class="na">INDEX_PATH</span> <span class="o">+</span> <span class="s">&quot; &gt; NumDocs: &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">indexWriter</span><span class="o">.</span><span class="na">numDocs</span><span class="o">());</span>
            <span class="k">this</span><span class="o">.</span><span class="na">indexWriter</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="k">this</span><span class="o">.</span><span class="na">indexWriter</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="n">LuceneIndexer</span><span class="o">.</span><span class="na">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;Index Closed OK!&quot;</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">IOException</span><span class="o">(</span><span class="s">&quot;Index already closed&quot;</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">new_index</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">Directory</span> <span class="n">directory</span> <span class="o">=</span> <span class="n">FSDirectory</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="n">LuceneBinding</span><span class="o">.</span><span class="na">INDEX_PATH</span><span class="o">);</span>
        <span class="kd">final</span> <span class="n">IndexWriterConfig</span> <span class="n">iwConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IndexWriterConfig</span><span class="o">(</span><span class="n">LuceneBinding</span><span class="o">.</span><span class="na">getAnalyzer</span><span class="o">());</span>
        <span class="n">iwConfig</span><span class="o">.</span><span class="na">setOpenMode</span><span class="o">(</span><span class="n">OpenMode</span><span class="o">.</span><span class="na">CREATE</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">indexWriter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IndexWriter</span><span class="o">(</span><span class="n">directory</span><span class="o">,</span> <span class="n">iwConfig</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">html</span><span class="o">)</span> <span class="o">{</span>

        <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="n">HtmlHelper</span><span class="o">.</span><span class="na">extractTitle</span><span class="o">(</span><span class="n">html</span><span class="o">);</span>
        <span class="kd">final</span> <span class="n">String</span> <span class="n">content</span> <span class="o">=</span> <span class="n">HtmlHelper</span><span class="o">.</span><span class="na">extractContent</span><span class="o">(</span><span class="n">html</span><span class="o">);</span>

        <span class="n">LuceneIndexer</span><span class="o">.</span><span class="na">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;***** &quot;</span> <span class="o">+</span> <span class="n">url</span> <span class="o">+</span> <span class="s">&quot; *****&quot;</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">title</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">LuceneIndexer</span><span class="o">.</span><span class="na">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="n">title</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">LuceneIndexer</span><span class="o">.</span><span class="na">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="n">content</span><span class="o">);</span>

        <span class="kd">final</span> <span class="n">Document</span> <span class="n">doc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="o">();</span>

        <span class="kd">final</span> <span class="n">FieldType</span> <span class="n">urlType</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FieldType</span><span class="o">();</span>
        <span class="n">urlType</span><span class="o">.</span><span class="na">setIndexOptions</span><span class="o">(</span><span class="n">IndexOptions</span><span class="o">.</span><span class="na">DOCS</span><span class="o">);</span>
        <span class="n">urlType</span><span class="o">.</span><span class="na">setStored</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">urlType</span><span class="o">.</span><span class="na">setTokenized</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
        <span class="n">urlType</span><span class="o">.</span><span class="na">setStoreTermVectorOffsets</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
        <span class="n">urlType</span><span class="o">.</span><span class="na">setStoreTermVectorPayloads</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
        <span class="n">urlType</span><span class="o">.</span><span class="na">setStoreTermVectorPositions</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
        <span class="n">urlType</span><span class="o">.</span><span class="na">setStoreTermVectors</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
        <span class="n">doc</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Field</span><span class="o">(</span><span class="n">LuceneBinding</span><span class="o">.</span><span class="na">URI_FIELD</span><span class="o">,</span> <span class="n">url</span><span class="o">,</span> <span class="n">urlType</span><span class="o">));</span>

        <span class="kd">final</span> <span class="n">FieldType</span> <span class="n">tokType</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FieldType</span><span class="o">();</span>
        <span class="n">tokType</span><span class="o">.</span><span class="na">setIndexOptions</span><span class="o">(</span><span class="n">IndexOptions</span><span class="o">.</span><span class="na">DOCS_AND_FREQS_AND_POSITIONS_AND_OFFSETS</span><span class="o">);</span>
        <span class="n">tokType</span><span class="o">.</span><span class="na">setStored</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">tokType</span><span class="o">.</span><span class="na">setTokenized</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">tokType</span><span class="o">.</span><span class="na">setStoreTermVectorOffsets</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">tokType</span><span class="o">.</span><span class="na">setStoreTermVectorPayloads</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">tokType</span><span class="o">.</span><span class="na">setStoreTermVectorPositions</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">tokType</span><span class="o">.</span><span class="na">setStoreTermVectors</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">title</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">doc</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Field</span><span class="o">(</span><span class="n">LuceneBinding</span><span class="o">.</span><span class="na">TITLE_FIELD</span><span class="o">,</span> <span class="n">title</span><span class="o">,</span> <span class="n">tokType</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="n">doc</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Field</span><span class="o">(</span><span class="n">LuceneBinding</span><span class="o">.</span><span class="na">CONTENT_FIELD</span><span class="o">,</span> <span class="n">content</span><span class="o">,</span> <span class="n">tokType</span><span class="o">));</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">indexWriter</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">indexWriter</span><span class="o">.</span><span class="na">addDocument</span><span class="o">(</span><span class="n">doc</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="kd">final</span> <span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">LuceneIndexer</span><span class="o">.</span><span class="na">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>–ï—Å–ª–∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞–∂–¥–æ–π html-—Å—Ç—Ä–∞–Ω–∏—á–∫–∏ –Ω–∞—à–µ–≥–æ —Å–∞–π—Ç–∞, —Ç–æ –ø–æ–º–∏–º–æ <span style="text-decoration: line-through;">–Ω–µ</span>–Ω–∞–≤—è–∑—á–∏–≤–æ–π —Ä–µ–∫–ª–∞–º—ã –∏ –ø—Ä–æ—á–µ–≥–æ –º—É—Å–æ—Ä–∞ –º–æ–∂–Ω–æ –≤—ã–¥–µ–ª–∏—Ç—å –¥–≤–µ –µ–¥–∏–Ω–∏—Ü—ã –±–æ–ª–µ–µ - –º–µ–Ω–µ–µ –ø–æ–ª–µ–∑–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏: <em>–Ω–∞–∑–≤–∞–Ω–∏–µ</em> (title) –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –∏ –µ—ë <em>—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ</em> (content). –ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ html –Ω–∞–º –ø–æ–º–æ–∂–µ—Ç —É–∂–µ —É–ø–æ–º—è–Ω—É—Ç–∞—è –≤—ã—à–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ <em>JSoup</em>, –ø–æ—Å–ª–µ —á–µ–≥–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å <code>Document</code> —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –ø–æ–ª—è–º–∏ –≤ –∏–Ω–¥–µ–∫—Å <em>Lucene</em>.</p>
<p><em>Lucene</em> –º–æ–∂–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å / –∏–∑–≤–ª–µ–∫–∞—Ç—å <a href="https://lucene.apache.org/core/6_0_0/core/org/apache/lucene/document/Field.html" rel="nofollow">—Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö</a>. –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ, –ø–µ—Ä–≤–æ–µ –ø–æ–ª–µ - url, –ø–∞—Ä–∞–º–µ—Ç—Ä <code>setStored(true)</code> —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —Ö—Ä–∞–Ω–∏—Ç—å –≤ –∏–Ω–¥–µ–∫—Å–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ (–Ω–µ–∏–∑–º–µ–Ω–Ω–æ–µ) –∑–Ω–∞—á–µ–Ω–∏–µ, –∞ –æ—Å—Ç–∞–ª—å–Ω—ã–µ <code>false</code> –Ω–∞ —Ç–æ, —á—Ç–æ –ø–æ–∏—Å–∫ –ø–æ —ç—Ç–æ–º—É –ø–æ–ª—é –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å—Å—è –Ω–µ –±—É–¥–µ—Ç, —Ç.–µ. —ç—Ç–æ –ø–æ–ª–µ –Ω–µ—Å–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–∞–π–¥–µ–Ω–Ω–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ, –∫–æ—Ç–æ—Ä—É—é –º—ã –ø–ª–∞–Ω–∏—Ä—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –±—É–¥—É—â–µ–º. –ü–æ–ª—è <em>title</em> –∏ <em>content</em> –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ - <code>setTokenized(true)</code> —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ç–æ, —á—Ç–æ –ø–æ –¥–∞–Ω–Ω–æ–º—É –ø–æ–ª—é –±—É–¥–µ—Ç –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å—Å—è –ø–æ–∏—Å–∫ –∞ —Ç–∞–∫–∂–µ –ø—Ä–æ—Å–∏—Ç <em>Lucene</em> –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º—ã –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –¥–∞–Ω–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –Ω–∞ —ç—Ç–∞–ø–µ —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞ (—Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä –∞–Ω–∞–ª–∏–∑–∞ - –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ–≤ –∏–∑ –Ω–∞–±–æ—Ä–∞ –±—É–∫–≤ –∏ –ø—Ä–æ–±–µ–ª–æ–≤ –º–µ–∂–¥—É –Ω–∏–º–∏), –ø–∞—Ä–∞–º–µ—Ç—Ä <code>setStoreTermVector(true)</code> –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–∑–∏—Ü–∏—è—Ö —Ç–µ—Ö –∏–ª–∏ –∏–Ω—ã—Ö —Å–ª–æ–≤ –≤ —Ç–µ–ª–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ - —Ç–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É—Å–∫–æ—Ä—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –≤—Ö–æ–∂–¥–µ–Ω–∏–π.</p>
<p>–ö–ª–∞—Å—Å <code>LuceneBinding</code> - —ç—Ç–æ —Å–≤–æ–µ–æ–±—Ä–∞–∑–Ω—ã–π –º–æ—Å—Ç –º–µ–∂–¥—É –∏–Ω–¥–µ–∫—Å–∞—Ç–æ—Ä–æ–º (<em>crawler</em>) –∏ –ø–æ–∏—Å–∫–æ–º (<code>SearchServlet</code>), –æ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±—â—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ –æ–±–æ–∏–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏:</p>
<p><em>common/src/main/java/common/LuceneBinding.java</em></p>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">common</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.nio.file.Path</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.file.Paths</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.lucene.analysis.Analyzer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.lucene.analysis.standard.StandardAnalyzer</span><span class="o">;</span>

<span class="cm">/* This class is used both by Crawler and SearchServlet */</span>

<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">LuceneBinding</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Path</span> <span class="n">INDEX_PATH</span> <span class="o">=</span> <span class="n">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span>
        <span class="n">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">&quot;user.home&quot;</span><span class="o">),</span> <span class="s">&quot;lucene-tutorial-index&quot;</span><span class="o">);</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">URI_FIELD</span> <span class="o">=</span> <span class="s">&quot;uri&quot;</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TITLE_FIELD</span> <span class="o">=</span> <span class="s">&quot;title&quot;</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">CONTENT_FIELD</span> <span class="o">=</span> <span class="s">&quot;content&quot;</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Analyzer</span> <span class="nf">getAnalyzer</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">StandardAnalyzer</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h3>–°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫</h3>
<p>–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–∞–º crawler –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω <em>Jetty</em> —Å–µ—Ä–≤–µ—Ä —Å —Å–∞–π—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π –º—ã —Ö–æ—Ç–∏–º –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å. –ß—Ç–æ–±—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å —Ä—É—Å—Å–∫–∏–µ –±—É–∫–≤—ã –≤ –∫–æ–Ω—Å–æ–ª–∏ <em>Windows</em> –º–æ–∂–µ—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –æ–±–æ–∑–Ω–∞—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∫–æ–¥–∏—Ä–æ–≤–∫—É <em>Cp866</em> –≤ —Ñ–∞–π–ª–µ <em>crawler/src/main/resources/log4j.properties</em></p>
<div class="highlight"><pre><span></span>~$ mvn clean install <span class="o">&amp;&amp;</span> bash -c <span class="s1">&#39;mvn -pl server/ jetty:run &amp; sleep 10 &amp;&amp; \</span>
<span class="s1">    mvn -pl crawler/ exec:java -Dexec.mainClass=&quot;crawler.App&quot; &amp; \</span>
<span class="s1">    trap &quot;kill -TERM -$$&quot; SIGINT ; wait&#39;</span>
...
INFO <span class="o">[</span>crawler.App.main<span class="o">()]</span> Closing Index &lt; /home/oleg/lucene-tutorial-index &gt; NumDocs: <span class="m">53</span>
INFO <span class="o">[</span>crawler.App.main<span class="o">()]</span> Index Closed OK!
Ctrl+C
</pre></div>


<p><a href="http://proiot.ru/blog/posts/2012/10/21/lucene-proverka-indeksa/">–î–∞–ª–µ–µ</a> –º—ã –±–µ–≥–ª–æ –∑–∞–≥–ª—è–Ω–µ–º –≤ –∏–Ω–¥–µ–∫—Å, –ø–æ—Å–ª–µ —á–µ–≥–æ —Ä–µ–∞–ª–∏–∑—É–µ–º –ø—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫.</p>
<p><a href="http://proiot.ru/blog/posts/2012/10/17/lucene-protsess-indeksatsii/lucene-tutorial.zip">–ò—Å—Ö–æ–¥–Ω–∏–∫–∏</a></p>
    </div><!-- /.entry-content -->
  </article>
</section>

<div class="body" style="margin-bottom: 2em">
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- proiot-index -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6247427373315098"
     data-ad-slot="2711782349"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>

<div class="body" id="proiot-comments">
  <div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname = 'mazko';
      var disqus_identifier = 'blog/posts/2012/10/17/lucene-protsess-indeksatsii/';
      var disqus_url = 'http://proiot.ru/blog/posts/2012/10/17/lucene-protsess-indeksatsii/';
      (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//mazko.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the comments.</noscript>
  </div>
</div>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a rel="nofollow" href="http://getpelican.com/">Pelican</a></li>
                            <li><a rel="nofollow" href="http://python.org/">Python.org</a></li>
                            <li><a rel="nofollow" href="http://jinja.pocoo.org/">Jinja2</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://proiot.ru/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a rel="nofollow" href="http://github.com/mazko">github</a></li>
                            <li><a rel="nofollow" href="http://linkedin.com/in/mazko">linkedin</a></li>
                            <li><a rel="nofollow" href="http://stackoverflow.com/users/281102/oleg-mazko">stackoverflow</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

<script type="text/javascript">
    var disqus_shortname = 'mazko';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>