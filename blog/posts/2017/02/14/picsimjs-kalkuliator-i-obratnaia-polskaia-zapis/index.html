<!DOCTYPE html>
<html lang="ru">
<head>
        <meta charset="utf-8" />
        <title>PICSim.js - –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∏ –æ–±—Ä–∞—Ç–Ω–∞—è –ø–æ–ª—å—Å–∫–∞—è –∑–∞–ø–∏—Å—å</title>
        <link rel="stylesheet" href="https://mazko.github.io/blog/theme/css/main.css" />
        <link href="https://mazko.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="üè† –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –í—Å–µ–≥–æ üöó Atom Feed" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
<a rel="nofollow" href="http://github.com/mazko">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />
</a>
        <header id="banner" class="body">
                <h1><a href="https://mazko.github.io/">üè† –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –í—Å–µ–≥–æ üöó </a></h1>
                <nav><ul>
                    <li><a href="https://mazko.github.io/blog/category/admin/">Admin</a></li>
                    <li><a href="https://mazko.github.io/blog/category/electronics/">Electronics</a></li>
                    <li class="active"><a href="https://mazko.github.io/blog/category/embedded/">Embedded</a></li>
                    <li><a href="https://mazko.github.io/blog/category/iot/">IoT</a></li>
                    <li><a href="https://mazko.github.io/blog/category/java/">Java</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="https://mazko.github.io/blog/posts/2017/02/14/picsimjs-kalkuliator-i-obratnaia-polskaia-zapis/" rel="bookmark"
           title="Permalink to PICSim.js - –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∏ –æ–±—Ä–∞—Ç–Ω–∞—è –ø–æ–ª—å—Å–∫–∞—è –∑–∞–ø–∏—Å—å">PICSim.js - –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∏ –æ–±—Ä–∞—Ç–Ω–∞—è –ø–æ–ª—å—Å–∫–∞—è –∑–∞–ø–∏—Å—å</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-02-14T00:00:00+02:00">
                –í—Ç 14 —Ñ–µ–≤—Ä–∞–ª—è 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://mazko.github.io/blog/author/oleg-mazko/">Oleg Mazko</a>
        </address>
<p>In <a href="https://mazko.github.io/blog/category/embedded/">Embedded</a>.</p>
<p>tags: <a href="https://mazko.github.io/blog/tag/picsim">picsim</a> <a href="https://mazko.github.io/blog/tag/re2c">re2c</a> <a href="https://mazko.github.io/blog/tag/regex">regex</a> </p>
</footer><!-- /.post-info -->      <p>–û–±—Ä–∞—Ç–Ω–∞—è –ü–æ–ª—å—Å–∫–∞—è –ó–∞–ø–∏—Å—å –∞–Ω–≥–ª. (Reverse Polish Notation, RPN) –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç —Å–∫–æ–±–æ–∫ –≤ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏—è—Ö. –°–Ω–∞—á–∞–ª–∞ —Å–ª–µ–¥—É—é—Ç –¥–≤–∞ –æ–ø–µ—Ä–∞–Ω–¥–∞ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏, –∞ –∑–∞—Ç–µ–º –∑–Ω–∞–∫ –æ–ø–µ—Ä–∞—Ü–∏–∏. –ù–∞–ø—Ä–∏–º–µ—Ä <code>4 2 + = 4 + 2 = 6</code> –∏–ª–∏ <code>4 2 * 3 5 / - = (4 * 2) - (3 / 5) = 7.4</code>. –ü—Ä–æ–≥—Ä–∞–º–º–∞-—Ç—Ä–∞–Ω—Å–ª—è—Ç–æ—Ä RPN-–≤—ã—Ä–∞–∂–µ–Ω–∏–π –æ—Å–Ω–æ–≤—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç–µ–∫–µ - –∫–∞–∂–¥—ã–π –æ–ø–µ—Ä–∞–Ω–¥ –ø–æ—Å—ã–ª–∞–µ—Ç—Å—è –≤ —Å—Ç–µ–∫, –∞ –µ—Å–ª–∏ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –æ–ø–µ—Ä–∞—Ç–æ—Ä, —Ç–æ –∏–∑ —Å—Ç–µ–∫–∞ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –¥–≤–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –æ–ø–µ—Ä–∞–Ω–¥–∞ –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
–æ–ø–µ—Ä–∞—Ü–∏—è, –ø–æ—Å–ª–µ —á–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å—ã–ª–∞–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ –≤ —Å—Ç–µ–∫. –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –Ω–∞ –±–∞–∑–µ –æ–±—Ä–∞—Ç–Ω–æ–π –ø–æ–ª—å—Å–∫–æ–π –∑–∞–ø–∏—Å–∏ –ø–æ–¥—Ä–æ–±–Ω–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∞ –≤ –∫–Ω–∏–≥–µ ¬´–Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –°–∏¬ª –ë—Ä–∞–π–∞–Ω–∞ –ö–µ—Ä–Ω–∏–≥–∞–Ω–∞ –∏ –î–µ–Ω–Ω–∏—Å–∞ –†–∏—Ç—á–∏ (–ø–æ—Å–ª–µ–¥–Ω–∏–π –æ–¥–∏–Ω –∏–∑ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∞–≤—Ç–æ—Ä–æ–≤ –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —è–∑—ã–∫–∞ –°–∏). –í –æ–±—â–µ–º —Å–ª—É—á–∞–µ –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–µ—à–µ–Ω–∏—è –ø–æ–¥–æ–±–Ω—ã—Ö –∑–∞–¥–∞—á —Å–≤–æ–¥–∏—Ç—Å—è –∫ –¥–≤—É–º —ç—Ç–∞–ø–∞–º:</p>
<ul>
<li>
<p>–ª–µ–∫—Å–∏—á–µ—Å–∫–æ–π –∞–Ω–∞–ª–∏–∑ - —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∏ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ª–µ–∫—Å–µ–º –∏–∑ –≤—Ö–æ–¥–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–∏–º–≤–æ–ª–æ–≤. –í —Å–ª—É—á–∞–µ RPN –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –Ω–∞ –≤—ã—Ö–æ–¥–µ –ø–æ–ª—É—á–∞–µ–º —á–∏—Å–ª–∞ –∏ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</p>
</li>
<li>
<p>—Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ - –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ª–µ–∫—Å–µ–º –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä–∞—è —Ö–æ—Ä–æ—à–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏. –í —É–ø—Ä–æ—â—ë–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –¥–ª—è RPN –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ —ç—Ç–æ —Å—Ç–µ–∫</p>
</li>
</ul>
<p>–û—à–∏–±–∫–∏ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã –º–æ–≥—É—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –Ω–∞ –æ–±–æ–∏—Ö —ç—Ç–∞–ø–∞—Ö - –∑–∞ –≤–≤–æ–¥–æ–º –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä –±—É–∫–≤) –¥–æ–ª–∂–µ–Ω —Å–ª–µ–¥–∏—Ç—å –ª–µ–∫—Å–∏—á–µ—Å–∫–æ–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä, –∞ –≤–æ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ —Å—Ç–µ–∫–µ —ç—Ç–æ —É–∂–µ –∑–æ–Ω–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.</p>
<p><a href="https://mazko.github.io/blog/posts/2017/02/14/picsimjs-kalkuliator-i-obratnaia-polskaia-zapis/rpn.zip">–∏—Å—Ö–æ–¥–Ω–∏–∫–∏</a> | <a href="https://mazko.github.io/blog/posts/2017/02/14/picsimjs-kalkuliator-i-obratnaia-polskaia-zapis/main.hex">hex</a> | <a href="http://mazko.github.io/picsim.js/da43c25591f9e336ec3229d51fbdb495">picsim.js</a></p>
<p><img alt="screenshot" src="https://mazko.github.io/blog/posts/2017/02/14/picsimjs-kalkuliator-i-obratnaia-polskaia-zapis/ui.gif" style="width:100%; border:1px solid #ddd;"></p>
<p>–ü—Ä–∏ –≤—ã–±–æ—Ä–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ª–µ–∫—Å–∏—á–µ—Å–∫–æ–≥–æ / —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ —Å—Ç–æ–∏—Ç —É—á–∏—Ç—ã–≤–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤. –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –Ω–µ –¥–æ–ª–∂–µ–Ω –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç —Å–∏—Å—Ç–µ–º—ã –∏ —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫, –ø–æ—ç—Ç–æ–º—É Flex/Bison –æ—Ç–ø–∞–¥–∞—é—Ç —Å—Ä–∞–∑—É —Ç.–∫. –∑–∞–≤—è–∑–∞–Ω—ã –Ω–∞ POSIX, –∞ —É –Ω–∞—Å —Ç—É—Ç –≥–æ–ª–æ–µ –∂–µ–ª–µ–∑–æ. –¢–∞–∫–∂–µ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä—ã –¥–ª—è PIC18 –∏ –Ω–∏–∂–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–¥–∞ –¥–∞). –í–æ–±—â–µ–º –æ—Å–æ–±–æ –Ω–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å—Å—è. –ù–æ –≤—Å—ë –∂–µ –Ω–∞—à–µ–ª—Å—è –æ–¥–∏–Ω –æ—á–µ–Ω—å –¥–æ—Å—Ç–æ–π–Ω—ã–π –∫–∞–Ω–¥–∏–¥–∞—Ç - <a href="http://re2c.org/" rel="nofollow">re2c</a>. –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ª–µ–∫—Å–∏—á–µ—Å–∫–∏—Ö –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤ re2c –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂ –Ω–∞ Flex - –ø—Ä–∞–≤–∏–ª–∞ –∑–∞–¥–∞—é—Ç—Å—è –≤ –≤–∏–¥–µ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π —Å–ª–µ–≤–∞, –∫–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–ø—Ä–∞–≤–∞. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ –ø–æ—Ö–æ–∂ –Ω–∞ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–π –∏ –±–µ–∑ –ø—Ä–æ–±–ª–µ–º —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –¥–∞–∂–µ –ø–æ–¥ bare metal. –§—É–Ω–∫—Ü–∏—è <code>lex_flt</code> —ç—Ç–æ –æ–±–ª–µ–≥—á—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è <code>atof</code>/<code>strtod</code>, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –¥–ª—è RPN –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞.</p>
<p><em>stack.c</em></p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdint.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdbool.h&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="kt">float</span> <span class="n">data</span><span class="p">[</span><span class="n">RPN_MAX_CHARS</span> <span class="o">/</span> <span class="mi">2</span><span class="p">];</span>
  <span class="kt">uint8_t</span> <span class="n">sp</span><span class="p">;</span>
<span class="p">}</span> <span class="n">_stack</span><span class="p">;</span>

<span class="c1">// 0 == SUCCESS</span>
<span class="k">static</span> <span class="kt">bool</span> <span class="nf">stack_push</span><span class="p">(</span><span class="k">const</span> <span class="kt">float</span> <span class="n">f</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">_stack</span><span class="p">.</span><span class="n">sp</span> <span class="o">&lt;</span> <span class="k">sizeof</span> <span class="n">_stack</span><span class="p">.</span><span class="n">data</span> <span class="o">/</span> <span class="k">sizeof</span> <span class="o">*</span><span class="n">_stack</span><span class="p">.</span><span class="n">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">_stack</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">_stack</span><span class="p">.</span><span class="n">sp</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 0 == SUCCESS</span>
<span class="k">static</span> <span class="kt">bool</span> <span class="nf">stack_pop</span><span class="p">(</span><span class="kt">float</span> <span class="o">*</span> <span class="k">const</span> <span class="n">f</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">_stack</span><span class="p">.</span><span class="n">sp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">*</span><span class="n">f</span> <span class="o">=</span> <span class="n">_stack</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="o">--</span><span class="n">_stack</span><span class="p">.</span><span class="n">sp</span><span class="p">];</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">stack_clr</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">_stack</span><span class="p">.</span><span class="n">sp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p><em>rpn.re.c</em></p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdbool.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;stack.c&quot;</span><span class="cp"></span>

<span class="c1">// 0 == SUCCESS</span>
<span class="k">static</span> <span class="kt">bool</span> <span class="nf">lex_flt</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">e</span><span class="p">,</span> <span class="kt">float</span> <span class="o">*</span> <span class="k">const</span> <span class="n">f</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="n">neg</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
  <span class="o">*</span><span class="n">f</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="cm">/*!re2c</span>
<span class="cm">      re2c:yyfill:enable = 0;</span>
<span class="cm">      re2c:define:YYCTYPE = char;</span>
<span class="cm">      re2c:define:YYCURSOR = s;</span>

<span class="cm">      &quot;-&quot;    { neg = true; goto mant_int; }</span>
<span class="cm">      &quot;&quot;     { goto mant_int; }</span>
<span class="cm">  */</span>
<span class="nl">mant_int</span><span class="p">:</span>
  <span class="cm">/*!re2c</span>
<span class="cm">      &quot;.&quot;    { goto mant_frac; }</span>
<span class="cm">      &quot;&quot;     { goto end; }</span>
<span class="cm">      [0-9]  { *f = (*f * 10) + (s[-1] - &#39;0&#39;); goto mant_int; }</span>
<span class="cm">  */</span>
<span class="nl">mant_frac</span><span class="p">:</span>
  <span class="cm">/*!re2c</span>
<span class="cm">      &quot;&quot;     { goto end; }</span>
<span class="cm">      [0-9]  { *f += (x /= 10) * (s[-1] - &#39;0&#39;); goto mant_frac; }</span>
<span class="cm">  */</span>
<span class="nl">end</span><span class="p">:</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">neg</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">*</span><span class="n">f</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">e</span> <span class="o">!=</span> <span class="n">s</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 0 == SUCCESS</span>
<span class="k">static</span> <span class="kt">bool</span> <span class="nf">cc</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">float</span> <span class="n">o1</span><span class="p">,</span> <span class="n">o2</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">stack_pop</span><span class="p">(</span><span class="o">&amp;</span><span class="n">o2</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">stack_pop</span><span class="p">(</span><span class="o">&amp;</span><span class="n">o1</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="sc">&#39;+&#39;</span><span class="o">:</span> <span class="k">return</span> <span class="n">stack_push</span><span class="p">(</span><span class="n">o1</span> <span class="o">+</span> <span class="n">o2</span><span class="p">);</span>
      <span class="k">case</span> <span class="sc">&#39;-&#39;</span><span class="o">:</span> <span class="k">return</span> <span class="n">stack_push</span><span class="p">(</span><span class="n">o1</span> <span class="o">-</span> <span class="n">o2</span><span class="p">);</span>
      <span class="k">case</span> <span class="sc">&#39;/&#39;</span><span class="o">:</span> <span class="k">return</span> <span class="n">o2</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">stack_push</span><span class="p">(</span><span class="n">o1</span> <span class="o">/</span> <span class="n">o2</span><span class="p">);</span>
      <span class="k">case</span> <span class="sc">&#39;*&#39;</span><span class="o">:</span> <span class="k">return</span> <span class="n">stack_push</span><span class="p">(</span><span class="n">o1</span> <span class="o">*</span> <span class="n">o2</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span> 
  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 0 == SUCCESS</span>
<span class="k">static</span> <span class="kt">bool</span> <span class="nf">lex</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">cur</span><span class="p">)</span> <span class="p">{</span>

  <span class="c1">// YYMARKER is needed because rules overlap:</span>
  <span class="c1">// it backups input position of the longest successful match</span>
  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">YYMARKER</span><span class="p">;</span>

  <span class="k">for</span><span class="p">(;;)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">tok</span> <span class="o">=</span> <span class="n">cur</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">f</span><span class="p">;</span>
    <span class="cm">/*!re2c</span>
<span class="cm">        re2c:yyfill:enable = 0;</span>
<span class="cm">        re2c:define:YYCTYPE = char;</span>
<span class="cm">        re2c:define:YYCURSOR = cur;</span>

<span class="cm">        flt = &quot;-&quot; ? ([0-9]+ | [0-9]* &quot;.&quot; [0-9]+);</span>
<span class="cm">        mop = [-+*\/];</span>

<span class="cm">        *       { return true; }</span>
<span class="cm">        &quot;\x00&quot;  { return false; }</span>
<span class="cm">        flt     { if (lex_flt(tok, cur, &amp;f) || stack_push(f)) return true; continue; }</span>
<span class="cm">        &quot; &quot; flt { if (lex_flt(tok + 1, cur, &amp;f) || stack_push(f)) return true; continue; }</span>
<span class="cm">        mop     { if (cc(*tok)) return true; continue; }</span>
<span class="cm">        &quot; &quot; mop { if (cc(*(tok + 1))) return true; continue; }</span>
<span class="cm">    */</span>
  <span class="p">}</span>

<span class="p">}</span>

<span class="c1">// 0 == SUCCESS</span>
<span class="kt">bool</span> <span class="nf">rpn</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">cur</span><span class="p">,</span> <span class="kt">float</span> <span class="o">*</span> <span class="k">const</span> <span class="n">f</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">stack_clr</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">lex</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span> <span class="o">||</span> <span class="n">stack_pop</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>–†–∞–±–æ—Ç–∞ —Å —Å–∏–º–≤–æ–ª—å–Ω—ã–º <a href="https://mazko.github.io/blog/posts/2017/01/27/picsimjs-simvolnyi-displei-na-baze-hd44780/">–¥–∏—Å–ø–ª–µ–µ–º</a> –∏ <a href="https://mazko.github.io/blog/posts/2017/01/30/picsimjs-matrichnaia-klaviatura/">–º–∞—Ç—Ä–∏—á–Ω–æ–π</a> –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π –æ–ø–∏—Å—ã–≤–∞–ª–∏—Å—å –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª–µ.</p>
<p>–î–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤—ã—Ä–∞–∂–µ–Ω–∏–π –∏–∑ –æ–±—ã—á–Ω–æ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä <code>3 + 4 * (2 - 1)</code>) –∏–Ω—Ñ–∏–∫—Å–Ω–æ–π –Ω–æ—Ç–∞—Ü–∏–∏ –≤ –ø–æ—Å—Ç—Ñ–∏–∫—Å–Ω—É—é (RPN) —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º ¬´—Å–æ—Ä—Ç–∏—Ä–æ–≤–æ—á–Ω–∞—è —Å—Ç–∞–Ω—Ü–∏—è¬ª, –∫–æ—Ç–æ—Ä—ã–π —Ç–∞–∫ –∂–µ –∫–∞–∫ –∏ RPN –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ —Å—Ç–µ–∫–µ –∏ –ª–µ–≥–∫–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ–¥ –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –Ω–µ—Å–ª–æ–∂–Ω–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–ª—è –æ–±—ã—á–Ω—ã–π –ª—é–¥–µ–π.</p>
<p>–ï—â—ë —Ä–∞–∑ —Å—Å—ã–ª–∫–∞ –Ω–∞ <a href="https://mazko.github.io/blog/posts/2017/02/14/picsimjs-kalkuliator-i-obratnaia-polskaia-zapis/rpn.zip">–∏—Å—Ö–æ–¥–Ω–∏–∫–∏</a> RPN-–∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞. </p>
    </div><!-- /.entry-content -->
  </article>
</section>


<div class="body" id="proiot-comments">
  <div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname = 'mazko';
      var disqus_identifier = 'blog/posts/2017/02/14/picsimjs-kalkuliator-i-obratnaia-polskaia-zapis/';
      var disqus_url = 'https://mazko.github.io/blog/posts/2017/02/14/picsimjs-kalkuliator-i-obratnaia-polskaia-zapis/';
      (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//mazko.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the comments.</noscript>
  </div>
</div>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a rel="nofollow" href="http://getpelican.com/">Pelican</a></li>
                            <li><a rel="nofollow" href="http://python.org/">Python.org</a></li>
                            <li><a rel="nofollow" href="http://jinja.pocoo.org/">Jinja2</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://mazko.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a rel="nofollow" href="http://github.com/mazko">github</a></li>
                            <li><a rel="nofollow" href="http://linkedin.com/in/mazko">linkedin</a></li>
                            <li><a rel="nofollow" href="http://stackoverflow.com/users/281102/oleg-mazko">stackoverflow</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

<script type="text/javascript">
    var disqus_shortname = 'mazko';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>