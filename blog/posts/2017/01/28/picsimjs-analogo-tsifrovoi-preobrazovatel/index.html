<!DOCTYPE html>
<html lang="ru">
<head>
        <meta charset="utf-8" />
        <title>PICSim.js - –∞–Ω–∞–ª–æ–≥–æ-—Ü–∏—Ñ—Ä–æ–≤–æ–π –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å</title>
        <link rel="stylesheet" href="https://mazko.github.io/blog/theme/css/main.css" />
        <link href="https://mazko.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="üè† –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –í—Å–µ–≥–æ üöó Atom Feed" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://mazko.github.io/">üè† –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –í—Å–µ–≥–æ üöó </a></h1>
                <nav><ul>
                    <li><a href="https://mazko.github.io/blog/category/admin/">Admin</a></li>
                    <li><a href="https://mazko.github.io/blog/category/electronics/">Electronics</a></li>
                    <li class="active"><a href="https://mazko.github.io/blog/category/embedded/">Embedded</a></li>
                    <li><a href="https://mazko.github.io/blog/category/iot/">IoT</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="https://mazko.github.io/blog/posts/2017/01/28/picsimjs-analogo-tsifrovoi-preobrazovatel/" rel="bookmark"
           title="Permalink to PICSim.js - –∞–Ω–∞–ª–æ–≥–æ-—Ü–∏—Ñ—Ä–æ–≤–æ–π –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å">PICSim.js - –∞–Ω–∞–ª–æ–≥–æ-—Ü–∏—Ñ—Ä–æ–≤–æ–π –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-01-28T00:00:00+02:00">
                –°–± 28 —è–Ω–≤–∞—Ä—è 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://mazko.github.io/blog/author/oleg-mazko/">Oleg Mazko</a>
        </address>
<p>In <a href="https://mazko.github.io/blog/category/embedded/">Embedded</a>.</p>
<p>tags: <a href="https://mazko.github.io/blog/tag/picsim">picsim</a> <a href="https://mazko.github.io/blog/tag/atsp">–ê–¶–ü</a> </p>
</footer><!-- /.post-info -->      <p>–ö–∞–∫ –º—ã —É–∂–µ <a href="https://mazko.github.io/blog/posts/2017/01/14/picsimjs-shirotno-impulsnaia-moduliatsiia/">–∑–Ω–∞–µ–º</a>, —Ü–∏—Ñ—Ä–æ-–∞–Ω–∞–ª–æ–≥–æ–≤—ã–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª–∏ (–¶–ê–ü, DAC) –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç –¥–∏—Å–∫—Ä–µ—Ç–Ω—ã–π (–¥–≤–æ–∏—á–Ω—ã–π) –∫–æ–¥ –≤ –∞–Ω–∞–ª–æ–≥–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª - –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ. –ù–µ –º–µ–Ω–µ–µ –≤–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–Ω—ã–º –≤ —Ü–∏—Ñ—Ä–æ–≤–æ–π —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–µ —è–≤–ª—è–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ - –∞–Ω–∞–ª–æ–≥–æ-—Ü–∏—Ñ—Ä–æ–≤–æ–π –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å (–ê–¶–ü, –∞–Ω–≥–ª. Analog-to-digital converter, ADC). –ù–∞–∏–±–æ–ª–µ–µ –≤–∞–∂–Ω—ã–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏ –ê–¶–ü —è–≤–ª—è—é—Ç—Å—è —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å/—Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ - –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤–µ–ª–∏—á–∏–Ω—ã –∞–Ω–∞–ª–æ–≥–æ–≤–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ, –∞ —Ç–∞–∫–∂–µ —á–∞—Å—Ç–æ—Ç–∞ –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü–∏–∏ (Sampling rate) - —á–∞—Å—Ç–æ—Ç–∞ –≤—ã–±–æ—Ä–∫–∏ —Ü–∏—Ñ—Ä–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –∏–∑ –∞–Ω–∞–ª–æ–≥–æ–≤–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞.</p>
<p>–ú–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä PIC18F4620 –∏–º–µ–µ—Ç –Ω–∞ –±–æ—Ä—Ç—É –æ–¥–∏–Ω –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–π –ê–¶–ü —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å—é 10 <a href="https://bc.js.org/">–±–∏—Ç</a> <code>2^10=1024</code> —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —á–∞—Å—Ç–æ—Ç–æ–π –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü–∏–∏ (–µ—Å–ª–∏ –≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—é) 100 —Ç—ã—Å—è—á –≤—ã–±–æ—Ä–æ–∫ –≤ —Å–µ–∫—É–Ω–¥—É. –¢–∞–∫–∂–µ –≤ –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω –º—É–ª—å—Ç–∏–ø–ª–µ–∫—Å–æ—Ä, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –≤ –Ω—É–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å –Ω–∞ –≤—Ö–æ–¥ –ê–¶–ü 13 —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –Ω–æ–≥. –í –∫–∞—á–µ—Å—Ç–≤–µ –æ–ø–æ—Ä–Ω–æ–≥–æ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è –¥–ª—è –ê–¶–ü –º–æ–∂–µ—Ç —Å–ª—É–∂–∏—Ç—å –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –ø–∏—Ç–∞–Ω–∏—è Vdd/Vss (–æ–±—ã—á–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞), —Ç–∞–∫ –∏ –≤–Ω–µ—à–Ω–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–∞ –Ω–æ–≥–∞—Ö 4 –∏ 5 (AN2/AN3). –ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ –Ω–∞ –≤—Ö–æ–¥–µ –ê–¶–ü –Ω–µ –¥–æ–ª–∂–Ω–æ –≤—ã—Ö–æ–¥–∏—Ç—å –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –æ–ø–æ—Ä–Ω–æ–≥–æ.</p>
<p><a href="https://mazko.github.io/blog/posts/2017/01/28/picsimjs-analogo-tsifrovoi-preobrazovatel/config-4620.h">config.h</a> | <a href="https://mazko.github.io/blog/posts/2017/01/27/picsimjs-simvolnyi-displei-na-baze-hd44780/">liquid-crystal.c</a> | <a href="https://mazko.github.io/blog/posts/2017/01/28/picsimjs-analogo-tsifrovoi-preobrazovatel/main.hex">hex</a> | <a href="http://mazko.github.io/picsim.js/b1bb487dc063ae1128e98372a7983519">picsim.js</a></p>
<p><img alt="screenshot" src="https://mazko.github.io/blog/posts/2017/01/28/picsimjs-analogo-tsifrovoi-preobrazovatel/ui.gif" style="width:100%; border:1px solid #ddd;"></p>
<p>–†–∞–±–æ—Ç–∞ —Å —Å–∏–º–≤–æ–ª—å–Ω—ã–º –¥–∏—Å–ø–ª–µ–µ–º –æ–ø–∏—Å—ã–≤–∞–ª–∞—Å—å –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º <a href="https://mazko.github.io/blog/posts/2017/01/27/picsimjs-simvolnyi-displei-na-baze-hd44780/">–º–∞—Ç–µ—Ä–∏–∞–ª–µ</a>. –¢—É—Ç –º—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏ —Ñ—É–Ω–∫—Ü–∏—é <code>putch</code>, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å LCD —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –° <code>printf</code>. –ü–æ—Å–∫–æ–ª—å–∫—É –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –¥–ª–∏–Ω–∞ –≤—ã–≤–æ–¥–∏–º–æ–π –Ω–∞ –¥–∏—Å–ø–ª–µ–π —Å—Ç—Ä–æ–∫–∏ –≤—Å–µ–≥–¥–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–∞, –Ω–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –µ–≥–æ –æ—á–∏—â–∞—Ç—å - –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –∫—É—Ä—Å–æ—Ä –¥–æ–º–æ–π –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –Ω–æ–≤—ã–º –≤—ã–∑–æ–≤–æ–º <code>printf</code>.</p>
<div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">  xc8 --chip=18f4620 main.c</span>
<span class="cm">*/</span>

<span class="cp">#define _XTAL_FREQ 5e4</span>

<span class="cp">#include</span> <span class="cpf">&lt;xc.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdint.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;config-4620.h&quot;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&quot;liquid-crystal.c&quot;</span><span class="cp"></span>

<span class="c1">// http://microchip.wikidot.com/faq:29</span>
<span class="kt">void</span> <span class="nf">putch</span><span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">byte</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">lcd_dat</span><span class="p">(</span><span class="n">byte</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">uint32_t</span> <span class="n">adc_samples_counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="c1">// lcd</span>
  <span class="n">PORTD</span> <span class="o">=</span> <span class="n">TRISD</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">PORTE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">TRISE</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// ADC input RE0</span>

  <span class="c1">// ADC analog input RE0</span>
  <span class="n">ADCON0bits</span><span class="p">.</span><span class="n">CHS3</span> <span class="o">=</span> <span class="n">ADCON0bits</span><span class="p">.</span><span class="n">CHS1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">ADCON0bits</span><span class="p">.</span><span class="n">CHS2</span> <span class="o">=</span> <span class="n">ADCON0bits</span><span class="p">.</span><span class="n">CHS0</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">ADCON0bits</span><span class="p">.</span><span class="n">ADON</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="n">lcd_init</span><span class="p">();</span>
  <span class="n">lcd_no_cursor</span><span class="p">();</span>
  <span class="n">lcd_no_blink</span><span class="p">();</span>

  <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ADCON0bits</span><span class="p">.</span><span class="n">GO</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>          <span class="c1">// start ADC conversion</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">ADCON0bits</span><span class="p">.</span><span class="n">GO</span> <span class="o">==</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// wait untill conversion finish</span>
    <span class="n">lcd_home</span><span class="p">();</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%4d:0x%04x&quot;</span><span class="p">,</span>
      <span class="p">(((</span><span class="kt">uint16_t</span><span class="p">)</span><span class="n">ADRESH</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">ADRESL</span><span class="o">&gt;&gt;</span><span class="mi">6</span><span class="p">),</span>
      <span class="o">++</span><span class="n">adc_samples_counter</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>–ö–∞–∫ –Ω–µ—Ç—Ä—É–¥–Ω–æ –¥–æ–≥–∞–¥–∞—Ç—å—Å—è –ø–æ –∫–∞—Ä—Ç–∏–Ω–∫–µ —É –¥–∞–Ω–Ω–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏ –æ–ø–æ—Ä–Ω–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ 5 –í–æ–ª—å—Ç. –° –ø–æ–º–æ—â—å—é –±–∏—Ç–æ–≤ CHS3-CHS0 –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è —Å –∫–∞–∫–æ–≥–æ –≤—ã–≤–æ–¥–∞ –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –∞–Ω–∞–ª–æ–≥–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª –ø–æ—Å—Ç—É–ø–∞–µ—Ç –Ω–∞ –≤—Ö–æ–¥ –ê–¶–ü - –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ —ç—Ç–æ RE0. –ë–∏—Ç ADON –≤–∫–ª—é—á–∞–µ—Ç –ê–¶–ü, –¥–ª—è —Å—Ç–∞—Ä—Ç–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ –≤—ã—Å—Ç–∞–≤–∏—Ç—å —Ñ–ª–∞–≥ GO, –ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ—Ç —Ñ–ª–∞–≥ –±—É–¥–µ—Ç —Å–±—Ä–æ—à–µ–Ω –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏). –¢–∞–∫ –∫–∞–∫ —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ 8 –±–∏—Ç, —á—Ç–æ –º–µ–Ω—å—à–µ —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç–∏ –ê–¶–ü, —Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ä–∞–∑–º–µ—â–∞–µ—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤ –¥–≤—É—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ö - ADRESH –∏ ADRESL. –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ 10 –±–∏—Ç–Ω–æ–≥–æ —á–∏—Å–ª–∞ –≤ —ç—Ç–∏—Ö –¥–≤—É—Ö —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ –∑–∞–¥–∞—ë—Ç—Å—è –±–∏—Ç–æ–º ADFM, —Ö–æ—Ç—è –Ω–∞–¥–æ–±–Ω–æ—Å—Ç—å –∑–Ω–∞—Ç—å –æ –µ–≥–æ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç —Ä–µ–¥–∫–æ.</p>
<p><a href="https://mazko.github.io/blog/posts/2017/01/30/picsimjs-matrichnaia-klaviatura/">–î–∞–ª–µ–µ</a> –º–∞—Ç—Ä–∏—á–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞.</p>
    </div><!-- /.entry-content -->
  </article>
</section>


<div class="body" id="proiot-comments">
  <div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname = 'mazko';
      var disqus_identifier = 'blog/posts/2017/01/28/picsimjs-analogo-tsifrovoi-preobrazovatel/';
      var disqus_url = 'https://mazko.github.io/blog/posts/2017/01/28/picsimjs-analogo-tsifrovoi-preobrazovatel/';
      (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//mazko.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the comments.</noscript>
  </div>
</div>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a rel="nofollow" href="http://getpelican.com/">Pelican</a></li>
                            <li><a rel="nofollow" href="http://python.org/">Python.org</a></li>
                            <li><a rel="nofollow" href="http://jinja.pocoo.org/">Jinja2</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://mazko.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a rel="nofollow" href="http://github.com/mazko">github</a></li>
                            <li><a rel="nofollow" href="http://linkedin.com/in/mazko">linkedin</a></li>
                            <li><a rel="nofollow" href="http://stackoverflow.com/users/281102/oleg-mazko">stackoverflow</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

<script type="text/javascript">
    var disqus_shortname = 'mazko';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>