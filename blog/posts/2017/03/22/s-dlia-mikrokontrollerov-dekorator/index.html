<!DOCTYPE html>
<html lang="ru">
<head>
        <meta charset="utf-8" />
        <title>–°++ –¥–ª—è –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ - ¬´–î–µ–∫–æ—Ä–∞—Ç–æ—Ä¬ª</title>
        <link rel="stylesheet" href="https://mazko.github.io/blog/theme/css/main.css" />
        <link href="https://mazko.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="üè† –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –í—Å–µ–≥–æ üöó Atom Feed" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://mazko.github.io/">üè† –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –í—Å–µ–≥–æ üöó </a></h1>
                <nav><ul>
                    <li><a href="https://mazko.github.io/blog/category/admin/">Admin</a></li>
                    <li><a href="https://mazko.github.io/blog/category/electronics/">Electronics</a></li>
                    <li class="active"><a href="https://mazko.github.io/blog/category/embedded/">Embedded</a></li>
                    <li><a href="https://mazko.github.io/blog/category/iot/">IoT</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="https://mazko.github.io/blog/posts/2017/03/22/s-dlia-mikrokontrollerov-dekorator/" rel="bookmark"
           title="Permalink to –°++ –¥–ª—è –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ - ¬´–î–µ–∫–æ—Ä–∞—Ç–æ—Ä¬ª">–°++ –¥–ª—è –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ - ¬´–î–µ–∫–æ—Ä–∞—Ç–æ—Ä¬ª</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-03-22T00:00:00+02:00">
                –°—Ä 22 –º–∞—Ä—Ç–∞ 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://mazko.github.io/blog/author/oleg-mazko/">Oleg Mazko</a>
        </address>
<p>In <a href="https://mazko.github.io/blog/category/embedded/">Embedded</a>.</p>
<p>tags: <a href="https://mazko.github.io/blog/tag/msp430">msp430</a> <a href="https://mazko.github.io/blog/tag/pattern">–ü–∞—Ç—Ç–µ—Ä–Ω</a> </p>
</footer><!-- /.post-info -->      <blockquote>
<p>–ï—Å—Ç—å –¥–≤–∞ —Å–ø–æ—Å–æ–±–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏–∑–∞–π–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã. –û–¥–∏–Ω –∏–∑ –Ω–∏—Ö, —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å –µ–≥–æ –Ω–∞—Å—Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å—Ç—ã–º, —á—Ç–æ –≤ –Ω–µ–º, –æ—á–µ–≤–∏–¥–Ω–æ, –Ω–µ –±—É–¥–µ—Ç –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–æ–≤. –î—Ä—É–≥–æ–π —Å–ø–æ—Å–æ–± ‚Äî —Å–¥–µ–ª–∞—Ç—å –µ–≥–æ –Ω–∞—Å—Ç–æ–ª—å–∫–æ –∑–∞–ø—É—Ç–∞–Ω–Ω—ã–º, —á—Ç–æ –≤ –Ω–µ–º –Ω–µ –±—É–¥–µ—Ç –æ—á–µ–≤–∏–¥–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–æ–≤. ‚Äî C.A. R. Hoare</p>
</blockquote>
<p>¬´–ü—Ä–∏–µ–º—ã –æ–±—ä–µ–∫—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è¬ª ‚Äî —ç–ø–æ—Ö–∞–ª—å–Ω–∞—è –∫–Ω–∏–≥–∞ 1994 –≥–æ–¥–∞ –æ–± –∏–Ω–∂–µ–Ω–µ—Ä–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è, –æ–ø–∏—Å—ã–≤–∞—é—â–∞—è —Ä–µ—à–µ–Ω–∏—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —á–∞—Å—Ç—ã—Ö –ø—Ä–æ–±–ª–µ–º –≤ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ü–û. –ö–æ–ª–ª–µ–∫—Ç–∏–≤ –∞–≤—Ç–æ—Ä–æ–≤ –≠. –ì–∞–º–º–∞, –†. –•–µ–ª–º, –†. –î–∂–æ–Ω—Å–æ–Ω, –î–∂. –í–ª–∏—Å—Å–∏–¥–µ—Å —Ç–∞–∫–∂–µ –∏–∑–≤–µ—Å—Ç–µ–Ω –∫–∞–∫ ¬´–ë–∞–Ω–¥–∞ —á–µ—Ç—ã—Ä—ë—Ö¬ª, Gang of Four, GoF.</p>
<p>GoF –¥–∞—ë—Ç —Å–ª–µ–¥—É—é—â–µ–µ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä (–∞–Ω–≥–ª. Decorator) ‚Äî –ø–∞—Ç—Ç–µ—Ä–Ω, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É—é—â–∏–π –æ–±—ä–µ–∫—Ç—ã. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç—É –Ω–æ–≤—ã–µ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏. –Ø–≤–ª—è–µ—Ç—Å—è –≥–∏–±–∫–æ–π –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–æ–π –ø–æ—Ä–æ–∂–¥–µ–Ω–∏—é –ø–æ–¥–∫–ª–∞—Å—Å–æ–≤ —Å —Ü–µ–ª—å—é —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.</p>
<p>–û–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å (–≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ <a href="https://mazko.github.io/blog/posts/2017/03/20/s-18-dlia-mikrokontrollerov-razvedka-boem/">—Å–ª–æ–π</a> –¥–ª—è –ª–∞–º–ø–æ—á–µ–∫), –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏. –û–¥–Ω–∞–∫–æ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –¥–æ–±–∞–≤–∏—Ç—å –∫ –Ω–µ–º—É –Ω–µ–∫–æ—Ç–æ—Ä—É—é –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (<a href="https://mazko.github.io/blog/posts/2017/03/20/s-18-dlia-mikrokontrollerov-razvedka-boem/">–∞–Ω–∏–º–∞—Ü–∏–∏</a>), –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –¥–æ, –ø–æ—Å–ª–µ –∏–ª–∏ –¥–∞–∂–µ –≤–º–µ—Å—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –æ–±—ä–µ–∫—Ç–∞.</p>
<p><img alt="screenshot" src="https://mazko.github.io/blog/posts/2017/03/22/s-dlia-mikrokontrollerov-dekorator/ui.gif" style="width:50%; margin: 0 auto; display:block;"></p>
<p>–ü–æ—Å–∫–æ–ª—å–∫—É –∞–Ω–∏–º–∞—Ü–∏–∏ –∏ –∏—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞—Ä–∞–Ω–µ–µ –∏–∑–≤–µ—Å—Ç–Ω—ã –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏, –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –ª–µ–≥–∫–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –Ω–∞ –°++ —à–∞–±–ª–æ–Ω–∞—Ö. –¢–∞–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –±—É–¥–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å –±–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏ ROM (code bloat), –Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ–ª–∂–Ω–∞ —à—É—Å—Ç—Ä–µ–µ - —Ö–æ—Ç—è –¥–ª—è –º–∏–≥–∞—é—â–∏—Ö –ª–∞–º–ø–æ—á–µ–∫ —ç—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ. –ï—â—ë –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ –¥–∞—ë—Ç —É–¥–æ–±–Ω—É—é –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–µ–ª–∞—Ç—å –ø—Ä–æ—Å—Ç—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ <code>static_assert()</code> –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏. –ù–µ—á—Ç–æ –ø–æ–¥–æ–±–Ω–æ–µ <a href="https://mazko.github.io/blog/posts/2012/10/08/idiomy-v-ansi-c/">–º–æ–∂–Ω–æ</a> –∫–æ–Ω–µ—á–Ω–æ –∂–µ —Å–æ–æ—Ä—É–¥–∏—Ç—å –∏ –Ω–∞ –°–∏ —Å –ø–æ–º–æ—â—å—é –º–∞–∫—Ä–æ—Å–æ–≤, –Ω–æ –≤ –°++ <code>static_assert()</code> —ç—Ç–æ —É–∂–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∏ –≤–µ—Å—å–º–∞ –ø–æ–ª–µ–∑–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º —Ç–∞–∫ —á—Ç–æ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –∑–∞–Ω–æ–≤–æ –∏–∑–æ–±—Ä–µ—Ç–∞—Ç—å –≤–µ–ª–æ—Å–∏–ø–µ–¥.</p>
<p>–í—Å–µ –∫–ª–∞—Å—Å—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–π —Ä–µ–∞–ª–∏–∑—É—é—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –î–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ - –º–µ—Ç–æ–¥—ã <code>void draw(RgbStripLayer&amp; layer);</code> –∏ <code>void set_color(const auto&amp; co)</code>. –†–∞–±–æ—Ç–∞—è –≤ —Ü–µ–ø–æ—á–∫–µ –∫–∞–∂–¥—ã–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–ª—è–µ—Ç (–¥–µ–∫–æ—Ä–∏—Ä—É–µ—Ç) –∫ —Å–ª–æ—é <code>RgbStripLayer</code> –Ω–æ–≤—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞. –≠—Ç–∏ –∫–ª–∞—Å—Å—ã –≤–∑–∞–∏–º–æ–∑–∞–º–µ–Ω—è–µ–º—ã, –∏—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∞–Ω–∏–º–∞—Ü–∏—é. –í –ø—Ä–∏–ª–∞–≥–∞–µ–º—ã—Ö –∏—Å—Ö–æ–¥–Ω–∏–∫–∞—Ö –¥–æ–±–∞–≤–ª–µ–Ω–æ –±–æ–ª—å—à–µ –∞–Ω–∏–º–∞—Ü–∏–π –ø–ª—é—Å –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π —à–∞–±–ª–æ–Ω–æ–≤ (STL) –≤ –°++ - –∞–ª–≥–æ—Ä–∏—Ç–º <code>std::rotate</code> –¥–ª—è –º–∞—Å—Å–∏–≤–æ–≤.</p>
<p><a href="https://mazko.github.io/blog/posts/2017/03/22/s-dlia-mikrokontrollerov-dekorator/a.out">elf</a> | <a href="http://mazko.github.io/MSP430.js/3523e01e3e6c96088d0ac6a4c335609b">MSP430.js</a> | <a href="https://mazko.github.io/blog/posts/2017/03/22/s-dlia-mikrokontrollerov-dekorator/src.zip">–∏—Å—Ö–æ–¥–Ω–∏–∫–∏</a></p>
<p><em>app.cpp</em></p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;animation.h&quot;</span><span class="cp"></span>

<span class="k">namespace</span> <span class="n">app</span> <span class="p">{</span>

    <span class="k">using</span> <span class="k">namespace</span> <span class="n">animation</span><span class="p">;</span>

    <span class="k">constexpr</span> <span class="k">auto</span> <span class="n">SZ</span> <span class="o">=</span> <span class="n">RgbStripLayer</span><span class="o">::</span><span class="n">STRIP_SZ</span><span class="p">;</span>

    <span class="kt">int</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>

        <span class="n">RgbStripLayer</span> <span class="n">l1</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(;;)</span> <span class="p">{</span>
            <span class="n">EachColor</span><span class="o">&lt;</span> <span class="n">DynFill</span><span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SZ</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Flush</span><span class="o">&lt;</span> <span class="n">Sleep</span><span class="o">&lt;</span> <span class="mi">55555</span><span class="p">,</span> <span class="n">Nop</span> <span class="o">&gt;&gt;&gt;&gt;</span><span class="p">().</span><span class="n">draw</span><span class="p">(</span><span class="n">l1</span><span class="p">);</span>
            <span class="n">EachColor</span><span class="o">&lt;</span> <span class="n">FillCW</span><span class="o">&lt;</span> <span class="n">Sleep</span><span class="o">&lt;</span> <span class="mi">4444</span><span class="p">,</span> <span class="n">Flush</span><span class="o">&lt;&gt;</span> <span class="o">&gt;&gt;&gt;</span><span class="p">().</span><span class="n">draw</span><span class="p">(</span><span class="n">l1</span><span class="p">);</span>
            <span class="n">EachColor</span><span class="o">&lt;</span> <span class="n">FillCCW</span><span class="o">&lt;</span> <span class="n">Sleep</span><span class="o">&lt;</span> <span class="mi">4444</span><span class="p">,</span> <span class="n">Flush</span><span class="o">&lt;&gt;</span> <span class="o">&gt;&gt;&gt;</span><span class="p">().</span><span class="n">draw</span><span class="p">(</span><span class="n">l1</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p><em>animation.h</em></p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;rgb.h&quot;</span><span class="cp"></span>

<span class="k">namespace</span> <span class="n">animation</span> <span class="p">{</span>

    <span class="k">using</span> <span class="k">namespace</span> <span class="n">rgb</span><span class="p">;</span>

    <span class="k">struct</span> <span class="nl">Nop</span> <span class="p">:</span> <span class="n">NonCopyable</span> <span class="p">{</span>
        <span class="kt">void</span> <span class="n">draw</span><span class="p">(</span><span class="n">RgbStripLayer</span><span class="o">&amp;</span> <span class="n">layer</span><span class="p">)</span> <span class="p">{}</span>
    <span class="p">};</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">A</span> <span class="o">=</span> <span class="n">Nop</span><span class="o">&gt;</span>
    <span class="k">class</span> <span class="nc">Flush</span> <span class="o">:</span> <span class="n">NonCopyable</span> <span class="p">{</span>
        <span class="n">A</span> <span class="n">m_stream</span><span class="p">;</span>
    <span class="k">public</span><span class="o">:</span>
        <span class="kt">void</span> <span class="n">draw</span><span class="p">(</span><span class="n">RgbStripLayer</span><span class="o">&amp;</span> <span class="n">layer</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">layer</span><span class="p">.</span><span class="n">flush</span><span class="p">();</span>
            <span class="n">m_stream</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">layer</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="kt">int32_t</span> <span class="n">cycles</span><span class="p">,</span> <span class="k">class</span> <span class="nc">A</span><span class="o">&gt;</span>
    <span class="k">class</span> <span class="nc">Sleep</span> <span class="o">:</span> <span class="n">NonCopyable</span> <span class="p">{</span>
        <span class="n">A</span> <span class="n">m_stream</span><span class="p">;</span>
    <span class="k">public</span><span class="o">:</span>
        <span class="kt">void</span> <span class="n">draw</span><span class="p">(</span><span class="n">RgbStripLayer</span><span class="o">&amp;</span> <span class="n">layer</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">static_assert</span><span class="p">(</span><span class="n">cycles</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
            <span class="n">__delay_cycles</span><span class="p">(</span><span class="n">cycles</span><span class="p">);</span>
            <span class="n">m_stream</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">layer</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">RgbStripLayer</span><span class="o">::</span><span class="n">RGB</span><span class="o">&amp;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">RgbStripLayer</span><span class="o">::</span><span class="n">RED</span><span class="o">&gt;</span>
    <span class="k">class</span> <span class="nc">FillCW</span> <span class="o">:</span> <span class="n">NonCopyable</span> <span class="cm">/* clockwise */</span> <span class="p">{</span>
        <span class="n">A</span> <span class="n">m_stream</span><span class="p">;</span>
        <span class="n">RgbStripLayer</span><span class="o">::</span><span class="n">RGB</span> <span class="n">m_color</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
    <span class="k">public</span><span class="o">:</span>
        <span class="kt">void</span> <span class="n">draw</span><span class="p">(</span><span class="n">RgbStripLayer</span><span class="o">&amp;</span> <span class="n">layer</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="nl">m</span> <span class="p">:</span> <span class="n">layer</span><span class="p">.</span><span class="n">mem</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">m_color</span><span class="p">;</span>
                <span class="n">m_stream</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">layer</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">set_color</span><span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">co</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">m_color</span> <span class="o">=</span> <span class="n">co</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">RgbStripLayer</span><span class="o">::</span><span class="n">RGB</span><span class="o">&amp;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">RgbStripLayer</span><span class="o">::</span><span class="n">RED</span><span class="o">&gt;</span>
    <span class="k">class</span> <span class="nc">FillCCW</span> <span class="o">:</span> <span class="n">NonCopyable</span> <span class="cm">/* counterclockwise */</span> <span class="p">{</span>
        <span class="n">A</span> <span class="n">m_stream</span><span class="p">;</span>
        <span class="n">RgbStripLayer</span><span class="o">::</span><span class="n">RGB</span> <span class="n">m_color</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
    <span class="k">public</span><span class="o">:</span>
        <span class="kt">void</span> <span class="n">draw</span><span class="p">(</span><span class="n">RgbStripLayer</span><span class="o">&amp;</span> <span class="n">layer</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// while a pointer is a form of iterator,</span>
            <span class="c1">// not all iterators have the same functionality of pointer</span>
            <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">layer</span><span class="p">.</span><span class="n">mem</span><span class="p">.</span><span class="n">rbegin</span><span class="p">();</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">layer</span><span class="p">.</span><span class="n">mem</span><span class="p">.</span><span class="n">crend</span><span class="p">();</span> <span class="n">it</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="o">*</span><span class="n">it</span> <span class="o">=</span> <span class="n">m_color</span><span class="p">;</span>
                <span class="n">m_stream</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">layer</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">set_color</span><span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">co</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">m_color</span> <span class="o">=</span> <span class="n">co</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">A</span><span class="o">&gt;</span>
    <span class="k">class</span> <span class="nc">EachColor</span> <span class="o">:</span> <span class="n">NonCopyable</span> <span class="p">{</span>
        <span class="n">A</span> <span class="n">m_stream</span><span class="p">;</span>
        <span class="k">static</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="n">colors</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">RgbStripLayer</span><span class="o">::</span><span class="n">RED</span><span class="p">,</span>    <span class="n">RgbStripLayer</span><span class="o">::</span><span class="n">GREEN</span><span class="p">,</span>
            <span class="n">RgbStripLayer</span><span class="o">::</span><span class="n">BLUE</span><span class="p">,</span>   <span class="n">RgbStripLayer</span><span class="o">::</span><span class="n">YELLOW</span><span class="p">,</span>
            <span class="n">RgbStripLayer</span><span class="o">::</span><span class="n">VIOLET</span><span class="p">,</span> <span class="n">RgbStripLayer</span><span class="o">::</span><span class="n">CYAN</span><span class="p">,</span>
            <span class="n">RgbStripLayer</span><span class="o">::</span><span class="n">WHITE</span><span class="p">,</span>  
        <span class="p">};</span>

    <span class="k">public</span><span class="o">:</span>
        <span class="kt">void</span> <span class="n">draw</span><span class="p">(</span><span class="n">RgbStripLayer</span><span class="o">&amp;</span> <span class="n">layer</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">c</span> <span class="p">:</span> <span class="n">colors</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">m_stream</span><span class="p">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
                <span class="n">m_stream</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">layer</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="kt">int8_t</span> <span class="n">f</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="kt">int8_t</span> <span class="n">l</span><span class="p">,</span> <span class="k">class</span> <span class="nc">A</span><span class="o">&gt;</span>
    <span class="k">class</span> <span class="nc">DynFill</span> <span class="o">:</span> <span class="n">NonCopyable</span> <span class="p">{</span>
        <span class="n">A</span> <span class="n">m_stream</span><span class="p">;</span>
        <span class="n">RgbStripLayer</span><span class="o">::</span><span class="n">RGB</span> <span class="n">m_color</span> <span class="o">=</span> <span class="n">RgbStripLayer</span><span class="o">::</span><span class="n">RED</span><span class="p">;</span>
    <span class="k">public</span><span class="o">:</span>
        <span class="kt">void</span> <span class="n">draw</span><span class="p">(</span><span class="n">RgbStripLayer</span><span class="o">&amp;</span> <span class="n">layer</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">static_assert</span><span class="p">(</span><span class="n">f</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">);</span>
            <span class="k">static_assert</span><span class="p">(</span><span class="n">l</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">);</span>
            <span class="k">static_assert</span><span class="p">(</span><span class="n">l</span> <span class="o">&lt;</span> <span class="n">layer</span><span class="p">.</span><span class="n">mem</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
            <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="n">f</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">l</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">layer</span><span class="p">.</span><span class="n">mem</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_color</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">m_stream</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">layer</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">set_color</span><span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">co</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">m_color</span> <span class="o">=</span> <span class="n">co</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">};</span>
<span class="p">}</span>
</pre></div>


<p>–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏ –û–û–ü –≤ –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö –∏–º–µ–µ—Ç —Å–≤–æ—é —Å–ø–µ—Ü–∏—Ñ–∏–∫—É, –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ–º—É—é –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –º–æ–¥–µ–ª—å—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–º—è—Ç—å—é. –ù–µ–≤–∞–∂–Ω–æ –Ω–∞ —á—ë–º –ø–∏—Å–∞—Ç—å ‚Äî –°–∏ –∏–ª–∏ –°++ –¥–ª—è –≤—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã—Ö —Å–∏—Å—Ç–µ–º –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞–º—è—Ç—å –≤ —Å—Ç–µ–∫–µ —Ç.–∫. –æ–Ω–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–æ–º. –í —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –Ω–∞ –∫—É—á–µ <strong>–Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–æ–º</strong> –∏ –∫–∞–∫ —Å–ª–µ–¥—Å—Ç–≤–∏–µ –µ—ë –Ω–∞–ª–∏—á–∏–µ –≤ –Ω—É–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è. –û–û–ü –∂–µ –±–æ–ª—å—à–µ –ª—é–±–∏—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ ‚Äî –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã <code>new</code>, <code>malloc</code>, —É–º–Ω—ã–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏. –ù–µ —Å—Ç–æ–∏—Ç —ç—Ç–æ–≥–æ –≤—Å–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö –±–µ–∑ —è—Å–Ω–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π.</p>
<p><a href="https://mazko.github.io/blog/posts/2017/06/22/s-dlia-mikrokontrollerov-upravlenie-pamiatiu/">–î–∞–ª–µ–µ</a> –∏–≥—Ä–∞ ¬´–ó–º–µ–π–∫–∞¬ª –≥–¥–µ —Ä–∞–±–æ—Ç–∞ —Å –ø–∞–º—è—Ç—å—é –±—É–¥–µ—Ç –æ–ø–∏—Å–∞–Ω–∞ –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ.</p>
    </div><!-- /.entry-content -->
  </article>
</section>


<div class="body" id="proiot-comments">
  <div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname = 'mazko';
      var disqus_identifier = 'blog/posts/2017/03/22/s-dlia-mikrokontrollerov-dekorator/';
      var disqus_url = 'https://mazko.github.io/blog/posts/2017/03/22/s-dlia-mikrokontrollerov-dekorator/';
      (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//mazko.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the comments.</noscript>
  </div>
</div>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a rel="nofollow" href="http://getpelican.com/">Pelican</a></li>
                            <li><a rel="nofollow" href="http://python.org/">Python.org</a></li>
                            <li><a rel="nofollow" href="http://jinja.pocoo.org/">Jinja2</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://mazko.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a rel="nofollow" href="http://github.com/mazko">github</a></li>
                            <li><a rel="nofollow" href="http://linkedin.com/in/mazko">linkedin</a></li>
                            <li><a rel="nofollow" href="http://stackoverflow.com/users/281102/oleg-mazko">stackoverflow</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

<script type="text/javascript">
    var disqus_shortname = 'mazko';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>