<!DOCTYPE html>
<html lang="ru">
<head>
        <meta charset="utf-8" />
        <title>üè† –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –í—Å–µ–≥–æ üöó - SOAP</title>
        <link rel="stylesheet" href="https://mazko.github.io/blog/theme/css/main.css" />
        <link href="https://mazko.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="üè† –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –í—Å–µ–≥–æ üöó Atom Feed" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://mazko.github.io/">üè† –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –í—Å–µ–≥–æ üöó </a></h1>
                <nav><ul>
                    <li><a href="https://mazko.github.io/blog/category/admin/">Admin</a></li>
                    <li><a href="https://mazko.github.io/blog/category/electronics/">Electronics</a></li>
                    <li><a href="https://mazko.github.io/blog/category/embedded/">Embedded</a></li>
                    <li><a href="https://mazko.github.io/blog/category/iot/">IoT</a></li>
                    <li><a href="https://mazko.github.io/blog/category/java/">Java</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="https://mazko.github.io/blog/posts/2016/08/12/umnyi-dom-avtomatizatsiia-ustroistv-s-podderzhkoi-upnpdlna/">–£–º–Ω—ã–π –î–æ–º - –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π UPnP/DLNA</a></h1>
<footer class="post-info">
        <abbr class="published" title="2016-08-12T00:00:00+03:00">
                –ü—Ç 12 –∞–≤–≥—É—Å—Ç–∞ 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://mazko.github.io/blog/author/oleg-mazko/">Oleg Mazko</a>
        </address>
<p>In <a href="https://mazko.github.io/blog/category/iot/">IoT</a>.</p>
<p>tags: <a href="https://mazko.github.io/blog/tag/m2m">m2m</a> <a href="https://mazko.github.io/blog/tag/soap">SOAP</a> </p>
</footer><!-- /.post-info --><p>Universal Plug and Play (<a href="http://upnp.org/specs/arch/UPnP-arch-DeviceArchitecture-v1.1.pdf" rel="nofollow">UPnP</a>) - —ç—Ç–æ –Ω–∞–±–æ—Ä –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∏ –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–µ—Ç–µ–≤—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤. –î–µ–≤–∞–π—Å–æ–º –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ—á—Ç–∏ –≤—Å–µ —á—Ç–æ —É–≥–æ–¥–Ω–æ: —Ä–æ—É—Ç–µ—Ä, –ø—Ä–∏–Ω—Ç–µ—Ä, Smart TV, –º–æ–±–∏–ª—å–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω - –≥–ª–∞–≤–Ω–æ–µ —á—Ç–æ–±—ã –æ–Ω –±—ã–ª –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ —Å–µ—Ç–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–ª —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é UPnP/DLNA.</p>
<p>–¢—É—Ç –ø–æ–∂–∞–ª—É–π —Å—Ç–æ–∏—Ç —Å–¥–µ–ª–∞—Ç—å —Ä–∏—Ç–æ—Ä–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å—Ç—É–ø–ª–µ–Ω–∏–µ. –ó–∞—á–µ–º –Ω–∞–º <a href="http://2gusia.livejournal.com/37929.html" rel="nofollow">–¥–≤–µ</a> —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ UPnP –∏ DLNA ? –¢–∞–∫ —Å–ª–æ–∂–∏–ª–æ—Å—å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏. –° —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –±—ã—Ç–æ–≤–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è - —ç—Ç–æ –ø–æ—á—Ç–∏ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ DLNA –±–∞–∑–∏—Ä—É–µ—Ç—Å—è –Ω–∞ UPnP, –Ω–∞–∫–ª–∞–¥—ã–≤–∞—è –Ω–∞ –Ω–µ–≥–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.
UPnP - –Ω–∞–±–æ—Ä –æ—Ç–∫—Ä—ã—Ç—ã—Ö –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö —Å–µ—Ç–µ–≤—ã—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤, –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ –¥–ª—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏  DLNA –æ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è —Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–ø–ª–∞—Ç–∏—Ç—å <a href="http://www.dlna.org/certification/certification" rel="nofollow">–¥–µ–Ω—é—à–∫—É</a>. –¢–∞–∫–∂–µ DLNA –ø—Ä–∏–≤–Ω–æ—Å–∏—Ç –∏–Ω—Ç–µ—Ä–µ—Å—ã –ø—Ä–∞–≤–æ–æ–±–ª–∞–¥–∞—Ç–µ–ª—è, —Å—Ç—Ä–µ–º—è—Å—å –¥–æ–ø—É—Å—Ç–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ "–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ" –º–µ–¥–∏–∞–∫–æ–Ω—Ç–µ–Ω—Ç–∞. –•–æ—Ä–æ—à–∏–π –ø—Ä–∏–º–µ—Ä - —Ñ–æ—Ä–º–∞—Ç mkv, —Å—Ç–æ–ª—å —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–π –≤ —Å–µ—Ç–∏ –∏ —Å—Ç–æ–ª—å –Ω–µ–Ω–∞–≤–∏—Å—Ç–Ω—ã–π –º–Ω–æ–≥–∏–º –ø—Ä–∞–≤–æ–æ–±–ª–∞–¥–∞—Ç–µ–ª—è–º. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —ç—Ç–æ—Ç —Ñ–æ—Ä–º–∞—Ç, –≤–ø–æ–ª–Ω–µ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å UPnP, –æ–∫–∞–∑–∞–ª—Å—è –∑–∞ –±–æ—Ä—Ç–æ–º —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π DLNA –∏ –º–Ω–æ–∂–µ—Å—Ç–≤–æ DLNA —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –Ω–µ –º–æ–≥—É—Ç —Å –Ω–∏–º —Ä–∞–±–æ—Ç–∞—Ç—å.</p>
<p>–ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∏ DLNA –∏ UPnP —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ –ø–æ–¥–∞–≤–ª—è—é—â–µ–º –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤–º–µ—Å—Ç–µ. –ü—Ä–∞–≤–¥–∞, –Ω–µ –Ω–∞ –ª—é–±–æ–º –∫–æ–Ω—Ç–µ–Ω—Ç–µ.</p>
<p><img alt="screenshot" src="https://mazko.github.io/blog/posts/2016/08/12/umnyi-dom-avtomatizatsiia-ustroistv-s-podderzhkoi-upnpdlna/ui.gif" style="width:100%; border:1px solid #ddd;"></p>
<p>–ù–∞—à–∞ —Ü–µ–ª—å - –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π —Ç.–∫. –æ—á–µ–Ω—å —É–¥–æ–±–Ω–æ –≤–∫–ª—é—á–∞—Ç—å/–≤—ã–∫–ª—é—á–∞—Ç—å –º—É–∑—ã–∫—É –≤ –∫–æ–º–Ω–∞—Ç–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–µ–π –∫–ª–∞–≤–∏—à –Ω–∞ <a href="https://mazko.github.io/blog/posts/2016/03/03/kak-soorudit-udobnyi-perevod-teksta-vsego-za-paru-minut/">–Ω–æ—É—Ç–µ</a>. </p>
<p>–ù–∞—á–Ω—ë–º —Å <a href="http://www.upnp-hacks.org/upnp.html" rel="nofollow">–æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è</a> –¥–æ—Å—Ç—É–ø–Ω—ã—Ö UPnP —É—Å—Ç—Ä–æ–π—Å—Ç–≤. –î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å M-SEARCH –∑–∞–ø—Ä–æ—Å –Ω–∞ multicast-–∞–¥—Ä–µ—Å 239.255.255.250 –ø–æ—Ä—Ç 1900 –ø–æ UDP –ø—Ä–æ—Ç–æ–∫–æ–ª—É. –í—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é UPnP –æ–±—è–∑–∞–Ω—ã –æ—Ç–≤–µ—Ç–∏—Ç—å –ø–æ UDP unicast:</p>
<div class="highlight"><pre><span></span>~$ upnp-scan<span class="o">()</span> <span class="o">{</span>
  python3 -c <span class="s1">&#39;</span>
<span class="s1">import socket, sys</span>

<span class="s1">SSDP_ADDR = &quot;239.255.255.250&quot;</span>
<span class="s1">SSDP_PORT = 1900</span>
<span class="s1"># seconds to delay response</span>
<span class="s1">SSDP_MX = 3</span>
<span class="s1"># search target</span>
<span class="s1">SSDP_ST = sys.argv[1] # upnp-scan &quot;ssdp:all&quot;</span>

<span class="s1">ssdpRequest = &quot;M-SEARCH * HTTP/1.1\r\n&quot; + \</span>
<span class="s1">              &quot;HOST: %s:%d\r\n&quot; % (SSDP_ADDR, SSDP_PORT) + \</span>
<span class="s1">              &quot;MAN: \&quot;ssdp:discover\&quot;\r\n&quot; + \</span>
<span class="s1">              &quot;MX: %d\r\n&quot; % (SSDP_MX, ) + \</span>
<span class="s1">              &quot;ST: %s\r\n&quot; % (SSDP_ST, ) + &quot;\r\n&quot;</span>

<span class="s1">with socket.socket(socket.AF_INET, socket.SOCK_DGRAM) as sock:</span>
<span class="s1">  sock.sendto(ssdpRequest.encode(), (SSDP_ADDR, SSDP_PORT))</span>
<span class="s1">  sock.settimeout(SSDP_MX + 1)</span>
<span class="s1">  while True:</span>
<span class="s1">    try:</span>
<span class="s1">      data = sock.recv(1024)</span>
<span class="s1">      print(data.decode()) </span>
<span class="s1">    except socket.timeout:</span>
<span class="s1">      break</span>
<span class="s1">  &#39;</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> <span class="p">|</span> <span class="se">\</span>
  tr -d <span class="s1">&#39;\r&#39;</span> <span class="c1"># normalize new lines \r\n =&gt; \n</span>
<span class="o">}</span>

~$ upnp-scan <span class="s2">&quot;ssdp:all&quot;</span> <span class="p">|</span> <span class="se">\</span>
    tee upnp.scan.dump <span class="p">|</span> <span class="se">\</span>
    awk -v <span class="nv">RS</span><span class="o">=</span><span class="s1">&#39;\n\n\n&#39;</span> <span class="s1">&#39;/BubbleUPnP/ &amp;&amp; /[Ss][Tt]: uuid:/ {print $0 &quot;\n&quot;}&#39;</span>
<span class="c1"># response</span>
HTTP/1.1 <span class="m">200</span> OK
Cache-control: max-age<span class="o">=</span><span class="m">1800</span>
Usn: uuid:3ef89534-fb8e-c38f-0000-00007940d6d3
Location: http://192.168.0.100:57916/dev/3ef89534-fb8e-c38f-0000-00007940d6d3/desc.xml
Server: Linux/2.6.29 UPnP/1.0 BubbleUPnP/1.6.11.1
Ext: 
St: uuid:3ef89534-fb8e-c38f-0000-00007940d6d3
</pre></div>


<p>–ú—ã –ø—Ä–æ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–ª–∏ —Å–µ—Ç—å –∏ <a href="http://awk.js.org/?gist=ebfc98b50d9b72b1f77df05a4db264a9">–æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–ª–∏</a> —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ BubbleUPnP, –∫–æ—Ç–æ—Ä—ã–º–∏ —Ö–æ—Ç–∏–º —É–ø—Ä–∞–≤–ª—è—Ç—å. –¢–∞–∫–æ–≤—ã—Ö –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ, –ø–æ—ç—Ç–æ–º—É –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —É–¥–æ–±–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –¥–µ–≤–∞–π—Å–æ–º —á–µ—Ä–µ–∑ uuid: </p>
<div class="highlight"><pre><span></span>~$ upnp-scan <span class="s1">&#39;uuid:3ef89534-fb8e-c38f-0000-00007940d6d3&#39;</span> <span class="p">|</span> awk <span class="s1">&#39;/Location:/ {print $2}&#39;</span>
<span class="c1"># response</span>
http://192.168.0.100:57916/dev/3ef89534-fb8e-c38f-0000-00007940d6d3/desc.xml
</pre></div>


<p>–í —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ <a href="http://upnp.org/specs/arch/UPnP-arch-DeviceArchitecture-v1.1.pdf" rel="nofollow">UPnP</a> –º–Ω–æ–≥–æ –±—É–∫–≤. –ú–æ–∂–Ω–æ —É–ø—Ä–æ—Å—Ç–∏—Ç—å —Å–µ–±–µ –∂–∏–∑–Ω—å –∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å SOAP –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ 192.168.0.100, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ <code>sudo tcpdump -A dst 192.168.0.100</code> –∏ —Å–¥–µ–ª–∞—Ç—å —Ç–æ –∂–µ –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º curl:</p>
<div class="highlight"><pre><span></span>~$ <span class="nv">BASE</span><span class="o">=</span>http://192.168.0.100:57916/ <span class="se">\</span>
   <span class="nv">AV</span><span class="o">=</span>dev/3ef89534-fb8e-c38f-0000-00007940d6d3/svc/upnp-org/AVTransport/action
~$ curl <span class="s2">&quot;</span><span class="nv">$BASE$AV</span><span class="s2">&quot;</span> <span class="se">\</span>
-XPOST <span class="se">\</span>
-H <span class="s1">&#39;SOAPAction: &quot;urn:schemas-upnp-org:service:AVTransport:1#Stop&quot;&#39;</span> <span class="se">\</span>
-H <span class="s1">&#39;Content-Type: text/xml; charset=&quot;utf-8&quot;&#39;</span> <span class="se">\</span>
-d <span class="s1">&#39;&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="s1">&lt;s:Envelope xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; </span>
<span class="s1">s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;&gt;</span>
<span class="s1">  &lt;s:Body&gt;</span>
<span class="s1">    &lt;u:Stop xmlns:u=&quot;urn:schemas-upnp-org:service:AVTransport:1&quot;&gt;</span>
<span class="s1">      &lt;InstanceID&gt;0&lt;/InstanceID&gt;</span>
<span class="s1">    &lt;/u:Stop&gt;</span>
<span class="s1">  &lt;/s:Body&gt;</span>
<span class="s1">&lt;/s:Envelope&gt;&#39;</span>

~$ curl <span class="s2">&quot;</span><span class="nv">$BASE$AV</span><span class="s2">&quot;</span> <span class="se">\</span>
-XPOST <span class="se">\</span>
-H <span class="s1">&#39;SOAPAction: &quot;urn:schemas-upnp-org:service:AVTransport:1#SetAVTransportURI&quot;&#39;</span> <span class="se">\</span>
-H <span class="s1">&#39;Content-Type: text/xml; charset=&quot;utf-8&quot;&#39;</span> <span class="se">\</span>
-d <span class="s1">&#39;&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="s1">&lt;s:Envelope xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span>
<span class="s1">s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;&gt;</span>
<span class="s1">  &lt;s:Body&gt;</span>
<span class="s1">    &lt;u:SetAVTransportURI xmlns:u=&quot;urn:schemas-upnp-org:service:AVTransport:1&quot;&gt;</span>
<span class="s1">      &lt;CurrentURIMetaData&gt;NOT_IMPLEMENTED&lt;/CurrentURIMetaData&gt;</span>
<span class="s1">      &lt;CurrentURI&gt;http://online.radioroks.com.ua:8000/RadioROKS&lt;/CurrentURI&gt;</span>
<span class="s1">      &lt;InstanceID&gt;0&lt;/InstanceID&gt;</span>
<span class="s1">    &lt;/u:SetAVTransportURI&gt;</span>
<span class="s1">  &lt;/s:Body&gt;</span>
<span class="s1">&lt;/s:Envelope&gt;&#39;</span>

~$ curl <span class="s2">&quot;</span><span class="nv">$BASE$AV</span><span class="s2">&quot;</span> <span class="se">\</span>
-XPOST <span class="se">\</span>
-H <span class="s1">&#39;SOAPAction: &quot;urn:schemas-upnp-org:service:AVTransport:1#Play&quot;&#39;</span> <span class="se">\</span>
-H <span class="s1">&#39;Content-Type: text/xml; charset=&quot;utf-8&quot;&#39;</span> <span class="se">\</span>
-d <span class="s1">&#39;&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="s1">&lt;s:Envelope xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span>
<span class="s1">s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;&gt;</span>
<span class="s1">  &lt;s:Body&gt;</span>
<span class="s1">    &lt;u:Play xmlns:u=&quot;urn:schemas-upnp-org:service:AVTransport:1&quot;&gt;</span>
<span class="s1">      &lt;Speed&gt;1&lt;/Speed&gt;</span>
<span class="s1">      &lt;InstanceID&gt;0&lt;/InstanceID&gt;</span>
<span class="s1">    &lt;/u:Play&gt;</span>
<span class="s1">  &lt;/s:Body&gt;</span>
<span class="s1">&lt;/s:Envelope&gt;&#39;</span>
</pre></div>


<p>–ö–æ–Ω–µ—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</p>
<p><em>upnp-cp.sh</em></p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1"># chmod +x upnp-cp.sh &amp;&amp; sudo ln -s &quot;`pwd`/upnp-cp.sh&quot; /usr/local/bin/play-to-upnp</span>

<span class="c1"># usage stop/play:</span>
<span class="c1"># play-to-upnp</span>
<span class="c1"># play-to-upnp http://online.radioroks.com.ua:8000/RadioROKS</span>

<span class="nb">set</span> -e

upnp-scan<span class="o">()</span> <span class="o">{</span>
  python3 -c <span class="s1">&#39;</span>
<span class="s1">import socket, sys</span>

<span class="s1">SSDP_ADDR = &quot;239.255.255.250&quot;</span>
<span class="s1">SSDP_PORT = 1900</span>
<span class="s1"># seconds to delay response</span>
<span class="s1">SSDP_MX = 3</span>
<span class="s1"># search target</span>
<span class="s1">SSDP_ST = sys.argv[1] # upnp-scan &quot;ssdp:all&quot;</span>

<span class="s1">ssdpRequest = &quot;M-SEARCH * HTTP/1.1\r\n&quot; + \</span>
<span class="s1">              &quot;HOST: %s:%d\r\n&quot; % (SSDP_ADDR, SSDP_PORT) + \</span>
<span class="s1">              &quot;MAN: \&quot;ssdp:discover\&quot;\r\n&quot; + \</span>
<span class="s1">              &quot;MX: %d\r\n&quot; % (SSDP_MX, ) + \</span>
<span class="s1">              &quot;ST: %s\r\n&quot; % (SSDP_ST, ) + &quot;\r\n&quot;</span>

<span class="s1">with socket.socket(socket.AF_INET, socket.SOCK_DGRAM) as sock:</span>
<span class="s1">  sock.sendto(ssdpRequest.encode(), (SSDP_ADDR, SSDP_PORT))</span>
<span class="s1">  sock.settimeout(SSDP_MX + 1)</span>
<span class="s1">  while True:</span>
<span class="s1">    try:</span>
<span class="s1">      data = sock.recv(1024)</span>
<span class="s1">      print(data.decode()) </span>
<span class="s1">    except socket.timeout:</span>
<span class="s1">      break</span>
<span class="s1">  &#39;</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> <span class="p">|</span> <span class="se">\</span>
  tr -d <span class="s1">&#39;\r&#39;</span> <span class="c1"># normalize new lines \r\n =&gt; \n</span>
<span class="o">}</span>

<span class="nv">URL</span><span class="o">=</span><span class="sb">`</span>upnp-scan <span class="s2">&quot;uuid:3ef89534-fb8e-c38f-0000-00007940d6d3&quot;</span> <span class="p">|</span> <span class="se">\</span>
awk <span class="s1">&#39;/Location:/ {print $2}&#39;</span><span class="sb">`</span>

<span class="nb">echo</span> Divice found: <span class="nv">$URL</span>

<span class="nv">URL_AV</span><span class="o">=</span><span class="sb">`</span>curl -s <span class="s2">&quot;</span><span class="nv">$URL</span><span class="s2">&quot;</span> <span class="p">|</span> <span class="se">\</span>
python3 -c <span class="s1">&#39;</span>
<span class="s1">import sys, xml.dom.minidom</span>
<span class="s1">dom = xml.dom.minidom.parse(sys.stdin)</span>
<span class="s1">for srv in dom.getElementsByTagName(&quot;service&quot;):</span>
<span class="s1">  ids = [e.firstChild.nodeValue for e in srv.getElementsByTagName(&quot;serviceId&quot;)]</span>
<span class="s1">  if (&quot;urn:upnp-org:serviceId:AVTransport&quot; in ids):</span>
<span class="s1">    for url in srv.getElementsByTagName(&quot;controlURL&quot;):</span>
<span class="s1">      print(url.firstChild.nodeValue)</span>
<span class="s1">&#39;</span><span class="sb">`</span>

<span class="nv">URL_AV</span><span class="o">=</span><span class="s2">&quot;`echo </span><span class="nv">$URL</span><span class="s2"> | cut -d &#39;/&#39; -f1`//`echo </span><span class="nv">$URL</span><span class="s2"> | cut -d &#39;/&#39; -f3`</span><span class="nv">$URL_AV</span><span class="s2">&quot;</span>

<span class="nb">echo</span> AVTransport found: <span class="nv">$URL_AV</span>

curl -vsf <span class="nv">$URL_AV</span> <span class="se">\</span>
  -XPOST <span class="se">\</span>
  -H <span class="s1">&#39;SOAPAction: &quot;urn:schemas-upnp-org:service:AVTransport:1#Stop&quot;&#39;</span> <span class="se">\</span>
  -H <span class="s1">&#39;Content-Type: text/xml; charset=&quot;utf-8&quot;&#39;</span> <span class="se">\</span>
  -d <span class="s1">&#39;&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="s1">  &lt;s:Envelope xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; </span>
<span class="s1">  s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;&gt;</span>
<span class="s1">    &lt;s:Body&gt;</span>
<span class="s1">      &lt;u:Stop xmlns:u=&quot;urn:schemas-upnp-org:service:AVTransport:1&quot;&gt;</span>
<span class="s1">        &lt;InstanceID&gt;0&lt;/InstanceID&gt;</span>
<span class="s1">      &lt;/u:Stop&gt;</span>
<span class="s1">    &lt;/s:Body&gt;</span>
<span class="s1">  &lt;/s:Envelope&gt;&#39;</span>

<span class="c1"># $# variable will tell you the number of input arguments the script was passed</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$#</span> -ne <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="c1"># play url $@</span>
  curl -vsf <span class="nv">$URL_AV</span> <span class="se">\</span>
    -XPOST <span class="se">\</span>
    -H <span class="s1">&#39;SOAPAction: &quot;urn:schemas-upnp-org:service:AVTransport:1#SetAVTransportURI&quot;&#39;</span> <span class="se">\</span>
    -H <span class="s1">&#39;Content-Type: text/xml; charset=&quot;utf-8&quot;&#39;</span> <span class="se">\</span>
    -d <span class="s2">&quot;&lt;?xml version=&#39;1.0&#39;?&gt;</span>
<span class="s2">    &lt;s:Envelope xmlns:s=&#39;http://schemas.xmlsoap.org/soap/envelope/&#39;</span>
<span class="s2">    s:encodingStyle=&#39;http://schemas.xmlsoap.org/soap/encoding/&#39;&gt;</span>
<span class="s2">      &lt;s:Body&gt;</span>
<span class="s2">        &lt;u:SetAVTransportURI xmlns:u=&#39;urn:schemas-upnp-org:service:AVTransport:1&#39;&gt;</span>
<span class="s2">          &lt;CurrentURIMetaData&gt;NOT_IMPLEMENTED&lt;/CurrentURIMetaData&gt;</span>
<span class="s2">          &lt;CurrentURI&gt;</span><span class="nv">$@</span><span class="s2">&lt;/CurrentURI&gt;</span>
<span class="s2">          &lt;InstanceID&gt;0&lt;/InstanceID&gt;</span>
<span class="s2">        &lt;/u:SetAVTransportURI&gt;</span>
<span class="s2">      &lt;/s:Body&gt;</span>
<span class="s2">    &lt;/s:Envelope&gt;&quot;</span>

  curl -vsf <span class="nv">$URL_AV</span> <span class="se">\</span>
    -XPOST <span class="se">\</span>
    -H <span class="s1">&#39;SOAPAction: &quot;urn:schemas-upnp-org:service:AVTransport:1#Play&quot;&#39;</span> <span class="se">\</span>
    -H <span class="s1">&#39;Content-Type: text/xml; charset=&quot;utf-8&quot;&#39;</span> <span class="se">\</span>
    -d <span class="s1">&#39;&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="s1">    &lt;s:Envelope xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span>
<span class="s1">    s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;&gt;</span>
<span class="s1">      &lt;s:Body&gt;</span>
<span class="s1">        &lt;u:Play xmlns:u=&quot;urn:schemas-upnp-org:service:AVTransport:1&quot;&gt;</span>
<span class="s1">          &lt;Speed&gt;1&lt;/Speed&gt;</span>
<span class="s1">          &lt;InstanceID&gt;0&lt;/InstanceID&gt;</span>
<span class="s1">        &lt;/u:Play&gt;</span>
<span class="s1">      &lt;/s:Body&gt;</span>
<span class="s1">    &lt;/s:Envelope&gt;&#39;</span>
<span class="k">fi</span>
</pre></div><p>There are <a href="https://mazko.github.io/blog/posts/2016/08/12/umnyi-dom-avtomatizatsiia-ustroistv-s-podderzhkoi-upnpdlna/#disqus_thread">comments</a>.</p>                </article>
            </aside><!-- /#featured -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a rel="nofollow" href="http://getpelican.com/">Pelican</a></li>
                            <li><a rel="nofollow" href="http://python.org/">Python.org</a></li>
                            <li><a rel="nofollow" href="http://jinja.pocoo.org/">Jinja2</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://mazko.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a rel="nofollow" href="http://github.com/mazko">github</a></li>
                            <li><a rel="nofollow" href="http://linkedin.com/in/mazko">linkedin</a></li>
                            <li><a rel="nofollow" href="http://stackoverflow.com/users/281102/oleg-mazko">stackoverflow</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

<script type="text/javascript">
    var disqus_shortname = 'mazko';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>