<!DOCTYPE html>
<html lang="ru">
<head>
        <meta charset="utf-8" />
        <title>üè† –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –í—Å–µ–≥–æ üöó - UART</title>
        <link rel="stylesheet" href="http://proiot.ru/blog/theme/css/main.css" />
        <link href="http://proiot.ru/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="üè† –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –í—Å–µ–≥–æ üöó Atom Feed" />

        <script>
            (function(){
                var loc = window.location.href+'';
                if (loc.indexOf('https://')==0){
                    window.location.href = loc.replace('https://','http://');
                }
            })();
        </script>

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
<a rel="nofollow" href="http://github.com/mazko">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />
</a>
        <header id="banner" class="body">
                <h1><a href="http://proiot.ru/">üè† –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –í—Å–µ–≥–æ üöó </a></h1>
                <nav><ul>
                    <li><a href="http://proiot.ru/blog/category/admin/">Admin</a></li>
                    <li><a href="http://proiot.ru/blog/category/electronics/">Electronics</a></li>
                    <li><a href="http://proiot.ru/blog/category/embedded/">Embedded</a></li>
                    <li><a href="http://proiot.ru/blog/category/iot/">IoT</a></li>
                    <li><a href="http://proiot.ru/blog/category/java/">Java</a></li>
                </ul></nav>
        </header><!-- /#banner -->



            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="http://proiot.ru/blog/posts/2012/10/07/ispolzovanie-manchesterskogo-koda-na-primere/">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–∞–Ω—á–µ—Å—Ç–µ—Ä—Å–∫–æ–≥–æ –∫–æ–¥–∞ –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ</a></h1>
<footer class="post-info">
        <abbr class="published" title="2012-10-07T00:00:00+03:00">
                –í—Å 07 –æ–∫—Ç—è–±—Ä—è 2012
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="http://proiot.ru/blog/author/oleg-mazko/">Oleg Mazko</a>
        </address>
<p>In <a href="http://proiot.ru/blog/category/embedded/">embedded</a>.</p>
<p>tags: <a href="http://proiot.ru/blog/tag/manchesterskii-kod">–ú–∞–Ω—á–µ—Å—Ç–µ—Ä—Å–∫–∏–π –∫–æ–¥</a> <a href="http://proiot.ru/blog/tag/uart">UART</a> </p>
</footer><!-- /.post-info --><p>–í <a href="http://proiot.ru/blog/posts/2012/10/07/manchesterskii-kod-dlia-chainikov/">–ø—Ä–µ–¥—ã–¥—É—â–µ–º</a> –ø–æ—Å—Ç–µ –±—ã–ª–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞ –ø–æ—á–≤–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å <em>–ú–∞–Ω—á–µ—Å—Ç–µ—Ä—Å–∫–∏–º –∫–æ–¥–æ–º</em>. –¢–µ–ø–µ—Ä—å —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º —Ä–µ–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ <strong>Microchip</strong> - –æ–¥–∏–Ω –±—É–¥–µ—Ç –∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, –¥—Ä—É–≥–æ–π –ø—Ä–∏–Ω–∏–º–∞—Ç—å, –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –∏ –≤—ã–≤–æ–¥–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ <strong>UART</strong> - —Ç–µ—Ä–º–∏–Ω–∞–ª. –ü–æ—Å–∫–æ–ª—å–∫—É —ç—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä, —Ç–æ —Å –≤—ã–±–æ—Ä–æ–º <strong>C</strong> - –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞ –Ω–∏—á–µ–≥–æ –≤—ã–¥—É–º—ã–≤–∞—Ç—å –Ω–µ –±—É–¥–µ–º –∏ –≤–æ–∑—å–º—ë–º —Ç–æ, —á—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–∞—ë—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å - –ø—Ä–æ–±–Ω—É—é –≤–µ—Ä—Å–∏—é <strong>mplabc18</strong> (<em>mplabc18_v3.40_windows_eval.exe</em>) –Ω–∞ 60 –¥–Ω–µ–π, —Å–∫–∞—á–∞—Ç—å –º–æ–∂–Ω–æ —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞ —Å —Ä–æ–¥–Ω–æ–π —Å—Ä–µ–¥–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ <strong>MPLAB_IDE</strong> (<em>v8_70</em>).</p>
<p>–ö–∞–∫ –∏ –≤ –ø—Ä–æ—à–ª—ã–π —Ä–∞–∑ –Ω–∞—á–Ω—ë–º —Å –ø—Ä–æ—Å—Ç–æ–≥–æ - —Ä–µ–∞–ª–∏–∑—É–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –≤ <em>–ú–∞–Ω—á–µ—Å—Ç–µ—Ä—Å–∫–∏–π –ö–æ–¥</em> –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç –∏—Ö. –ü—Ä–µ–∂–¥–µ –≤—Å–µ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –≤ <strong>MPLAB</strong>, –º–∞—Å—Ç–µ—Ä –ø–æ–ø—Ä–æ—Å–∏—Ç —É–∫–∞–∑–∞—Ç—å –º–æ–¥–µ–ª—å –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ - —Ç—É—Ç –∫–∞–∫–∏—Ö-–ª–∏–±–æ –æ—Å–æ–±—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –Ω–µ—Ç, –ø–æ—ç—Ç–æ–º—É –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π, –Ω–∞–ø—Ä–∏–º–µ—Ä <strong>PIC18F1230</strong>. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –¥–æ–ª–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å—Å—è —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ —ç—Ç–æ–≥–æ:</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;p18cxxx.h&gt; </span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;timers.h&gt; </span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;../../../../src/tx/Man_Encode.h&quot;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">(){</span> 
    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="kt">long</span> <span class="n">i</span><span class="p">;</span>

    <span class="n">PORTBbits</span><span class="p">.</span><span class="n">RB0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
    <span class="n">TRISB</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
    <span class="n">OpenTimer0</span><span class="p">(</span><span class="n">TIMER_INT_ON</span> <span class="o">&amp;</span> <span class="n">T0_8BIT</span> <span class="o">&amp;</span> <span class="n">T0_SOURCE_INT</span> <span class="o">&amp;</span> <span class="n">T0_PS_1_8</span><span class="p">);</span>

    <span class="k">for</span><span class="p">(;;)</span> <span class="p">{</span>

        <span class="cm">/* &#39;n&#39; =&gt; 01101110b, MSB = 0 see tests =&gt; Man_Decode.cpp */</span>

        <span class="n">On_Man_Encode_One</span><span class="p">();</span>  <span class="c1">// Clay balance (1 - 1 = 0) </span>
        <span class="n">On_Man_Encode_Zero</span><span class="p">();</span> <span class="c1">// Sync balance (2 - 2 = 0) </span>
        <span class="n">On_Man_Encode_Zero</span><span class="p">();</span>  
        <span class="n">On_Man_Encode_One</span><span class="p">();</span>  <span class="c1">// Sync </span>
        <span class="n">On_Man_Encode_One</span><span class="p">();</span> 
        <span class="n">On_Man_Encode_Zero</span><span class="p">();</span> <span class="c1">// Clay</span>

        <span class="n">Man_Encode</span><span class="p">(</span><span class="sc">&#39;n&#39;</span><span class="p">);</span> 
        <span class="n">Man_Encode</span><span class="p">(</span><span class="sc">&#39;o&#39;</span><span class="p">);</span> 
        <span class="n">Man_Encode</span><span class="p">(</span><span class="sc">&#39;n&#39;</span><span class="p">);</span> 
        <span class="n">Man_Encode</span><span class="p">(</span><span class="sc">&#39;g&#39;</span><span class="p">);</span> 
        <span class="n">Man_Encode</span><span class="p">(</span><span class="sc">&#39;r&#39;</span><span class="p">);</span> 
        <span class="n">Man_Encode</span><span class="p">(</span><span class="sc">&#39;e&#39;</span><span class="p">);</span> 
        <span class="n">Man_Encode</span><span class="p">(</span><span class="sc">&#39;e&#39;</span><span class="p">);</span> 
        <span class="n">Man_Encode</span><span class="p">(</span><span class="sc">&#39;d&#39;</span><span class="p">);</span> 
        <span class="n">Man_Encode</span><span class="p">(</span><span class="sc">&#39;y&#39;</span><span class="p">);</span> 
        <span class="n">Man_Encode</span><span class="p">(</span><span class="sc">&#39;.&#39;</span><span class="p">);</span> 
        <span class="n">Man_Encode</span><span class="p">(</span><span class="sc">&#39;r&#39;</span><span class="p">);</span> 
        <span class="n">Man_Encode</span><span class="p">(</span><span class="sc">&#39;u&#39;</span><span class="p">);</span> 
        <span class="n">Man_Encode</span><span class="p">(</span><span class="sc">&#39;\r&#39;</span><span class="p">);</span> 
        <span class="n">Man_Encode</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">);</span>

        <span class="n">On_Man_Encode_Zero</span><span class="p">();</span> <span class="cm">/* Tx off */</span>

        <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">150000</span><span class="p">;</span> <span class="n">i</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">);</span> 
    <span class="p">}</span> 
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">On_Man_Encode_One</span><span class="p">(){</span> 
    <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">INTCONbits</span><span class="p">.</span><span class="n">TMR0IF</span><span class="p">);</span> 
    <span class="n">TMR0L</span> <span class="o">-=</span> <span class="mi">104</span><span class="p">;</span> <span class="c1">// 4Mhz/4/8/1200bp/s = 104 </span>
    <span class="n">INTCONbits</span><span class="p">.</span><span class="n">TMR0IF</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
    <span class="n">PORTBbits</span><span class="p">.</span><span class="n">RB0</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> 
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">On_Man_Encode_Zero</span><span class="p">(){</span> 
    <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">INTCONbits</span><span class="p">.</span><span class="n">TMR0IF</span><span class="p">);</span> 
    <span class="n">TMR0L</span> <span class="o">-=</span> <span class="mi">104</span><span class="p">;</span> <span class="c1">// 4Mhz/4/8/1200bp/s = 104 </span>
    <span class="n">INTCONbits</span><span class="p">.</span><span class="n">TMR0IF</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
    <span class="n">PORTBbits</span><span class="p">.</span><span class="n">RB0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
<span class="p">}</span>
</pre></div>


<p><img alt="MPLab –°–∫—Ä–∏–Ω—à–æ—Ç" src="http://proiot.ru/blog/posts/2012/10/07/ispolzovanie-manchesterskogo-koda-na-primere/mplab_man_tx.png" style="width:100%; border:1px solid grey;"></p>
<p>–†–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —Å–±–æ—Ä–∫–∏ —è–≤–ª—è–µ—Ç—Å—è —Ñ–∞–π–ª —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º <strong>.hex</strong>, –≤ –Ω–∞—Ä–æ–¥–µ –ø—Ä–æ—Å—Ç–æ <em>—Ö–µ–∫—Å</em> - –ø—Ä–æ—à–∏–≤–∫–∞, –∫–æ—Ç–æ—Ä—É—é –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–ø–∏—Å–∞—Ç—å –≤ –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Å –ø–æ–º–æ—â—å—é —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è (–ø—Ä–æ–≥—Ä–∞–º–º–∞—Ç–æ—Ä–∞). –ü–æ—Å–∫–æ–ª—å–∫—É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ, –Ω–∞–≤–µ—Ä–Ω–æ, —É –í–∞—Å –Ω–µ—Ç, –º–æ–∂–Ω–æ –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é —Å—Ä–µ–¥—É, –∫–æ—Ç–æ—Ä–∞—è —É–º–µ–µ—Ç —ç–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã—Ö —Å—Ö–µ–º - <strong>Proteus VSM</strong> (v 7.9sp1). –ö–∞–∫ –≤–∏–¥–Ω–æ –∏–∑ —Ä–∏—Å—É–Ω–∫–∞ –Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º –æ—Å—Ü–∏–ª–ª–æ–≥—Ä–∞—Ñ–µ –≤—Ä–µ–º—è –ª–æ–≥–∏—á–µ—Å–∫–æ–π 1 —á—É—Ç—å –±–æ–ª—å—à–µ 4 –¥–µ–ª–µ–Ω–∏–π –ø—Ä–∏ —à–∞–≥–µ 0.2 –º—Å. –ü—Ä–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏ 1200 –±–∏—Ç/—Å 1000 –º—Å / 1200 = 0,83 –º—Å —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ –ø—Ä–∞–≤–¥—É.</p>
<p><img alt="Proteus Sim –°–∫—Ä–∏–Ω—à–æ—Ç" src="http://proiot.ru/blog/posts/2012/10/07/ispolzovanie-manchesterskogo-koda-na-primere/proteus_tx_simulation.png" style="width:100%; border:1px solid grey;"></p>
<p>–¢–µ–ø–µ—Ä—å —Ä–µ–∞–ª–∏–∑—É–µ–º –ø—Ä–∏—ë–º–Ω–∏–∫, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ –≤—Ö–æ–¥–µ (–≤—ã–≤–æ–¥ <strong>RB0</strong>), –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å —Å–∏–≥–Ω–∞–ª –∏–∑ <em>–ú–∞–Ω—á–µ—Å—Ç–µ—Ä—Å–∫–æ–≥–æ –ö–æ–¥–∞</em> –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∏ –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ –ø–µ—Ä–µ–¥–∞—á–∞ –ø–æ–ª–µ–∑–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ –≤ <strong>Proteus VSM</strong> - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π <strong>UART</strong> - —Ç–µ—Ä–º–∏–Ω–∞–ª.</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;p18cxxx.h&gt; </span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;timers.h&gt; </span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;usart.h&gt; </span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;  </span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;../../../../src/rx/Man_Decode.h&quot;</span><span class="cp"></span>

<span class="kt">char</span> <span class="n">rxbuf</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">long</span><span class="p">))];</span>

<span class="kt">void</span> <span class="nf">printrxbuf</span><span class="p">()</span> <span class="p">{</span> 
    <span class="kt">char</span> <span class="n">i</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">rxbuf</span><span class="p">);</span> 
    <span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="o">--</span><span class="p">)</span> 
        <span class="n">_usart_putc</span><span class="p">(</span><span class="n">rxbuf</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span> 
<span class="p">}</span>

<span class="kt">char</span> <span class="nf">calcperiods</span><span class="p">()</span> <span class="p">{</span> 
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">time</span> <span class="o">=</span> <span class="n">TMR0L</span><span class="p">;</span> 
    <span class="n">TMR0L</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="cm">/* 8Mhz/4/32/1200(bp/s) = 52 */</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">time</span> <span class="o">&lt;</span> <span class="mi">52</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> 
    <span class="k">if</span> <span class="p">(</span><span class="n">time</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="mi">52</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">2</span><span class="p">;</span> 
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">(){</span> 
    <span class="n">OpenTimer0</span><span class="p">(</span><span class="n">TIMER_INT_OFF</span> <span class="o">&amp;</span> <span class="n">T0_8BIT</span> <span class="o">&amp;</span> <span class="n">T0_SOURCE_INT</span> <span class="o">&amp;</span> <span class="n">T0_PS_1_32</span><span class="p">);</span> 
    <span class="n">OpenUSART</span><span class="p">(</span> <span class="n">USART_TX_INT_OFF</span> <span class="o">&amp;</span> <span class="n">USART_RX_INT_OFF</span> <span class="o">&amp;</span> 
        <span class="n">USART_ASYNCH_MODE</span> <span class="o">&amp;</span> <span class="n">USART_EIGHT_BIT</span> <span class="o">&amp;</span> 
        <span class="n">USART_CONT_RX</span> <span class="o">&amp;</span> <span class="n">USART_BRGH_HIGH</span><span class="p">,</span> <span class="mi">12</span>  <span class="p">);</span> <span class="c1">// 38400 b/s</span>

    <span class="k">for</span><span class="p">(;;)</span> <span class="p">{</span> 
        <span class="n">memset</span><span class="p">(</span><span class="n">rxbuf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">rxbuf</span><span class="p">));</span> 
        <span class="k">for</span><span class="p">(;;)</span> <span class="p">{</span> 
            <span class="kt">char</span> <span class="n">ds_B</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">rxbuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;\r&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">rxbuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;\n&#39;</span><span class="p">)</span> <span class="p">{</span> 
                <span class="n">printrxbuf</span><span class="p">();</span> 
                <span class="k">break</span><span class="p">;</span> 
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span> <span class="n">PORTBbits</span><span class="p">.</span><span class="n">RB0</span> <span class="p">)</span> <span class="p">{</span> 
                <span class="k">if</span> <span class="p">(</span> <span class="n">ds_B</span> <span class="p">)</span> <span class="k">continue</span><span class="p">;</span> 
                <span class="n">ds_B</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> 
                <span class="n">Man_Decode_Stable_Zero</span><span class="p">(</span><span class="n">calcperiods</span><span class="p">());</span> 
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> 
                <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">ds_B</span> <span class="p">)</span> <span class="k">continue</span><span class="p">;</span> 
                <span class="n">ds_B</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
                <span class="n">Man_Decode_Stable_One</span><span class="p">(</span><span class="n">calcperiods</span><span class="p">());</span> 
            <span class="p">}</span> 
        <span class="p">}</span> 
    <span class="p">}</span> 
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">shiftrxbuf</span><span class="p">()</span> <span class="p">{</span> 
    <span class="o">*</span><span class="p">((</span> <span class="kt">unsigned</span> <span class="kt">long</span><span class="o">*</span> <span class="p">)</span><span class="o">&amp;</span><span class="n">rxbuf</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span> 
    <span class="k">if</span> <span class="p">(</span><span class="n">rxbuf</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="n">rxbuf</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">|=</span> <span class="mi">1</span><span class="p">;</span> 
    <span class="o">*</span><span class="p">((</span> <span class="kt">unsigned</span> <span class="kt">long</span><span class="o">*</span> <span class="p">)</span><span class="o">&amp;</span><span class="n">rxbuf</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span> 
    <span class="k">if</span> <span class="p">(</span><span class="n">rxbuf</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="n">rxbuf</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">|=</span> <span class="mi">1</span><span class="p">;</span> 
    <span class="o">*</span><span class="p">((</span> <span class="kt">unsigned</span> <span class="kt">long</span><span class="o">*</span> <span class="p">)</span><span class="o">&amp;</span><span class="n">rxbuf</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span> 
    <span class="k">if</span> <span class="p">(</span><span class="n">rxbuf</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="n">rxbuf</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">|=</span> <span class="mi">1</span><span class="p">;</span> 
    <span class="o">*</span><span class="p">((</span> <span class="kt">unsigned</span> <span class="kt">long</span><span class="o">*</span> <span class="p">)</span><span class="o">&amp;</span><span class="n">rxbuf</span><span class="p">)</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span> 
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">On_Man_Decode_Add_0</span><span class="p">(){</span> 
    <span class="n">shiftrxbuf</span><span class="p">();</span> 
    <span class="n">rxbuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="mh">0xFE</span><span class="p">;</span> 
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">On_Man_Decode_Add_1</span><span class="p">(){</span> 
    <span class="n">shiftrxbuf</span><span class="p">();</span> 
    <span class="n">rxbuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">|=</span> <span class="mi">1</span><span class="p">;</span> 
<span class="p">}</span>
</pre></div>


<p><img alt="MPLab –°–∫—Ä–∏–Ω—à–æ—Ç" src="http://proiot.ru/blog/posts/2012/10/07/ispolzovanie-manchesterskogo-koda-na-primere/mplab_man_rx.png" style="width:100%; border:1px solid grey;"></p>
<p>–ö–∞–∫ –≤–∏–¥–Ω–æ –∏–∑ –∫–æ–¥–∞, –ø—Ä–∏–∑–Ω–∞–∫–æ–º –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ —è–≤–ª—è–µ—Ç—Å—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è —Å–∏–º–≤–æ–ª–æ–≤ <code>'\r'</code> –∏ <code>'\n'</code>. –≠—Ç–æ –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ, –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö —ç—Ç–æ—Ç –º–µ—Ö–∞–Ω–∏–∑–º –Ω—É–∂–Ω–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å - –∏–Ω–∞—á–µ –∏–Ω–æ–≥–¥–∞ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∞—Ç—å –ª–æ–∂–Ω—ã–π —Å–∏–≥–Ω–∞–ª –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö. –¢–∞–∫–∂–µ —Å—Ç–æ–∏—Ç –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –±—É—Ñ–µ—Ä <code>rxbuf</code>, –≤ –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ <code>shiftrxbuf()</code>. –ï—Ç–æ—Ç –º–µ—Ç–æ–¥ –¥–µ–ª–∞–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é –ø–æ–±–∏—Ç–æ–≤–æ–≥–æ —Å–¥–≤–∏–≥–∞ –¥–ª—è –≤—Å–µ–≥–æ –±—É—Ñ–µ—Ä–∞, –∫–∞–∫ –µ—Å–ª–∏ –±—ã —ç—Ç–æ –±—ã–ª –ø—Ä–æ—Å—Ç–æ–π (–ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–π) —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö —Ç–∏–ø–∞ <code>char</code>, <code>long</code> –∏ —Ç.–¥.  –ï—Å–ª–∏ –≤—Å—ë —ç—Ç–æ —Ç–µ–ø–µ—Ä—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤ <strong>Proteus VSM</strong>, —Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–∏–º:</p>
<p><img alt="Proteus Sim –°–∫—Ä–∏–Ω—à–æ—Ç" src="http://proiot.ru/blog/posts/2012/10/07/ispolzovanie-manchesterskogo-koda-na-primere/proteus_rx_simulation.png" style="width:100%; border:1px solid grey;"></p>
<p>–í—Ä–æ–¥–µ –≤—Å—ë, –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ –Ω–∞ <a href="https://github.com/mazko/Manchester-Code" rel="nofollow">GitHub</a>.</p><p>There are <a href="http://proiot.ru/blog/posts/2012/10/07/ispolzovanie-manchesterskogo-koda-na-primere/#disqus_thread">comments</a>.</p>                </article>
            </aside><!-- /#featured -->

<div class="body" style="margin-bottom: 2em">
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- proiot-index -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6247427373315098"
     data-ad-slot="2711782349"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>

                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="http://proiot.ru/blog/posts/2012/10/03/zamechatelnyi-bootloader-ot-microchip-dlia-pic16-pic18/" rel="bookmark"
                           title="Permalink to –ó–∞–º–µ—á–∞—Ç–µ–ª—å–Ω—ã–π Bootloader –æ—Ç Microchip –¥–ª—è PIC16 / PIC18">–ó–∞–º–µ—á–∞—Ç–µ–ª—å–Ω—ã–π Bootloader –æ—Ç Microchip –¥–ª—è PIC16 / PIC18</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2012-10-03T00:00:00+03:00">
                –°—Ä 03 –æ–∫—Ç—è–±—Ä—è 2012
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="http://proiot.ru/blog/author/oleg-mazko/">Oleg Mazko</a>
        </address>
<p>In <a href="http://proiot.ru/blog/category/embedded/">Embedded</a>.</p>
<p>tags: <a href="http://proiot.ru/blog/tag/bootloader">Bootloader</a> <a href="http://proiot.ru/blog/tag/uart">UART</a> </p>
</footer><!-- /.post-info -->                <p>–í—ã –ø–µ—Ä–µ–ø—Ä–æ—à–∏–≤–∞–ª–∏ –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å <strong>BIOS</strong> ? –ï—Å–ª–∏ –Ω–µ—Ç, —Ç–æ –í–∞–º —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –ø–æ–≤–µ–∑–ª–æ... –í–æ–±—â–µ–º –ø—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ —Å–µ–±–µ <strong>BIOS</strong>, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —É–º–µ–µ—Ç –ø—Ä–æ—à–∏–≤–∞—Ç—å —Å–∞–º —Å–µ–±—è –∏ –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–ª–æ—Ö–æ (–µ–≥–æ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –ª—é–¥–∏, —Ç–æ—á–Ω–æ —Ç–∞–∫–∏–µ –∂–µ –∫–∞–∫ –∏ –º—ã —Å –í–∞–º–∏), –Ω—É–∂–Ω–æ –≤—ã–∫–ª—é—á–∏—Ç—å –∫–æ–º–ø—å—é—Ç–µ—Ä, –æ—Ç–∫—Ä—É—Ç–∏—Ç—å –ø–∞—Ä—É —à—É—Ä—É–ø–æ–≤, —Å–Ω—è—Ç—å –∫—Ä—ã—à–∫—É, –≤—ã—Ç—è–Ω—É—Ç—å –º–∏–∫—Ä–æ—Å—Ö–µ–º—É ‚Ä¶</p>
                <a class="readmore" href="http://proiot.ru/blog/posts/2012/10/03/zamechatelnyi-bootloader-ot-microchip-dlia-pic16-pic18/">read more</a>
<p>There are <a href="http://proiot.ru/blog/posts/2012/10/03/zamechatelnyi-bootloader-ot-microchip-dlia-pic16-pic18/#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>
                </ol><!-- /#posts-list -->
                </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a rel="nofollow" href="http://getpelican.com/">Pelican</a></li>
                            <li><a rel="nofollow" href="http://python.org/">Python.org</a></li>
                            <li><a rel="nofollow" href="http://jinja.pocoo.org/">Jinja2</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://proiot.ru/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a rel="nofollow" href="http://github.com/mazko">github</a></li>
                            <li><a rel="nofollow" href="http://linkedin.com/in/mazko">linkedin</a></li>
                            <li><a rel="nofollow" href="http://stackoverflow.com/users/281102/oleg-mazko">stackoverflow</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

<script type="text/javascript">
    var disqus_shortname = 'mazko';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>