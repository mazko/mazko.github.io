<!DOCTYPE html>
<html lang="ru">
<head>
        <meta charset="utf-8" />
        <title>üè† –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –í—Å–µ–≥–æ üöó - DS1307</title>
        <link rel="stylesheet" href="https://mazko.github.io/blog/theme/css/main.css" />
        <link href="https://mazko.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="üè† –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –í—Å–µ–≥–æ üöó Atom Feed" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
<a rel="nofollow" href="http://github.com/mazko">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />
</a>
        <header id="banner" class="body">
                <h1><a href="https://mazko.github.io/">üè† –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –í—Å–µ–≥–æ üöó </a></h1>
                <nav><ul>
                    <li><a href="https://mazko.github.io/blog/category/admin/">Admin</a></li>
                    <li><a href="https://mazko.github.io/blog/category/electronics/">Electronics</a></li>
                    <li><a href="https://mazko.github.io/blog/category/embedded/">Embedded</a></li>
                    <li><a href="https://mazko.github.io/blog/category/iot/">IoT</a></li>
                    <li><a href="https://mazko.github.io/blog/category/java/">Java</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="https://mazko.github.io/blog/posts/2017/02/02/picsimjs-chasy-realnogo-vremeni-ds1307/">PICSim.js - —á–∞—Å—ã —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ DS1307</a></h1>
<footer class="post-info">
        <abbr class="published" title="2017-02-02T00:00:00+02:00">
                –ß—Ç 02 —Ñ–µ–≤—Ä–∞–ª—è 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://mazko.github.io/blog/author/oleg-mazko/">Oleg Mazko</a>
        </address>
<p>In <a href="https://mazko.github.io/blog/category/embedded/">Embedded</a>.</p>
<p>tags: <a href="https://mazko.github.io/blog/tag/picsim">picsim</a> <a href="https://mazko.github.io/blog/tag/ds1307">DS1307</a> <a href="https://mazko.github.io/blog/tag/i2c">I2C</a> </p>
</footer><!-- /.post-info --><p>–ú–∏–∫—Ä–æ—Å—Ö–µ–º–∞ DS1307 –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∏–∑ —Å–µ–±—è —á–∞—Å–∏–∫–∏ —Å –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º. –í—Å—ë :) –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –∫–≤–∞—Ä—Ü–∞ —Å —á–∞—Å—Ç–æ—Ç–æ–π 32768 –ì—Ü –∏ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –ø–∏—Ç–∞–Ω–∏—è. –ï—Å–ª–∏ –≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—é, –±–∞—Ç–∞—Ä–µ–π–∫–∏ 48–º–ê—á –¥–æ–ª–∂–Ω–æ —Ö–≤–∞—Ç–∏—Ç—å –Ω–∞ 10 –ª–µ—Ç –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã —á–∞—Å–æ–≤. –û–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏ –º–µ–∂–¥—É DS1307 –∏ –≤–Ω–µ—à–Ω–∏–º –º–∏—Ä–æ–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–º—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É I2C, –∫–æ—Ç–æ—Ä—ã–π –∫–∞–∫ –∏–∑–≤–µ—Å—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Å–µ–≥–æ –¥–≤–µ –¥–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ª–∏–Ω–∏–∏ —Å–≤—è–∑–∏ (SDA –∏ SCL), –ø—Ä–∏ —ç—Ç–æ–º –Ω–∞ –æ–¥–Ω–æ–π I2C —à–∏–Ω–µ –º–æ–∂–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –¥–æ 127 —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤. –ú–∏–∫—Ä–æ—Å—Ö–µ–º–∞ DS1307 –≤ —Ç–µ—Ä–º–∏–Ω–∞—Ö I2C –≤—Å–µ–≥–¥–∞ —è–≤–ª—è–µ—Ç—Å—è –≤–µ–¥–æ–º–æ–π (Slave), —Ç.–µ. –Ω–µ –º–æ–∂–µ—Ç –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –æ–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏. –í–µ–¥—É—â–∏–º (Master) –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –±—É–¥–µ—Ç –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä PIC18F4620, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–∞ –±–æ—Ä—Ç—É –∏–º–µ–µ—Ç—Å—è –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–π I2C.</p>
<p>–ö –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—é –Ω–∞—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è <a href="https://www.sparkfun.com/datasheets/Components/DS1307.pdf" rel="nofollow">–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è</a> –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ DS1307. –í —Å–ª—É—á–∞–µ —Å —à–∏–Ω–æ–π I2C –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å –≤–∞–∂–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞ —Ç–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è SCL (–æ—Ç —ç—Ç–æ–≥–æ –∑–∞–≤–∏—Å–∏—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö), —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å –º–∏–∫—Ä–æ—Å—Ö–µ–º—ã (–∏–∑ 127 –≤–æ–∑–º–æ–∂–Ω—ã—Ö) –Ω–∞ —à–∏–Ω–µ –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∫–∞—Ä—Ç–∞ –ø–∞–º—è—Ç–∏ (–∞–¥—Ä–µ—Å–∞ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤). –¢–∞–∫ –∫–∞–∫ I2C —è–≤–ª—è–µ—Ç—Å—è <em>—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º</em> –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º, —Ç–æ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∏–º–µ–Ω–Ω–æ –≤–µ—Ä—Ö–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞ —á–∞—Å—Ç–æ—Ç—ã, —Ç–æ–≥–¥–∞ –∫–∞–∫ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –æ–±–º–µ–Ω–∞ –∑–∞–¥–∞—ë—Ç—Å—è –º–∞—Å—Ç–µ—Ä–æ–º –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –ª—é–±–æ–π –∏ –¥–∞–∂–µ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π - –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –º–æ–∂–µ—Ç —Å–ø–æ–∫–æ–π–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –Ω–∞ –±–æ–ª–µ–µ –≤–∞–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —à–∏–Ω–µ. –≠—Ç–æ —Å–µ—Ä—å—ë–∑–Ω–æ–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –ø–µ—Ä–µ–¥–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏.</p>
<p><a href="https://mazko.github.io/blog/posts/2017/02/02/picsimjs-chasy-realnogo-vremeni-ds1307/config-4620.h">config.h</a> | <a href="https://mazko.github.io/blog/posts/2017/02/02/picsimjs-chasy-realnogo-vremeni-ds1307/i2c-hw.c">i2c-hw.c</a> | <a href="https://mazko.github.io/blog/posts/2017/01/27/picsimjs-simvolnyi-displei-na-baze-hd44780/">liquid-crystal.c</a> | <a href="https://mazko.github.io/blog/posts/2017/02/02/picsimjs-chasy-realnogo-vremeni-ds1307/main.hex">hex</a> | <a href="http://mazko.github.io/picsim.js/1bcc58df4b0494fada5bfdc2638e8034">picsim.js</a></p>
<p><img alt="screenshot" src="https://mazko.github.io/blog/posts/2017/02/02/picsimjs-chasy-realnogo-vremeni-ds1307/ui.gif" style="width:100%; border:1px solid #ddd;"></p>
<p>–†–∞–±–æ—Ç–∞ —Å —Å–∏–º–≤–æ–ª—å–Ω—ã–º –¥–∏—Å–ø–ª–µ–µ–º –æ–ø–∏—Å—ã–≤–∞–ª–∞—Å—å –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º <a href="https://mazko.github.io/blog/posts/2017/01/27/picsimjs-simvolnyi-displei-na-baze-hd44780/">–º–∞—Ç–µ—Ä–∏–∞–ª–µ</a>. –°–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –¥–µ–ª–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–º I2C –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –ø–æ–º–µ—â–µ–Ω—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª <a href="https://mazko.github.io/blog/posts/2017/02/02/picsimjs-chasy-realnogo-vremeni-ds1307/i2c-hw.c">i2c-hw.c</a>. –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ DS1307 –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ñ—É–Ω–∫—Ü–∏–∏ rtc_r. –ü–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ I2C –≤–µ–¥–æ–º–æ–º—É —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞—Ç—å (–≤—ã—Å—Ç–∞–≤–ª—è—Ç—å –≤ 0) –ª–∏–Ω–∏—é SCL, —Ç–µ–º —Å–∞–º—ã–º —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É—è –æ –Ω–µ–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –æ–±–º–µ–Ω—É –¥–∞–Ω–Ω—ã–º–∏ - –ø–æ—ç—Ç–æ–º—É —Ñ—É–Ω–∫—Ü–∏—è <code>i2c_idle</code> –∂–¥—ë—Ç –ø–æ–∫–∞ –Ω–µ –æ—Ç–ø—É—Å—Ç—è—Ç SCL. –° –∫–∞–∂–¥—ã–º —á—Ç–µ–Ω–∏–µ–º –æ—á–µ—Ä–µ–¥–Ω–æ–≥–æ –±–∞–π—Ç–∞ <code>i2c_rb</code> –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∞–¥—Ä–µ—Å –∫–∞—Ä—Ç—ã –ø–∞–º—è—Ç–∏ DS1307 –∏–Ω–∫—Ä–∏–º–∏–Ω–∏—Ä—É–µ—Ç—Å—è, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ —Å—á–∏—Ç—ã–≤–∞—Ç—å –º–∏–Ω—É—Ç—ã...–≥–æ–¥ –±–µ–∑ —è–≤–Ω–æ–≥–æ —É–∫–∞–∑—ã–≤–∞–Ω–∏—è –∏—Ö –∞–¥—Ä–µ—Å–æ–≤ - –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –Ω–∞—á–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å —Å–µ–∫—É–Ω–¥. –í —Å–µ—Ç–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ I2C, –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π <code>i2c_open</code>, <code>i2c_start</code> –∏ —Ç.–¥. –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—Ä–µ–¥–µ–ª—å–Ω–æ —è—Å–Ω—ã–º.</p>
<p><em>rtc_r.c</em></p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdint.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdbool.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;time.h&gt;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&quot;i2c-hw.c&quot;</span><span class="cp"></span>

<span class="k">static</span> <span class="kt">uint8_t</span> <span class="nf">bcd2dec</span><span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">bcd</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">((</span><span class="n">bcd</span> <span class="o">/</span> <span class="mi">16</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">bcd</span> <span class="o">%</span> <span class="mi">16</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// http://microchip.wikidot.com/i2c:sequential-read</span>

<span class="kt">void</span> <span class="nf">rtc_r</span><span class="p">(</span><span class="k">struct</span> <span class="n">tm</span> <span class="o">*</span> <span class="k">const</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">i2c_open</span><span class="p">();</span>              <span class="c1">// Open I2C module as master, low speed</span>

  <span class="n">i2c_idle</span><span class="p">();</span>              <span class="c1">// Ensure I2C is idle</span>
  <span class="n">i2c_start</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>        <span class="c1">// I2C Start condition</span>
  <span class="n">i2c_wb</span><span class="p">(</span><span class="mh">0xD0</span><span class="p">);</span>            <span class="c1">// DS1307 slave I2C address + I2C write flag</span>
  <span class="n">i2c_idle</span><span class="p">();</span>              <span class="c1">// Ensure I2C is idle</span>
  <span class="n">i2c_wb</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>               <span class="c1">// Sequential read start address</span>

  <span class="n">i2c_idle</span><span class="p">();</span>              <span class="c1">// Ensure I2C is idle</span>
  <span class="n">i2c_start</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>         <span class="c1">// Restart condition</span>
  <span class="n">i2c_wb</span><span class="p">(</span><span class="mh">0xD1</span><span class="p">);</span>            <span class="c1">// DS1307 slave I2C address + I2C read flag</span>

  <span class="n">i2c_idle</span><span class="p">();</span>              <span class="c1">// Ensure I2C is idle</span>
  <span class="n">t</span><span class="o">-&gt;</span><span class="n">tm_sec</span> <span class="o">=</span> <span class="n">bcd2dec</span><span class="p">(</span><span class="n">i2c_rb</span><span class="p">(</span><span class="nb">true</span><span class="p">));</span> <span class="c1">// secs, I2C ACK condition</span>

  <span class="n">i2c_idle</span><span class="p">();</span>              <span class="c1">// Ensure I2C is idle</span>
  <span class="n">t</span><span class="o">-&gt;</span><span class="n">tm_min</span> <span class="o">=</span> <span class="n">bcd2dec</span><span class="p">(</span><span class="n">i2c_rb</span><span class="p">(</span><span class="nb">true</span><span class="p">));</span> <span class="c1">// minutes, I2C ACK condition</span>

  <span class="n">i2c_idle</span><span class="p">();</span>              <span class="c1">// Ensure I2C is idle</span>
  <span class="n">t</span><span class="o">-&gt;</span><span class="n">tm_hour</span> <span class="o">=</span> <span class="n">bcd2dec</span><span class="p">(</span><span class="n">i2c_rb</span><span class="p">(</span><span class="nb">true</span><span class="p">));</span> <span class="c1">// hours, I2C ACK condition</span>

  <span class="n">i2c_idle</span><span class="p">();</span>              <span class="c1">// Ensure I2C is idle</span>
  <span class="n">t</span><span class="o">-&gt;</span><span class="n">tm_wday</span> <span class="o">=</span> <span class="n">i2c_rb</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span> <span class="c1">// Day of Week, I2C ACK condition</span>

  <span class="n">i2c_idle</span><span class="p">();</span>              <span class="c1">// Ensure I2C is idle</span>
  <span class="n">t</span><span class="o">-&gt;</span><span class="n">tm_mday</span> <span class="o">=</span> <span class="n">bcd2dec</span><span class="p">(</span><span class="n">i2c_rb</span><span class="p">(</span><span class="nb">true</span><span class="p">));</span> <span class="c1">// Day of Month, I2C ACK condition</span>

  <span class="n">i2c_idle</span><span class="p">();</span>              <span class="c1">// Ensure I2C is idle</span>
  <span class="n">t</span><span class="o">-&gt;</span><span class="n">tm_mon</span> <span class="o">=</span> <span class="n">bcd2dec</span><span class="p">(</span><span class="n">i2c_rb</span><span class="p">(</span><span class="nb">true</span><span class="p">));</span> <span class="c1">// month, I2C ACK condition</span>

  <span class="n">i2c_idle</span><span class="p">();</span>              <span class="c1">// Ensure I2C is idle</span>
  <span class="n">t</span><span class="o">-&gt;</span><span class="n">tm_year</span> <span class="o">=</span> <span class="n">bcd2dec</span><span class="p">(</span><span class="n">i2c_rb</span><span class="p">(</span><span class="nb">false</span><span class="p">));</span> <span class="c1">// year, I2C NACK condition (end of sequential read)</span>

  <span class="n">t</span><span class="o">-&gt;</span><span class="n">tm_yday</span> <span class="o">=</span> <span class="n">t</span><span class="o">-&gt;</span><span class="n">tm_isdst</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// less than zero if the information is not available</span>

  <span class="n">i2c_stop_and_close</span><span class="p">();</span>    <span class="c1">// I2C Stop condition, then close I2C module</span>
<span class="p">}</span>
</pre></div>


<p><em>main.c</em></p>
<div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">  xc8 --chip=18f4620 main.c</span>
<span class="cm">*/</span>

<span class="cp">#define _XTAL_FREQ 25e4</span>

<span class="cp">#include</span> <span class="cpf">&lt;xc.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;time.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdint.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;config-4620.h&quot;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&quot;liquid-crystal.c&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;rtc_r.c&quot;</span><span class="cp"></span>

<span class="c1">// http://microchip.wikidot.com/faq:29</span>
<span class="kt">void</span> <span class="nf">putch</span><span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">byte</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">lcd_dat</span><span class="p">(</span><span class="n">byte</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// lcd</span>
  <span class="n">PORTD</span> <span class="o">=</span> <span class="n">TRISD</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">PORTE</span> <span class="o">=</span> <span class="n">TRISE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="c1">// i2c</span>
  <span class="n">TRISC3</span> <span class="o">=</span> <span class="n">TRISC4</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="n">lcd_init</span><span class="p">();</span>
  <span class="n">lcd_no_cursor</span><span class="p">();</span>
  <span class="n">lcd_no_blink</span><span class="p">();</span>

  <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">daysOfWeek</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s">&quot;Sun.&quot;</span><span class="p">,</span> <span class="s">&quot;Mon.&quot;</span><span class="p">,</span> <span class="s">&quot;Tues.&quot;</span><span class="p">,</span> <span class="s">&quot;Wed.&quot;</span><span class="p">,</span> <span class="s">&quot;Thurs.&quot;</span><span class="p">,</span> <span class="s">&quot;Fri.&quot;</span><span class="p">,</span> <span class="s">&quot;Sat.&quot;</span>
    <span class="p">};</span>
    <span class="k">struct</span> <span class="n">tm</span> <span class="n">t</span><span class="p">;</span>

    <span class="n">lcd_home</span><span class="p">();</span>
    <span class="n">rtc_r</span><span class="p">(</span><span class="o">&amp;</span><span class="n">t</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%02d:%02d:%02d  %s&quot;</span><span class="p">,</span>
      <span class="n">t</span><span class="p">.</span><span class="n">tm_hour</span><span class="p">,</span> <span class="n">t</span><span class="p">.</span><span class="n">tm_min</span><span class="p">,</span> <span class="n">t</span><span class="p">.</span><span class="n">tm_sec</span><span class="p">,</span>
      <span class="n">t</span><span class="p">.</span><span class="n">tm_wday</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">t</span><span class="p">.</span><span class="n">tm_wday</span> <span class="o">&lt;</span> <span class="mi">7</span> <span class="o">?</span> <span class="n">daysOfWeek</span><span class="p">[</span><span class="n">t</span><span class="p">.</span><span class="n">tm_wday</span><span class="p">]</span> <span class="o">:</span> <span class="s">&quot;:(&quot;</span><span class="p">);</span>
    <span class="n">lcd_set_cursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%02d/%02d/%02d&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">.</span><span class="n">tm_mday</span><span class="p">,</span> <span class="n">t</span><span class="p">.</span><span class="n">tm_mon</span><span class="p">,</span> <span class="n">t</span><span class="p">.</span><span class="n">tm_year</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>–¢–µ–∫—É—â—É—é –≤—Ä–µ–º—è –∏ –¥–∞—Ç—É –º–æ–∂–Ω–æ –∫–æ–Ω–µ—á–Ω–æ –∂–µ –≤—ã—Å—Ç–∞–≤–ª—è—Ç—å - –∞–¥—Ä–µ—Å–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –∫–∞—Ä—Ç—ã –ø–∞–º—è—Ç–∏ DS1307 –¥–ª—è –∑–∞–ø–∏—Å–∏ —Ç–∞–∫–∏–µ –∂–µ –∫–∞–∫ –∏ –Ω–∞ —á—Ç–µ–Ω–∏–µ. –ï—Å–ª–∏ —Å–∫–æ—Ä–æ—Å—Ç—å –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏ –Ω–µ –∏–º–µ–µ—Ç –æ—Å–æ–±–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è, —Ç–æ –Ω–∏—á—Ç–æ –Ω–µ –º–µ—à–∞–µ—Ç –∑–∞–º–µ–Ω–∏—Ç—å –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–π I2C (—Ñ–∞–π–ª i2c-hw.c) –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π (–ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ —Å—á–∏—Ç—ã–≤–∞—Ç—å/–≤—ã—Å—Ç–∞–≤–ª—è—Ç—å –Ω–æ–≥–∏ –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ SCL/SDA) - —ç—Ç–æ —Ç–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–ª–æ—Å—å –∏ –¥–∞–∂–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Å–∏–º—É–ª—è—Ü–∏–∏ PICSim.js.</p>
<p><a href="https://mazko.github.io/blog/posts/2017/02/05/picsimjs-soprogrammy-i-prosteishaia-mnogozadachnost/">–î–∞–ª–µ–µ</a> —Å–æ–ø—Ä–æ–≥—Ä–∞–º–º—ã.</p><p>There are <a href="https://mazko.github.io/blog/posts/2017/02/02/picsimjs-chasy-realnogo-vremeni-ds1307/#disqus_thread">comments</a>.</p>                </article>
            </aside><!-- /#featured -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a rel="nofollow" href="http://getpelican.com/">Pelican</a></li>
                            <li><a rel="nofollow" href="http://python.org/">Python.org</a></li>
                            <li><a rel="nofollow" href="http://jinja.pocoo.org/">Jinja2</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://mazko.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a rel="nofollow" href="http://github.com/mazko">github</a></li>
                            <li><a rel="nofollow" href="http://linkedin.com/in/mazko">linkedin</a></li>
                            <li><a rel="nofollow" href="http://stackoverflow.com/users/281102/oleg-mazko">stackoverflow</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

<script type="text/javascript">
    var disqus_shortname = 'mazko';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>