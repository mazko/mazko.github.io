<!DOCTYPE html>
<html lang="ru">
<head>
        <meta charset="utf-8" />
        <title>üè† –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –í—Å–µ–≥–æ üöó - FSM</title>
        <link rel="stylesheet" href="http://proiot.ru/blog/theme/css/main.css" />
        <link href="http://proiot.ru/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="üè† –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –í—Å–µ–≥–æ üöó Atom Feed" />

        <script>
            (function(){
                var loc = window.location.href+'';
                if (loc.indexOf('https://')==0){
                    window.location.href = loc.replace('https://','http://');
                }
            })();
        </script>

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
<a rel="nofollow" href="http://github.com/mazko">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />
</a>
        <header id="banner" class="body">
                <h1><a href="http://proiot.ru/">üè† –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –í—Å–µ–≥–æ üöó </a></h1>
                <nav><ul>
                    <li><a href="http://proiot.ru/blog/category/admin/">Admin</a></li>
                    <li><a href="http://proiot.ru/blog/category/electronics/">Electronics</a></li>
                    <li><a href="http://proiot.ru/blog/category/embedded/">Embedded</a></li>
                    <li><a href="http://proiot.ru/blog/category/iot/">IoT</a></li>
                    <li><a href="http://proiot.ru/blog/category/java/">Java</a></li>
                </ul></nav>
        </header><!-- /#banner -->



            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="http://proiot.ru/blog/posts/2017/10/09/setevoe-programmirovanie-tcp-http-server/">–°–µ—Ç–µ–≤–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ - TCP | HTTP —Å–µ—Ä–≤–µ—Ä</a></h1>
<footer class="post-info">
        <abbr class="published" title="2017-10-09T00:00:00+03:00">
                –ü–Ω 09 –æ–∫—Ç—è–±—Ä—è 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="http://proiot.ru/blog/author/oleg-mazko/">Oleg Mazko</a>
        </address>
<p>In <a href="http://proiot.ru/blog/category/iot/">IoT</a>.</p>
<p>tags: <a href="http://proiot.ru/blog/tag/contiki">contiki</a> <a href="http://proiot.ru/blog/tag/msp430">msp430</a> <a href="http://proiot.ru/blog/tag/fsm">FSM</a> </p>
</footer><!-- /.post-info --><p><a href="http://proiot.ru/blog/posts/2017/10/03/setevoe-programmirovanie-udp-ntp-chasy/">–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º</a> –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –ø–æ —Å–µ—Ç–µ–≤—ã–º –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º.</p>
<p>TCP –∏ UDP ‚Äî –æ–±–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è. UDP ‚Äî —ç—Ç–æ –ø—Ä–æ—Ç–æ–∫–æ–ª –±–µ–∑ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏ —Å –Ω–µ–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–æ–π –ø–∞–∫–µ—Ç–æ–≤. TCP (Transmission Control Protocol) ‚Äî —ç—Ç–æ –ø—Ä–æ—Ç–æ–∫–æ–ª —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏ —Å –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–æ–π –ø–∞–∫–µ—Ç–æ–≤. –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ (–ü—Ä–∏–≤–µ—Ç. | –ü—Ä–∏–≤–µ—Ç. | –ü–æ–±–æ–ª—Ç–∞–µ–º? | –î–∞–≤–∞–π.), –ø–æ—Å–ª–µ —á–µ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º. –î–∞–ª–µ–µ –ø–æ —ç—Ç–æ–º—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—é —Ç—É–¥–∞ –∏ –æ–±—Ä–∞—Ç–Ω–æ –ø–æ—Å—ã–ª–∞—é—Ç—Å—è –ø–∞–∫–µ—Ç—ã (–∏–¥–µ—Ç –±–µ—Å–µ–¥–∞), –ø—Ä–∏—á–µ–º —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π, –¥–æ—à–µ–ª –ª–∏ –ø–∞–∫–µ—Ç –¥–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—è. –ï—Å–ª–∏ –ø–∞–∫–µ—Ç –ø–æ—Ç–µ—Ä—è–ª—Å—è, –∏–ª–∏ –¥–æ—à–µ–ª, –Ω–æ —Å –±–∏—Ç–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º–æ–π, —Ç–æ –æ–Ω –ø–æ—Å—ã–ª–∞–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ (¬´–ø–æ–≤—Ç–æ—Ä–∏, –Ω–µ —Ä–∞—Å—Å–ª—ã—à–∞–ª¬ª). –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º TCP –±–æ–ª–µ–µ –Ω–∞–¥—ë–∂–µ–Ω, –Ω–æ –æ–Ω —Å–ª–æ–∂–Ω–µ–µ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ —Ç–∞–∫—Ç–æ–≤ / –ø–∞–º—è—Ç–∏, —á—Ç–æ –∏–º–µ–µ—Ç –Ω–µ —Å–∞–º–æ–µ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤. –í –∫–∞—á–µ—Å—Ç–≤–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –ø—Ä–∏–∫–ª–∞–¥–Ω—ã—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö TCP, –º–æ–∂–Ω–æ –Ω–∞–∑–≤–∞—Ç—å FTP, HTTP, SMTP –∏ –º–Ω–æ–≥–∏–µ –¥—Ä—É–≥–∏–µ.</p>
<h2>TL;DR</h2>
<p>HTTP (Hypertext Transfer Protocol) ‚Äî –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–π –ø—Ä–æ—Ç–æ–∫–æ–ª, —Å –ø–æ–º–æ—â—å—é –∫–æ—Ç–æ—Ä–æ–≥–æ —Å–µ—Ä–≤–µ—Ä –æ—Ç–¥–∞—ë—Ç —Å—Ç—Ä–∞–Ω–∏—á–∫–∏ –Ω–∞—à–µ–º—É –±—Ä–∞—É–∑–µ—Ä—É. HTTP –≤ –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è –ø–æ–≤—Å–µ–º–µ—Å—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–æ –í—Å–µ–º–∏—Ä–Ω–æ–π –ø–∞—É—Ç–∏–Ω–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å –≤–µ–±-—Å–∞–π—Ç–æ–≤. –ù–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ —Å–≤–µ—Ç–∏–ª—å–Ω–∏–∫ –Ω–∞ –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ —Å –û–° <a href="http://proiot.ru/blog/posts/2017/10/03/setevoe-programmirovanie-udp-ntp-chasy/">Contiki</a> –Ω–∞ –±–æ—Ä—Ç—É, –≤ –∫–æ—Ç–æ—Ä–æ–º —Ü–≤–µ—Ç–∞ –∑–∞–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä.</p>
<p><a href="http://localhost:9148/54734ef58963a68a9d79d74d53e115f7">IPv6</a> | <a href="http://localhost:9148/f681567307f7470e3bcb0e17de6c1710">IPv4</a> | <a href="http://proiot.ru/blog/posts/2017/10/09/setevoe-programmirovanie-tcp-http-server/conticki-http-leds.zip">–∏—Å—Ö–æ–¥–Ω–∏–∫–∏</a></p>
<p><img alt="screenshot" src="http://proiot.ru/blog/posts/2017/10/09/setevoe-programmirovanie-tcp-http-server/ui.gif" style="width:100%;"></p>
<p>HTTP –ø—Ä–æ—Ç–æ–∫–æ–ª —Ç–µ–∫—Å—Ç–æ–≤—ã–π –∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–æ–π. –°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ –≤–æ—Ç —Ç–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç –º–µ—Ç–æ–¥ GET, –ø–æ—Å—ã–ª–∞–µ–º—ã–π —É—Ç–∏–ª–∏—Ç–æ–π netcat –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π IPv6 –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ —Å –ª–∞–º–ø–æ—á–∫–∞–º–∏:</p>
<div class="highlight"><pre><span></span>~$ nc fe80::200:e2ff:fe58:b66b%mazko 80 &lt;&lt;EOF
GET /b HTTP/1.0

EOF
</pre></div>


<p>–ú–µ—Ç–æ–¥ HTTP (–∞–Ω–≥–ª. HTTP Method) –æ–±—ã—á–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –∫–æ—Ä–æ—Ç–∫–æ–µ –∞–Ω–≥–ª–∏–π—Å–∫–æ–µ —Å–ª–æ–≤–æ, –∑–∞–ø–∏—Å–∞–Ω–Ω–æ–µ –∑–∞–≥–ª–∞–≤–Ω—ã–º–∏ –±—É–∫–≤–∞–º–∏, —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∫ —Ä–µ–≥–∏—Å—Ç—Ä—É. –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–µ—Ä –æ–±—è–∑–∞–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∫–∞–∫ –º–∏–Ω–∏–º—É–º –º–µ—Ç–æ–¥—ã GET –∏ HEAD. –ö—Ä–æ–º–µ –º–µ—Ç–æ–¥–æ–≤ GET –∏ HEAD, —á–∞—Å—Ç–æ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –º–µ—Ç–æ–¥—ã POST, PUT –∏ DELETE. –ú–µ—Ç–æ–¥ GET –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞, –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ —Ç—É—Ç <code>GET /b HTTP/1.0</code> –≥–¥–µ –ø—É—Ç—å /b –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ü–≤–µ—Ç (—Å–∏–Ω–∏–π). –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:</p>
<div class="highlight"><pre><span></span>HTTP/1.0 200 OK
Server: Contiki/2.4 http://www.sics.se/contiki/
Connection: close
Cache-Control: no-cache, no-store, must-revalidate
Pragma: no-cache
Expires: 0
Content-type: text/html

&lt;html&gt;&lt;head&gt;&lt;title&gt;Contiki RGB&lt;/title&gt;&lt;/head&gt;&lt;body&gt;
&lt;p style=&#39;color:red;&#39;&gt;Red is &lt;a href=&#39;/r&#39;&gt;OFF&lt;/a&gt;&lt;/p&gt;
&lt;p style=&#39;color:green;&#39;&gt;Green is &lt;a href=&#39;/g&#39;&gt;OFF&lt;/a&gt;&lt;/p&gt;
&lt;p style=&#39;color:blue;&#39;&gt;Blue is &lt;a href=&#39;/b&#39;&gt;ON&lt;/a&gt;&lt;/p&gt;
&lt;/body&gt;&lt;/html&gt;
</pre></div>


<p>–ö–æ–¥ —Å–æ—Å—Ç–æ—è–Ω–∏—è (—É –Ω–∞—Å 200) —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞. –û–Ω –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ –∏–∑ —Ç—Ä—ë—Ö —Ü–∏—Ñ—Ä. –ü–µ—Ä–≤–∞—è —Ü–∏—Ñ—Ä–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∫–ª–∞—Å—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è. –ó–∞ –∫–æ–¥–æ–º –æ—Ç–≤–µ—Ç–∞ –æ–±—ã—á–Ω–æ —Å–ª–µ–¥—É–µ—Ç –æ—Ç–¥–µ–ª—ë–Ω–Ω–∞—è –ø—Ä–æ–±–µ–ª–æ–º –ø–æ—è—Å–Ω—è—é—â–∞—è —Ñ—Ä–∞–∑–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–∑—ä—è—Å–Ω—è–µ—Ç —á–µ–ª–æ–≤–µ–∫—É –ø—Ä–∏—á–∏–Ω—É –∏–º–µ–Ω–Ω–æ —Ç–∞–∫–æ–≥–æ –æ—Ç–≤–µ—Ç–∞. –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ —Å–µ—Ä–≤–µ—Ä –æ—Ç—Ä–∞–±–æ—Ç–∞–ª –±–µ–∑ –æ—à–∏–±–æ–∫, –≤—Å—ë –ø—É—á–∫–æ–º (–û–ö).</p>
<p>–ö–∞–∫ –∑–∞–ø—Ä–æ—Å, —Ç–∞–∫ –∏ –æ—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ ‚Äî –æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞, –ø–∞—Ä–∞ –∏–º—è-–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –¥–≤–æ–µ—Ç–æ—á–∏–µ–º). –ó–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è –∑–∞–≥–æ–ª–æ–≤–∫–∏ –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π, –ø–æ—Å–ª–µ —á–µ–≥–æ –º–æ–≥—É—Ç –∏–¥—Ç–∏ –¥–∞–Ω–Ω—ã–µ.</p>
<p>–ú–æ–π –±—Ä–∞—É–∑–µ—Ä –æ—Ç–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π IPv6-–∞–¥—Ä–µ—Å, –ø–æ—ç—Ç–æ–º—É –≤ –ø—Ä–æ—à–∏–≤–∫–µ –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –ø—Ä–æ–ø–∏—Å–∞–Ω –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å –∏ —Ç–∞–∫–æ–π –∂–µ –ø—Ä–µ—Ñ–∏–∫—Å —Ç–∞–∫–∂–µ –Ω—É–∂–Ω–æ –Ω–∞–∑–Ω–∞—á–∏—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º—É —Å–µ—Ç–µ–≤–æ–º—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É —Å–∏–º—É–ª—è—Ç–æ—Ä–∞:</p>
<div class="highlight"><pre><span></span>~$ sudo ip addr add abcd::1/64 dev mazko          # linux
~$ netsh interface ipv6 set address mazko abcd::1 # windows
~$ curl http://[abcd::200:e2ff:fe58:b66b]
</pre></div>


<p>–ï—Å–ª–∏ curl –æ—Ç—Ä–∞–±–æ—Ç–∞–ª –±–µ–∑ –æ—à–∏–±–æ–∫, —Ç–æ —Å—Å—ã–ª–∫—É –º–æ–∂–Ω–æ —Å–ø–æ–∫–æ–π–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ.</p>
<h2>TCP</h2>
<p>–ó–¥–µ—Å—å –º—ã –Ω–∞—É—á–∏–º –Ω–∞—à <a href="http://proiot.ru/blog/posts/2017/10/03/setevoe-programmirovanie-udp-ntp-chasy/">–∏–≥—Ä—É—à–µ—á–Ω—ã–π</a> TCP/IP —Å—Ç–µ–∫ –ø–æ–Ω–∏–º–∞—Ç—å TCP –ø—Ä–æ—Ç–æ–∫–æ–ª. –ò—Ç–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É TCP –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —Ç.–Ω. —Ç—Ä–µ—Ö—Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ –∫–≤–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (—Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è). –ö–∞–∫ –≤—Å–µ–≥–¥–∞ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å —Å–µ—Ç—å—é –ø–æ–º–æ–∂–µ—Ç Wireshark.</p>
<p>–ö–æ–≥–¥–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —É–¥–∞–ª—ë–Ω–Ω—ã–º —Å–µ—Ä–≤–µ—Ä–æ–º, –µ–º—É –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–∞–∫–µ—Ç —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º —Ñ–ª–∞–≥–æ–º SYN, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é —Å–µ—Å—Å–∏–∏. –¢—É—Ç –µ—Å—Ç—å –ø–æ–ª–µ Sequence Number (–Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ 1039510418), –Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –ø–æ–ª—è –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.</p>
<p><img alt="screenshot" src="http://proiot.ru/blog/posts/2017/10/09/setevoe-programmirovanie-tcp-http-server/handshake1.png" style="width:100%;"></p>
<p>–°–µ—Ä–≤–µ—Ä, –≤ –æ—Ç–≤–µ—Ç –Ω–∞ —ç—Ç–æ—Ç –ø–∞–∫–µ—Ç, –æ—Ç–≤–µ—á–∞–µ—Ç –ø–∞–∫–µ—Ç–æ–º —Å –±–∏—Ç–∞–º–∏ SYN, ACK. –°–≤–æ—ë –∑–Ω–∞—á–µ–Ω–∏–µ Sequence Number (–Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ 16770109) –æ–Ω —Ç–æ–∂–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–º –æ–±—Ä–∞–∑–æ–º. –¢–∞–∫–∂–µ –æ–Ω –¥–æ–ª–∂–µ–Ω –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª–µ Acknowledgment Number, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥–µ—Ç —Ä–∞–≤–Ω–æ —Å—É–º–º–µ –ø—Ä–∏–Ω—è—Ç–æ–≥–æ Sequence Number –ø–ª—é—Å 1 —Ç.–µ. 1039510419.</p>
<p><img alt="screenshot" src="http://proiot.ru/blog/posts/2017/10/09/setevoe-programmirovanie-tcp-http-server/handshake2.png" style="width:100%;"></p>
<p>–¢–µ–ø–µ—Ä—å –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω–µ –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∏—á–µ–≥–æ –¥—Ä—É–≥–æ–≥–æ, –∫–∞–∫ –æ—Ç–≤–µ—Ç–∏—Ç—å ACK. –ó–¥–µ—Å—å Acknowledgment Number –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –±—É–¥–µ—Ç —Ä–∞–≤–Ω–æ —Å—É–º–º–µ –ø—Ä–∏–Ω—è—Ç–æ–≥–æ Sequence Number –ø–ª—é—Å 1 —Ç.–µ. 16770110.</p>
<p><img alt="screenshot" src="http://proiot.ru/blog/posts/2017/10/09/setevoe-programmirovanie-tcp-http-server/handshake3.png" style="width:100%;"></p>
<p>–° —ç—Ç–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º. –î–∞–ª—å–Ω–µ–π—à–∏–µ –ø–∞–∫–µ—Ç—ã –±—É–¥—É—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —É–∂–µ –ø–æ–ª–µ–∑–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É ‚Äì –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –≤—ã—à–µ—Å—Ç–æ—è—â–∏—Ö —É—Ä–æ–≤–Ω–µ–π. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç UDP, —Ç—É—Ç –Ω–∞ –∫–∞–∂–¥—ã–π –ø–∞–∫–µ—Ç –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (—Ñ–ª–∞–≥ ACK), –¥–∞–±—ã —É–¥–∞–ª—ë–Ω–Ω—ã–π —É–∑–µ–ª –∑–Ω–∞–ª, —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –∏–º –¥–∞–Ω–Ω—ã–µ –±—ã–ª–∏ —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–Ω—è—Ç—ã. –ü—Ä–∏ —ç—Ç–æ–º —Ç–∞–∫ –∂–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–∑–∞–∏–º–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ Sequence Number —É —Å–µ—Ä–≤–µ—Ä–∞ –∏ —É –∫–ª–∏–µ–Ω—Ç–∞, –Ω–æ —Ç–æ–ª—å–∫–æ —É–∂–µ –Ω–µ –Ω–∞ 1, –∞ –Ω–∞ —Ä–∞–∑–º–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö.</p>
<p>–î–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É–¥–∞–ª—ë–Ω–Ω–æ–º—É —É–∑–ª—É –ø–æ—Å—ã–ª–∞–µ—Ç—Å—è –ø–∞–∫–µ—Ç —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º —Ñ–ª–∞–≥–æ–º FIN.</p>
<p>–° —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ TCP —ç—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π <a href="http://proiot.ru/blog/posts/2012/10/09/avtomat-s-konechnym-chislom-sostoianii/">–∫–æ–Ω–µ—á–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç</a>. –ù–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ –ø–æ–∫–∞–∑–∞–Ω—ã –∫–∞–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞, —Ç–∞–∫ –∏ –∫–ª–∏–µ–Ω—Ç–∞ (—Ä–∞–∑–Ω—ã–µ —Ü–≤–µ—Ç–∞ —Å—Ç—Ä–µ–ª–æ–∫), –Ω–∞ —Å—Ç—Ä–µ–ª–∫–∞—Ö –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–æ <strong>—Å–æ–±—ã—Ç–∏–µ/–¥–µ–π—Å—Ç–≤–∏–µ</strong> ‚Äì –Ω–∞–ø—Ä–∏–º–µ—Ä –ø–µ—Ä–µ—Ö–æ–¥ —Å–µ—Ä–≤–µ—Ä–∞ (—Å–∏–Ω—è—è —Å—Ç—Ä–µ–ª–∫–∞) –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è LISTEN –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ SYN RECEIVED –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ —Å–æ–±—ã—Ç–∏—é SYN, —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—É SYN+ACK –≤ –æ—Ç–≤–µ—Ç:</p>
<p><img alt="screenshot" src="http://proiot.ru/blog/posts/2017/10/09/setevoe-programmirovanie-tcp-http-server/Tcp_state_diagram_fixed.svg" style="width:100%; border:1px solid #ddd;"></p>
<p>–¢–µ–ø–µ—Ä—å –Ω–µ–º–Ω–æ–≥–æ –∫–æ–¥–∞. –ü—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã–π –Ω–∏–∂–µ –ø—Ä–∏–º–µ—Ä –æ—á–µ–Ω—å —Å–∏–ª—å–Ω–æ —É–ø—Ä–æ—â—ë–Ω, —Ç—É—Ç –Ω–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–π –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ç–æ–ª—å–∫–æ –º–∏–Ω–∏–∞–Ω–∏–º–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –¥–ª—è –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏ —É—Ç–∏–ª–∏—Ç–æ–π netcat.</p>
<div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="n">tcp_packet</span> <span class="p">{</span>
  <span class="kt">uint16_t</span> <span class="n">from_port</span><span class="p">;</span>
  <span class="kt">uint16_t</span> <span class="n">to_port</span><span class="p">;</span>
  <span class="kt">uint32_t</span> <span class="n">seq_num</span><span class="p">;</span>
  <span class="kt">uint32_t</span> <span class="n">ack_num</span><span class="p">;</span>
  <span class="kt">uint8_t</span> <span class="n">data_offset</span><span class="p">;</span>
  <span class="kt">uint8_t</span> <span class="n">flags</span><span class="p">;</span>
  <span class="kt">uint16_t</span> <span class="n">window</span><span class="p">;</span>
  <span class="kt">uint16_t</span> <span class="n">cksum</span><span class="p">;</span>
  <span class="kt">uint16_t</span> <span class="n">urgent_ptr</span><span class="p">;</span>
  <span class="kt">uint8_t</span> <span class="n">data</span><span class="p">[];</span>
<span class="p">}</span> <span class="n">tcp_packet_t</span><span class="p">;</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tcp_reply</span><span class="p">(</span><span class="n">eth_frame_t</span> <span class="o">*</span><span class="n">frame</span><span class="p">,</span> <span class="kt">uint16_t</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">uint16_t</span> <span class="n">temp</span><span class="p">;</span>

  <span class="n">ip_packet_t</span> <span class="o">*</span><span class="n">ip</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)(</span><span class="n">frame</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
  <span class="n">tcp_packet_t</span> <span class="o">*</span><span class="n">tcp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)(</span><span class="n">ip</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>

  <span class="c1">// swap src/dst, fill tcp hdr?</span>
  <span class="n">temp</span> <span class="o">=</span> <span class="n">tcp</span><span class="o">-&gt;</span><span class="n">from_port</span><span class="p">;</span>
  <span class="n">tcp</span><span class="o">-&gt;</span><span class="n">from_port</span> <span class="o">=</span> <span class="n">tcp</span><span class="o">-&gt;</span><span class="n">to_port</span><span class="p">;</span>
  <span class="n">tcp</span><span class="o">-&gt;</span><span class="n">to_port</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>
  <span class="n">tcp</span><span class="o">-&gt;</span><span class="n">window</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">TCP_WINDOW_SIZE</span><span class="p">);</span>
  <span class="n">tcp</span><span class="o">-&gt;</span><span class="n">urgent_ptr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="c1">// SYN packet?</span>
  <span class="k">if</span><span class="p">(</span><span class="n">tcp</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">TCP_FLAG_SYN</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// add MSS option</span>
    <span class="n">tcp</span><span class="o">-&gt;</span><span class="n">data_offset</span> <span class="o">=</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">tcp_packet_t</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">tcp</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// MSS option</span>
    <span class="n">tcp</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span> <span class="c1">// MSS option length = 4 bytes</span>
    <span class="n">tcp</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">TCP_SYN_MSS</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span>
    <span class="n">tcp</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">TCP_SYN_MSS</span><span class="o">&amp;</span><span class="mh">0xff</span><span class="p">;</span>
    <span class="n">len</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// not syn packet - no options</span>
    <span class="n">tcp</span><span class="o">-&gt;</span><span class="n">data_offset</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">tcp_packet_t</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// calculate chksum</span>
  <span class="n">len</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">tcp_packet_t</span><span class="p">);</span>
  <span class="n">tcp</span><span class="o">-&gt;</span><span class="n">cksum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">tcp</span><span class="o">-&gt;</span><span class="n">cksum</span> <span class="o">=</span> <span class="n">ip_cksum</span><span class="p">(</span><span class="n">len</span> <span class="o">+</span> <span class="n">IP_PROTOCOL_TCP</span><span class="p">,</span>
      <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">ip</span><span class="o">-&gt;</span><span class="n">src</span><span class="p">,</span> <span class="n">len</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="k">sizeof</span> <span class="n">my_ip</span><span class="p">));</span>

  <span class="n">ip</span><span class="o">-&gt;</span><span class="n">payload_len</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">len</span><span class="p">);</span>
  <span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ip</span><span class="o">-&gt;</span><span class="n">dest</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ip</span><span class="o">-&gt;</span><span class="n">src</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">ip</span><span class="o">-&gt;</span><span class="n">src</span><span class="p">);</span>
  <span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ip</span><span class="o">-&gt;</span><span class="n">src</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">my_ip</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">ip</span><span class="o">-&gt;</span><span class="n">src</span><span class="p">);</span>
  <span class="n">eth_reply</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">len</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ip_packet_t</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tcp_step</span><span class="p">(</span><span class="n">tcp_packet_t</span> <span class="o">*</span><span class="n">tcp</span><span class="p">,</span> <span class="kt">uint16_t</span> <span class="n">num</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">uint32_t</span> <span class="n">ack_num</span><span class="p">;</span>
  <span class="n">ack_num</span> <span class="o">=</span> <span class="n">ntohl</span><span class="p">(</span><span class="n">tcp</span><span class="o">-&gt;</span><span class="n">seq_num</span><span class="p">)</span> <span class="o">+</span> <span class="n">num</span><span class="p">;</span>
  <span class="n">tcp</span><span class="o">-&gt;</span><span class="n">seq_num</span> <span class="o">=</span> <span class="n">tcp</span><span class="o">-&gt;</span><span class="n">ack_num</span><span class="p">;</span>
  <span class="n">tcp</span><span class="o">-&gt;</span><span class="n">ack_num</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">ack_num</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tcp_filter</span><span class="p">(</span><span class="n">eth_frame_t</span> <span class="o">*</span><span class="n">frame</span><span class="p">,</span> <span class="kt">uint16_t</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">ip_packet_t</span> <span class="o">*</span><span class="n">ip</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)(</span><span class="n">frame</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
  <span class="n">tcp_packet_t</span> <span class="o">*</span><span class="n">tcp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)(</span><span class="n">ip</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>

  <span class="k">switch</span><span class="p">(</span><span class="n">tcp</span><span class="o">-&gt;</span><span class="n">flags</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nl">TCP_FLAG_SYN</span><span class="p">:</span>
      <span class="n">tcp</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">=</span> <span class="n">TCP_FLAG_SYN</span> <span class="o">|</span> <span class="n">TCP_FLAG_ACK</span><span class="p">;</span>
      <span class="n">tcp_step</span><span class="p">(</span><span class="n">tcp</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
      <span class="n">tcp</span><span class="o">-&gt;</span><span class="n">seq_num</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">gettc</span><span class="p">());</span> <span class="c1">// random number</span>
      <span class="n">tcp_reply</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>

    <span class="k">case</span> <span class="n">TCP_FLAG_PSH</span> <span class="o">|</span> <span class="nl">TCP_FLAG_ACK</span><span class="p">:</span>
      <span class="n">len</span> <span class="o">-=</span> <span class="k">sizeof</span> <span class="p">(</span><span class="n">tcp_packet_t</span><span class="p">);</span>
      <span class="n">tcp_step</span><span class="p">(</span><span class="n">tcp</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
      <span class="n">tcp</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">=</span> <span class="n">TCP_FLAG_ACK</span><span class="p">;</span>
      <span class="c1">// feed/read data to/from app</span>
      <span class="n">tcp_reply</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">tcp_data</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">len</span><span class="p">));</span>
      <span class="k">break</span><span class="p">;</span>

    <span class="k">case</span> <span class="n">TCP_FLAG_FIN</span> <span class="o">|</span> <span class="nl">TCP_FLAG_ACK</span><span class="p">:</span>
      <span class="n">tcp_step</span><span class="p">(</span><span class="n">tcp</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
      <span class="n">tcp_reply</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª–µ–∑–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö ‚Äî –≤—ã–≤–æ–¥–∏–º –Ω–∞ —ç–∫—Ä–∞–Ω, –ø–µ—á–∞—Ç–∞–µ–º –≤ UART: </p>
<div class="highlight"><pre><span></span><span class="kt">uint16_t</span> <span class="nf">tcp_data</span><span class="p">(</span><span class="n">eth_frame_t</span> <span class="o">*</span><span class="n">frame</span><span class="p">,</span> <span class="kt">uint16_t</span> <span class="n">len</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">ip_packet_t</span> <span class="o">*</span><span class="n">ip</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)(</span><span class="n">frame</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
  <span class="n">tcp_packet_t</span> <span class="o">*</span><span class="n">tcp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)(</span><span class="n">ip</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">tcp</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>

  <span class="n">draw_clr</span><span class="p">();</span>
  <span class="n">data</span><span class="p">[</span><span class="n">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">draw_str</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;&gt;&gt; %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>

  <span class="c1">// piggyback</span>
  <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">response</span> <span class="o">=</span> <span class="s">&quot;!!! OK !!!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="n">strcpy</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">response</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">strlen</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p><a href="http://localhost:9148/f0925cc954111f5cb6f47c6b1dffc0ac">IPv6</a> | <a href="http://localhost:9148/ce2f76817817a8bea5d539aa0df45f8f">IPv4</a> | <a href="http://proiot.ru/blog/posts/2017/10/09/setevoe-programmirovanie-tcp-http-server/eth_tcp.zip">–∏—Å—Ö–æ–¥–Ω–∏–∫–∏</a></p>
<p><img alt="screenshot" src="http://proiot.ru/blog/posts/2017/10/09/setevoe-programmirovanie-tcp-http-server/tcp.png" style="width:50%; margin: 0 auto; display:block;"></p>
<p>–ß—Ç–æ–±—ã –≤—ã–≤–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ –≤ –¥–∏—Å–ø–ª–µ–π, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–µ–≤–∞–π—Å—É TCP-–ø–∞–∫–µ—Ç –Ω–∞ –ª—é–±–æ–π –ø–æ—Ä—Ç –ø–æ–º–æ—â—å—é netcat:</p>
<div class="highlight"><pre><span></span>~$ cat &lt;(echo &#39;hello TCP !&#39;) - | nc -6 fe80::0:ff:fe00:42%mazko 12345
</pre></div>


<p>–ë—É–¥—É—á–∏ –æ–¥–Ω–∞–∂–¥—ã —Å–æ–∑–¥–∞–Ω, –∫–∞–Ω–∞–ª TCP –º–æ–∂–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å ¬´–≤–µ—á–Ω–æ¬ª. –ê —á—Ç–æ –±—É–¥–µ—Ç, –µ—Å–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–∑–æ—Ä–≤–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç.–µ. –±–µ–∑ —Ñ–ª–∞–≥–∞ FIN ? –¢–∞–∫–∞—è —Å–∏—Ç—É–∞—Ü–∏—è –≤–æ–∑–º–æ–∂–Ω–∞, –µ—Å–ª–∏ –Ω–∞–ø—Ä–∏–º–µ—Ä –≤—ã–¥–µ—Ä–Ω—É—Ç—å –∫–∞–∫–æ–π-–Ω–∏–±—É–¥—å –∫–∞–±–µ–ª—å. –û–±–∞ –∏ –∫–ª–∏–µ–Ω—Ç –∏ —Å–µ—Ä–≤–µ—Ä –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –±—É–¥—É—Ç –±–µ–∑—É—Å–ø–µ—à–Ω–æ –¥–æ–ª–≥–æ –∂–¥–∞—Ç—å –¥–∞–Ω–Ω—ã—Ö –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞. –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è —Ç–∞–∫–∏—Ö ¬´–º–µ—Ä—Ç–≤—ã—Ö¬ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –º–µ—Ö–∞–Ω–∏–∑–º keep-alive ‚Äì –Ω–µ–∫–æ–µ —Å–ª—É–∂–µ–±–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –æ—Ç—Å—ã–ª–∞–µ—Ç—Å—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏. –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –Ω–∞ –Ω–µ–≥–æ –Ω–µ –ø–æ–ª—É—á–µ–Ω, —Ç–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç—Å—è.</p>
<p><a href="http://proiot.ru/blog/posts/2017/10/17/protokoly-interneta-veshchei-coap/">–î–∞–ª–µ–µ</a> CoAP.</p><p>There are <a href="http://proiot.ru/blog/posts/2017/10/09/setevoe-programmirovanie-tcp-http-server/#disqus_thread">comments</a>.</p>                </article>
            </aside><!-- /#featured -->

<div class="body" style="margin-bottom: 2em">
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- proiot-index -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6247427373315098"
     data-ad-slot="2711782349"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>

                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="http://proiot.ru/blog/posts/2017/05/25/zhizn-posle-rtos-model-aktorov-qpc-uml/" rel="bookmark"
                           title="Permalink to –ñ–∏–∑–Ω—å –ø–æ—Å–ª–µ RTOS - –º–æ–¥–µ–ª—å –∞–∫—Ç–æ—Ä–æ–≤ QP/C++ | UML">–ñ–∏–∑–Ω—å –ø–æ—Å–ª–µ RTOS - –º–æ–¥–µ–ª—å –∞–∫—Ç–æ—Ä–æ–≤ QP/C++ | UML</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-05-25T00:00:00+03:00">
                –ß—Ç 25 –º–∞—è 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="http://proiot.ru/blog/author/oleg-mazko/">Oleg Mazko</a>
        </address>
<p>In <a href="http://proiot.ru/blog/category/embedded/">Embedded</a>.</p>
<p>tags: <a href="http://proiot.ru/blog/tag/msp430">msp430</a> <a href="http://proiot.ru/blog/tag/qp">QP</a> <a href="http://proiot.ru/blog/tag/uml">UML</a> <a href="http://proiot.ru/blog/tag/fsm">FSM</a> <a href="http://proiot.ru/blog/tag/rtos">RTOS</a> </p>
</footer><!-- /.post-info -->                <blockquote>
<p>–ö–æ–º–ø—å—é—Ç–µ—Ä ‚Äî —ç—Ç–æ –∫–æ–Ω–µ—á–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç. –ü–æ—Ç–æ–∫–æ–≤–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω—É–∂–Ω–æ —Ç–µ–º, –∫—Ç–æ –Ω–µ —É–º–µ–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω–µ—á–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç—ã. ‚Äî –ê–ª–∞–Ω –ö–æ–∫—Å </p>
</blockquote>
<p><a href="https://www.state-machine.com/" rel="nofollow">Quantum Platform</a> (QP) ‚Äî —ç—Ç–æ —Å–µ–º–µ–π—Å—Ç–≤–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–≥–æ –ü–û, –≤ —Ç–æ–º —á–∏—Å–ª–µ –∏ –¥–ª—è –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤. QP –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∫–∞–∫ –Ω–∞ <a href="http://proiot.ru/blog/posts/2017/03/20/s-18-dlia-mikrokontrollerov-razvedka-boem/">¬´–ø–ª—é—Å–∞—Ö¬ª</a> (QP/C++), —Ç–∞–∫ –∏ –Ω–∞ –°–∏ (QP/C –∏ QP-nano), —á—Ç–æ ‚Ä¶</p>
                <a class="readmore" href="http://proiot.ru/blog/posts/2017/05/25/zhizn-posle-rtos-model-aktorov-qpc-uml/">read more</a>
<p>There are <a href="http://proiot.ru/blog/posts/2017/05/25/zhizn-posle-rtos-model-aktorov-qpc-uml/#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="http://proiot.ru/blog/posts/2017/02/05/picsimjs-soprogrammy-i-prosteishaia-mnogozadachnost/" rel="bookmark"
                           title="Permalink to PICSim.js - —Å–æ–ø—Ä–æ–≥—Ä–∞–º–º—ã –∏ –ø—Ä–æ—Å—Ç–µ–π—à–∞—è –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å">PICSim.js - —Å–æ–ø—Ä–æ–≥—Ä–∞–º–º—ã –∏ –ø—Ä–æ—Å—Ç–µ–π—à–∞—è –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-02-05T00:00:00+02:00">
                –í—Å 05 —Ñ–µ–≤—Ä–∞–ª—è 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="http://proiot.ru/blog/author/oleg-mazko/">Oleg Mazko</a>
        </address>
<p>In <a href="http://proiot.ru/blog/category/embedded/">Embedded</a>.</p>
<p>tags: <a href="http://proiot.ru/blog/tag/picsim">picsim</a> <a href="http://proiot.ru/blog/tag/rtos">RTOS</a> <a href="http://proiot.ru/blog/tag/fsm">FSM</a> </p>
</footer><!-- /.post-info -->                <p>–ú–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –º–∞—à–∏–Ω–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –≤ –∫–∞–∂–¥—ã–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ (–º–Ω–æ–≥–æ—è–¥–µ—Ä–Ω—ã–µ –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã —è –ø–æ–∫–∞ –Ω–µ –≤—Å—Ç—Ä–µ—á–∞–ª). –¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ –ø—Ä–æ—Å—Ç–µ–π—à–∞—è <a href="http://proiot.ru/blog/posts/2017/01/13/simuliatsiia-mikrokontrollerov-picsimjs/">–ø—Ä–æ–≥—Ä–∞–º–º–∞</a> –¥–ª—è –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ —ç—Ç–æ <em>—Å—É–ø–µ—Ä—Ü–∏–∫–ª</em> - –æ–¥–Ω–∞ —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ <code>main</code> —Å –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–º —Ü–∏–∫–ª–æ–º, –≥–¥–µ –∫—Ä—É—Ç–∏—Ç—Å—è –∫–∞–∫–∞—è-—Ç–æ –∑–∞–¥–∞—á–∞. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ —Ç–∞–∫–∂–µ –ø—Ä–µ–¥—É—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º <a href="http://proiot.ru/blog/posts/2017/01/16/picsimjs-semisegmentnyi-indikator-i-preryvaniia/">–ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π</a> - –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–±—ã—Ç–∏–π, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ—à–∞—Ç—å –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏ ‚Ä¶</p>
                <a class="readmore" href="http://proiot.ru/blog/posts/2017/02/05/picsimjs-soprogrammy-i-prosteishaia-mnogozadachnost/">read more</a>
<p>There are <a href="http://proiot.ru/blog/posts/2017/02/05/picsimjs-soprogrammy-i-prosteishaia-mnogozadachnost/#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="http://proiot.ru/blog/posts/2012/10/09/avtomat-s-konechnym-chislom-sostoianii/" rel="bookmark"
                           title="Permalink to –ê–≤—Ç–æ–º–∞—Ç —Å –∫–æ–Ω–µ—á–Ω—ã–º —á–∏—Å–ª–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–π">–ê–≤—Ç–æ–º–∞—Ç —Å –∫–æ–Ω–µ—á–Ω—ã–º —á–∏—Å–ª–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–π</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2012-10-09T00:00:00+03:00">
                –í—Ç 09 –æ–∫—Ç—è–±—Ä—è 2012
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="http://proiot.ru/blog/author/oleg-mazko/">Oleg Mazko</a>
        </address>
<p>In <a href="http://proiot.ru/blog/category/embedded/">Embedded</a>.</p>
<p>tags: <a href="http://proiot.ru/blog/tag/fsm">FSM</a> </p>
</footer><!-- /.post-info -->                <p>–ü—Ä–æ—Å—Ç—ã–º –ø—Ä–∏–º–µ—Ä–æ–º –º–∞—à–∏–Ω—ã —Å –∫–æ–Ω–µ—á–Ω—ã–º —á–∏—Å–ª–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–π (<strong>FSM</strong> - <em>Finite State Machine</em>) –º–æ–∂–µ—Ç –±—ã—Ç—å –ö–∏—Ç–∞–π—Å–∫–∞—è –≥–∏—Ä–ª—è–Ω–¥–∞. –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–æ –æ–Ω–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∏–∑ —Å–µ–±—è —á–µ—Ä–Ω—É—é –∫–æ—Ä–æ–±–æ—á–∫—É —Å –∫–Ω–æ–ø–æ—á–∫–æ–π, –¥–≤–∞ –ø—Ä–æ–≤–æ–¥–∞ –¥–ª—è –ø–∏—Ç–∞–Ω–∏—è (220 –í), –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–æ–¥–∞ –¥–ª—è —Ä–∞–∑–Ω–æ—Ü–≤–µ—Ç–Ω—ã—Ö –ª–∞–º–ø–æ—á–µ–∫, –∫–æ—Ç–æ—Ä—ã–º–∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –≥–æ—Ç–æ–≤–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞. –í–Ω—É—Ç—Ä–∏ –∫–æ—Ä–æ–±–æ—á–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è <em>–º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä</em> –∏ —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∞—è –æ–±–≤—è–∑–∫–∞. –ú—ã –Ω–µ –±—É–¥–µ–º —É–≥–ª—É–±–ª—è—Ç—å—Å—è ‚Ä¶</p>
                <a class="readmore" href="http://proiot.ru/blog/posts/2012/10/09/avtomat-s-konechnym-chislom-sostoianii/">read more</a>
<p>There are <a href="http://proiot.ru/blog/posts/2012/10/09/avtomat-s-konechnym-chislom-sostoianii/#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>
                </ol><!-- /#posts-list -->
                </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a rel="nofollow" href="http://getpelican.com/">Pelican</a></li>
                            <li><a rel="nofollow" href="http://python.org/">Python.org</a></li>
                            <li><a rel="nofollow" href="http://jinja.pocoo.org/">Jinja2</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://proiot.ru/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a rel="nofollow" href="http://github.com/mazko">github</a></li>
                            <li><a rel="nofollow" href="http://linkedin.com/in/mazko">linkedin</a></li>
                            <li><a rel="nofollow" href="http://stackoverflow.com/users/281102/oleg-mazko">stackoverflow</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

<script type="text/javascript">
    var disqus_shortname = 'mazko';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>